<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>parmplugin.C Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.14 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>parmplugin.C</h1><a href="parmplugin_8C.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/***************************************************************************</font>
00002 <font class="comment"> *cr</font>
00003 <font class="comment"> *cr            (C) Copyright 1995-2006 The Board of Trustees of the</font>
00004 <font class="comment"> *cr                        University of Illinois</font>
00005 <font class="comment"> *cr                         All Rights Reserved</font>
00006 <font class="comment"> *cr</font>
00007 <font class="comment"> ***************************************************************************/</font>
00008 
00009 <font class="comment">/***************************************************************************</font>
00010 <font class="comment"> * RCS INFORMATION:</font>
00011 <font class="comment"> *</font>
00012 <font class="comment"> *      $RCSfile: parmplugin.C,v $</font>
00013 <font class="comment"> *      $Author: johns $       $Locker:  $             $State: Exp $</font>
00014 <font class="comment"> *      $Revision: 1.28 $       $Date: 2006/02/23 19:36:45 $</font>
00015 <font class="comment"> *</font>
00016 <font class="comment"> ***************************************************************************/</font>
00017 
00018 <font class="preprocessor">#include &lt;string.h&gt;</font>
00019 <font class="preprocessor">#include "<a class="code" href="ReadPARM_8h.html">ReadPARM.h</a>"</font>
00020 <font class="preprocessor">#include "<a class="code" href="molfile__plugin_8h.html">molfile_plugin.h</a>"</font>
00021 
00022 <font class="keyword">typedef</font> <font class="keyword">struct </font>{
<a name="l00023"></a><a class="code" href="structparmdata.html#m6">00023</a>   <a class="code" href="classReadPARM.html">ReadPARM</a> *rp;
<a name="l00024"></a><a class="code" href="structparmdata.html#m7">00024</a>   FILE *<a class="code" href="structparm.html">parm</a>;
<a name="l00025"></a><a class="code" href="structparmdata.html#m8">00025</a>   <font class="keywordtype">int</font> natoms;
<a name="l00026"></a><a class="code" href="structparmdata.html#m5">00026</a>   <font class="keywordtype">int</font> *from, *to;
00027 } <a class="code" href="structparmdata.html">parmdata</a>;
00028 
<a name="l00029"></a><a class="code" href="parmplugin_8C.html#a1">00029</a> <font class="keyword">static</font> <font class="keywordtype">void</font> *<a class="code" href="parmplugin_8C.html#a1">open_parm_read</a>(<font class="keyword">const</font> <font class="keywordtype">char</font> *filename, <font class="keyword">const</font> <font class="keywordtype">char</font> *, 
00030     <font class="keywordtype">int</font> *natoms) {
00031  
00032   FILE *<a class="code" href="structparm.html">parm</a>;
00033   <a class="code" href="classReadPARM.html">ReadPARM</a> *rp = <font class="keyword">new</font> <a class="code" href="classReadPARM.html">ReadPARM</a>;
00034   <font class="keywordflow">if</font>(!(<a class="code" href="structparm.html">parm</a> = rp-&gt;<a class="code" href="classReadPARM.html#a2">open_parm_file</a>(filename))) {
00035     fprintf(stderr, <font class="stringliteral">"Cannot open parm file '%s'\n"</font>, filename);
00036     <font class="keyword">delete</font> rp;
00037     <font class="keywordflow">return</font> NULL;
00038   }
00039   
00040   <font class="keywordflow">if</font> (rp-&gt;<a class="code" href="classReadPARM.html#a6">readparm</a>(<a class="code" href="structparm.html">parm</a>) != 0) {
00041     <font class="keyword">delete</font> rp;
00042     <font class="comment">// XXX should we call close_parm_file???</font>
00043     <font class="keywordflow">return</font> NULL; 
00044   }
00045   *natoms = rp-&gt;<a class="code" href="classReadPARM.html#a10">get_parm_natoms</a>();
00046   
00047   <a class="code" href="structparmdata.html">parmdata</a> *p = <font class="keyword">new</font> <a class="code" href="structparmdata.html">parmdata</a>;
00048   memset(p, 0, <font class="keyword">sizeof</font>(parmdata));
00049   p-&gt;<a class="code" href="structparmdata.html#m6">rp</a> = rp;
00050   p-&gt;<a class="code" href="structparmdata.html#m7">parm</a> = <a class="code" href="structparm.html">parm</a>;
00051   p-&gt;<a class="code" href="structparmdata.html#m8">natoms</a> = *natoms;
00052   <font class="keywordflow">return</font> p;
00053 }
00054 
<a name="l00055"></a><a class="code" href="parmplugin_8C.html#a2">00055</a> <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="parmplugin_8C.html#a2">read_parm_structure</a>(<font class="keywordtype">void</font> *mydata, <font class="keywordtype">int</font> *optflags,
00056     <a class="code" href="structmolfile__atom__t.html">molfile_atom_t</a> *atoms) {
00057   
00058   <a class="code" href="structparmdata.html">parmdata</a> *p = (<a class="code" href="structparmdata.html">parmdata</a> *)mydata;
00059   <a class="code" href="classReadPARM.html">ReadPARM</a> *rp = p-&gt;<a class="code" href="structparmdata.html#m6">rp</a>;
00060   rp-&gt;<a class="code" href="classReadPARM.html#a12">get_parm_boxInfo</a>();
00061   <font class="keywordtype">int</font> i;
00062  
00063   *optflags = <a class="code" href="molfile__plugin_8h.html#a13">MOLFILE_CHARGE</a> | <a class="code" href="molfile__plugin_8h.html#a12">MOLFILE_MASS</a>;
00064 
00065   <font class="keywordflow">for</font> (i=0; i&lt;p-&gt;<a class="code" href="structparmdata.html#m8">natoms</a>; i++) {
00066     <a class="code" href="structmolfile__atom__t.html">molfile_atom_t</a> *atom = atoms+i;
00067     <font class="comment">// XXX Why isn't there a return code for error on read????</font>
00068     rp-&gt;<a class="code" href="classReadPARM.html#a7">get_parm_atom</a>(i, atom-&gt;<a class="code" href="structmolfile__atom__t.html#m0">name</a>, atom-&gt;<a class="code" href="structmolfile__atom__t.html#m1">type</a>, atom-&gt;<a class="code" href="structmolfile__atom__t.html#m2">resname</a>, atom-&gt;<a class="code" href="structmolfile__atom__t.html#m4">segid</a>, 
00069         &amp;atom-&gt;<a class="code" href="structmolfile__atom__t.html#m3">resid</a>, &amp;atom-&gt;<a class="code" href="structmolfile__atom__t.html#m11">charge</a>, &amp;atom-&gt;<a class="code" href="structmolfile__atom__t.html#m10">mass</a>);
00070     atom-&gt;<a class="code" href="structmolfile__atom__t.html#m5">chain</a>[0] = <font class="charliteral">'\0'</font>;
00071   }
00072   <font class="comment">// XXX amber box info not supported in the API</font>
00073   <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a2">MOLFILE_SUCCESS</a>;
00074 }
00075 
<a name="l00076"></a><a class="code" href="parmplugin_8C.html#a3">00076</a> <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="parmplugin_8C.html#a3">read_parm_bonds</a>(<font class="keywordtype">void</font> *v, <font class="keywordtype">int</font> *nbonds, <font class="keywordtype">int</font> **fromptr, <font class="keywordtype">int</font> **toptr, <font class="keywordtype">float</font> **bondorderptr) {
00077   <a class="code" href="structparmdata.html">parmdata</a> *p = (<a class="code" href="structparmdata.html">parmdata</a> *)v;
00078   <a class="code" href="classReadPARM.html">ReadPARM</a> *rp = p-&gt;<a class="code" href="structparmdata.html#m6">rp</a>;
00079   <font class="keywordtype">int</font> i, j;
00080   <font class="keywordtype">int</font> numbonds = rp-&gt;<a class="code" href="classReadPARM.html#a11">get_parm_nbonds</a>();
00081   p-&gt;<a class="code" href="structparmdata.html#m4">from</a> = (<font class="keywordtype">int</font> *)malloc(numbonds*<font class="keyword">sizeof</font>(<font class="keywordtype">int</font>));
00082   p-&gt;<a class="code" href="structparmdata.html#m5">to</a> = (<font class="keywordtype">int</font> *)malloc(numbonds*<font class="keyword">sizeof</font>(<font class="keywordtype">int</font>));
00083   j = 0;
00084   <font class="keywordflow">for</font> (i=0; i&lt;numbonds; i++) {
00085     <font class="keywordtype">int</font> a1, a2;
00086     rp-&gt;<a class="code" href="classReadPARM.html#a8">get_parm_bond</a>(i, (&amp;a1)-i, (&amp;a2)-i);
00087     <font class="keywordflow">if</font> ( a1 &lt;= p-&gt;<a class="code" href="structparmdata.html#m8">natoms</a> &amp;&amp; a2 &lt;= p-&gt;<a class="code" href="structparmdata.html#m8">natoms</a>) {
00088       p-&gt;<a class="code" href="structparmdata.html#m4">from</a>[j] = a1;
00089       p-&gt;<a class="code" href="structparmdata.html#m5">to</a>[j] = a2;
00090       j++;
00091     } <font class="keywordflow">else</font> {
00092       printf(<font class="stringliteral">"skipping bond (%d %d)\n"</font>, a1, a2); 
00093     }
00094   }
00095   *nbonds = j;
00096   *fromptr = p-&gt;<a class="code" href="structparmdata.html#m4">from</a>;
00097   *toptr = p-&gt;<a class="code" href="structparmdata.html#m5">to</a>;
00098   *bondorderptr = NULL; <font class="comment">// PARM files don't have bond order information</font>
00099   <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a2">MOLFILE_SUCCESS</a>;
00100 }
00101 
00102 
<a name="l00103"></a><a class="code" href="parmplugin_8C.html#a4">00103</a> <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="parmplugin_8C.html#a4">close_parm_read</a>(<font class="keywordtype">void</font> *mydata) {
00104   <a class="code" href="structparmdata.html">parmdata</a> *p = (<a class="code" href="structparmdata.html">parmdata</a> *)mydata;
00105   p-&gt;<a class="code" href="structparmdata.html#m6">rp</a>-&gt;<a class="code" href="classReadPARM.html#a3">close_parm_file</a>(p-&gt;<a class="code" href="structparmdata.html#m7">parm</a>);
00106   <font class="keywordflow">if</font> (p-&gt;<a class="code" href="structparmdata.html#m4">from</a>) free(p-&gt;<a class="code" href="structparmdata.html#m4">from</a>);
00107   <font class="keywordflow">if</font> (p-&gt;<a class="code" href="structparmdata.html#m5">to</a>) free(p-&gt;<a class="code" href="structparmdata.html#m5">to</a>);
00108   <font class="keyword">delete</font> p-&gt;<a class="code" href="structparmdata.html#m6">rp</a>;
00109 }
00110  
00111 <font class="comment">/*</font>
00112 <font class="comment"> * Initialization stuff down here</font>
00113 <font class="comment"> */</font>
00114 
<a name="l00115"></a><a class="code" href="parmplugin_8C.html#a0">00115</a> <font class="keyword">static</font> <a class="code" href="structmolfile__plugin__t.html">molfile_plugin_t</a> <a class="code" href="parmplugin_8C.html#a0">plugin</a> =  {
00116   <a class="code" href="vmdplugin_8h.html#a10">vmdplugin_ABIVERSION</a>,                                 <font class="comment">// ABI version</font>
00117   <a class="code" href="molfile__plugin_8h.html#a0">MOLFILE_PLUGIN_TYPE</a>,                                  <font class="comment">// type</font>
00118   <font class="stringliteral">"parm"</font>,                                               <font class="comment">// short name</font>
00119   <font class="stringliteral">"AMBER Parm"</font>,                                         <font class="comment">// pretty name</font>
00120   <font class="stringliteral">"Justin Gullingsrud, John E. Stone"</font>,                  <font class="comment">// author</font>
00121   0,                                                    <font class="comment">// major version</font>
00122   4,                                                    <font class="comment">// minor version</font>
00123   <a class="code" href="vmdplugin_8h.html#a12">VMDPLUGIN_THREADSAFE</a>,                                 <font class="comment">// is_reentrant</font>
00124   <font class="stringliteral">"parm"</font>,                                               <font class="comment">// filename extension</font>
00125   <a class="code" href="parmplugin_8C.html#a1">open_parm_read</a>,        <font class="comment">/* open_file_read   */</font>
00126   <a class="code" href="parmplugin_8C.html#a2">read_parm_structure</a>,   <font class="comment">/* read_structure   */</font>
00127   <a class="code" href="parmplugin_8C.html#a3">read_parm_bonds</a>,
00128   0,                     <font class="comment">/* read_next_timestep */</font>
00129   <a class="code" href="parmplugin_8C.html#a4">close_parm_read</a>        <font class="comment">/* close_file_read    */</font>
00130 };
00131 
<a name="l00132"></a><a class="code" href="parmplugin_8C.html#a5">00132</a> <a class="code" href="vmdplugin_8h.html#a7">VMDPLUGIN_API</a> <font class="keywordtype">int</font> <a class="code" href="vmdplugin_8h.html#a5">VMDPLUGIN_init</a>(<font class="keywordtype">void</font>) { <font class="keywordflow">return</font> <a class="code" href="vmdplugin_8h.html#a13">VMDPLUGIN_SUCCESS</a>; }
<a name="l00133"></a><a class="code" href="parmplugin_8C.html#a6">00133</a> <a class="code" href="vmdplugin_8h.html#a7">VMDPLUGIN_API</a> <font class="keywordtype">int</font> <a class="code" href="vmdplugin_8h.html#a6">VMDPLUGIN_fini</a>(<font class="keywordtype">void</font>) { <font class="keywordflow">return</font> <a class="code" href="vmdplugin_8h.html#a13">VMDPLUGIN_SUCCESS</a>; }
<a name="l00134"></a><a class="code" href="parmplugin_8C.html#a7">00134</a> <a class="code" href="vmdplugin_8h.html#a7">VMDPLUGIN_API</a> <font class="keywordtype">int</font> <a class="code" href="vmdplugin_8h.html#a3">VMDPLUGIN_register</a>(<font class="keywordtype">void</font> *v, <a class="code" href="vmdplugin_8h.html#a15">vmdplugin_register_cb</a> cb) {
00135   (*cb)(v, (<a class="code" href="structvmdplugin__t.html">vmdplugin_t</a> *)&amp;plugin);
00136   <font class="keywordflow">return</font> 0;
00137 }
00138 
</pre></div><hr><address><small>Generated on Wed Mar 22 13:15:30 2006 for VMD Plugins (current) by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.14 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2002</small></address>
</body>
</html>
