<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>mol2plugin.C Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.14 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>mol2plugin.C</h1><a href="mol2plugin_8C.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/***************************************************************************</font>
00002 <font class="comment"> *cr</font>
00003 <font class="comment"> *cr            (C) Copyright 1995-2006 The Board of Trustees of the</font>
00004 <font class="comment"> *cr                        University of Illinois</font>
00005 <font class="comment"> *cr                         All Rights Reserved</font>
00006 <font class="comment"> *cr</font>
00007 <font class="comment"> ***************************************************************************/</font>
00008 
00009 <font class="comment">/***************************************************************************</font>
00010 <font class="comment"> * RCS INFORMATION:</font>
00011 <font class="comment"> *</font>
00012 <font class="comment"> *      $RCSfile: mol2plugin.C,v $</font>
00013 <font class="comment"> *      $Author: johns $       $Locker:  $             $State: Exp $</font>
00014 <font class="comment"> *      $Revision: 1.19 $       $Date: 2006/02/23 19:36:45 $</font>
00015 <font class="comment"> *</font>
00016 <font class="comment"> ***************************************************************************/</font>
00017 
00018 <font class="comment">/*</font>
00019 <font class="comment"> * mol2 file reader</font>
00020 <font class="comment"> * More information on this format is available at</font>
00021 <font class="comment"> *   http://www.tripos.com/data/support/mol2.pdf</font>
00022 <font class="comment"> *   http://www.tripos.com/mol2/</font>
00023 <font class="comment"> *</font>
00024 <font class="comment"> *   DOCK mol2 page: </font>
00025 <font class="comment"> *     http://www.csb.yale.edu/userguides/datamanip/dock/DOCK_4.0.1/html/Manual.41.html</font>
00026 <font class="comment"> *</font>
00027 <font class="comment"> * This plugin currently reads the following record types:</font>
00028 <font class="comment"> *  MOLECULE</font>
00029 <font class="comment"> *  ATOM</font>
00030 <font class="comment"> *  BOND</font>
00031 <font class="comment"> *</font>
00032 <font class="comment"> */</font>
00033 
00034 <font class="preprocessor">#include "<a class="code" href="molfile__plugin_8h.html">molfile_plugin.h</a>"</font>
00035 
00036 <font class="preprocessor">#include &lt;stdlib.h&gt;</font>
00037 <font class="preprocessor">#include &lt;stdio.h&gt;</font>
00038 <font class="preprocessor">#include &lt;string.h&gt;</font>
00039 
00040 <font class="preprocessor">#if defined(_AIX)</font>
00041 <font class="preprocessor"></font><font class="preprocessor">#include &lt;strings.h&gt;</font>
00042 <font class="preprocessor">#endif</font>
00043 <font class="preprocessor"></font>
<a name="l00044"></a><a class="code" href="mol2plugin_8C.html#a0">00044</a> <font class="preprocessor">#define LINESIZE 256</font>
00045 <font class="preprocessor"></font>
<a name="l00046"></a><a class="code" href="structmol2data.html">00046</a> <font class="keyword">typedef</font> <font class="keyword">struct </font>{
<a name="l00047"></a><a class="code" href="structmol2data.html#m0">00047</a>   FILE *file;
<a name="l00048"></a><a class="code" href="structmol2data.html#m1">00048</a>   <a class="code" href="structmolfile__atom__t.html">molfile_atom_t</a> *atomlist;
<a name="l00049"></a><a class="code" href="structmol2data.html#m4">00049</a>   <font class="keywordtype">int</font> natoms, nbonds, optflags, coords_read;
<a name="l00050"></a><a class="code" href="structmol2data.html#m7">00050</a>   <font class="keywordtype">int</font> *from, *to;
<a name="l00051"></a><a class="code" href="structmol2data.html#m8">00051</a>   <font class="keywordtype">float</font> *bondorder;
00052 } <a class="code" href="structmol2data.html">mol2data</a>;
00053 
00054 <font class="comment">// Open the file and create the mol2 struct used to pass data to the other</font>
00055 <font class="comment">// functions.</font>
<a name="l00056"></a><a class="code" href="mol2plugin_8C.html#a2">00056</a> <font class="keyword">static</font> <font class="keywordtype">void</font> *<a class="code" href="mol2plugin_8C.html#a2">open_mol2_read</a>(<font class="keyword">const</font> <font class="keywordtype">char</font> *path, <font class="keyword">const</font> <font class="keywordtype">char</font> *filetype, 
00057     <font class="keywordtype">int</font> *natoms) {
00058   FILE *fd;
00059   <a class="code" href="structmol2data.html">mol2data</a> *mol2;
00060   <font class="keywordtype">char</font> line[<a class="code" href="mol2plugin_8C.html#a0">LINESIZE</a>]; 
00061   <font class="keywordtype">int</font> match, nbonds, optflags;
00062 
00063   fd = fopen(path, <font class="stringliteral">"r"</font>);
00064   <font class="keywordflow">if</font> (!fd)
00065     <font class="keywordflow">return</font> NULL;
00066   
00067   <font class="comment">// Find and read the MOLECULE record</font>
00068   <font class="keywordflow">do</font> {
00069     fgets(line, <a class="code" href="mol2plugin_8C.html#a0">LINESIZE</a>, fd);
00070     <font class="keywordflow">if</font> ( ferror(fd) || feof(fd) ) {
00071       fprintf(stderr, <font class="stringliteral">"mol2plugin: No molecule record found in file.\n"</font>);
00072       <font class="keywordflow">return</font> NULL;
00073     }
00074   } <font class="keywordflow">while</font> ( strncmp(line, <font class="stringliteral">"@&lt;TRIPOS&gt;MOLECULE"</font>, 17) );
00075 
00076   fgets(line, <a class="code" href="mol2plugin_8C.html#a0">LINESIZE</a>, fd);  <font class="comment">// Read and ignore the mol_name</font>
00077   fgets(line, <a class="code" href="mol2plugin_8C.html#a0">LINESIZE</a>, fd);  <font class="comment">// Read the molecule info</font>
00078   match = sscanf(line, <font class="stringliteral">" %d %d"</font>, natoms, &amp;nbonds);
00079   <font class="keywordflow">if</font> (match == 1) {
00080     nbonds = 0;
00081   }
00082   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (match != 2) {
00083     fprintf(stderr, <font class="stringliteral">"mol2plugin: Cannot determine the number of atoms.\n"</font>);
00084     <font class="keywordflow">return</font> NULL;
00085   }
00086   fgets(line, <a class="code" href="mol2plugin_8C.html#a0">LINESIZE</a>, fd);  <font class="comment">// Read and ignore the mol_type</font>
00087   fgets(line, <a class="code" href="mol2plugin_8C.html#a0">LINESIZE</a>, fd);  <font class="comment">// Read the charge_type</font>
00088   <font class="keywordflow">if</font> ( strncmp(line, <font class="stringliteral">"NO_CHARGES"</font>, 10) == 0 ) {
00089     optflags = <a class="code" href="molfile__plugin_8h.html#a8">MOLFILE_NOOPTIONS</a>;
00090   }
00091   <font class="keywordflow">else</font> {
00092     optflags = <a class="code" href="molfile__plugin_8h.html#a13">MOLFILE_CHARGE</a>;
00093   }
00094 
00095   <font class="comment">// Allocate and initialize the mol2 structure</font>
00096   mol2 = <font class="keyword">new</font> <a class="code" href="structmol2data.html">mol2data</a>;
00097   mol2-&gt;<a class="code" href="structmol2data.html#m0">file</a> = fd;
00098   mol2-&gt;<a class="code" href="structmol2data.html#m2">natoms</a> = *natoms;
00099   mol2-&gt;<a class="code" href="structmol2data.html#m3">nbonds</a> = nbonds;
00100   mol2-&gt;<a class="code" href="structmol2data.html#m4">optflags</a> = optflags;
00101   mol2-&gt;<a class="code" href="structmol2data.html#m5">coords_read</a> = 0;
00102   mol2-&gt;<a class="code" href="structmol2data.html#m6">from</a> = NULL;
00103   mol2-&gt;<a class="code" href="structmol2data.html#m7">to</a> = NULL;
00104   mol2-&gt;<a class="code" href="structmol2data.html#m8">bondorder</a> = NULL;
00105 
00106   <font class="keywordflow">return</font> mol2;
00107 }
00108 
00109 <font class="comment">// Read atom information, but not coordinates.</font>
<a name="l00110"></a><a class="code" href="mol2plugin_8C.html#a3">00110</a> <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="mol2plugin_8C.html#a3">read_mol2</a>(<font class="keywordtype">void</font> *v, <font class="keywordtype">int</font> *optflags, <a class="code" href="structmolfile__atom__t.html">molfile_atom_t</a> *atoms) {
00111   <a class="code" href="structmol2data.html">mol2data</a> *mol2 = (<a class="code" href="structmol2data.html">mol2data</a> *)v;
00112   <font class="keywordtype">char</font> line[<a class="code" href="mol2plugin_8C.html#a0">LINESIZE</a>]; 
00113   <font class="keywordtype">int</font> i, match;
00114   <a class="code" href="structmolfile__atom__t.html">molfile_atom_t</a> *atom;
00115 
00116   *optflags = mol2-&gt;<a class="code" href="structmol2data.html#m4">optflags</a>;
00117 
00118   <font class="comment">// Find and read the ATOM record</font>
00119   rewind(mol2-&gt;<a class="code" href="structmol2data.html#m0">file</a>);
00120   <font class="keywordflow">do</font> {
00121     fgets(line, <a class="code" href="mol2plugin_8C.html#a0">LINESIZE</a>, mol2-&gt;<a class="code" href="structmol2data.html#m0">file</a>);
00122     <font class="keywordflow">if</font> ( ferror(mol2-&gt;<a class="code" href="structmol2data.html#m0">file</a>) || feof(mol2-&gt;<a class="code" href="structmol2data.html#m0">file</a>) ) {
00123       fprintf(stderr, <font class="stringliteral">"mol2plugin: No atom record found in file.\n"</font>);
00124       <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a4">MOLFILE_ERROR</a>;
00125     }
00126   } <font class="keywordflow">while</font> ( strncmp(line, <font class="stringliteral">"@&lt;TRIPOS&gt;ATOM"</font>, 13) );
00127 
00128   <font class="comment">// Read the atoms</font>
00129   <font class="keywordflow">for</font> (i = 0; i &lt; mol2-&gt;<a class="code" href="structmol2data.html#m2">natoms</a>; i++) {
00130     atom = atoms+i;
00131 
00132     fgets(line, <a class="code" href="mol2plugin_8C.html#a0">LINESIZE</a>, mol2-&gt;<a class="code" href="structmol2data.html#m0">file</a>);
00133     <font class="keywordflow">if</font> ( ferror(mol2-&gt;<a class="code" href="structmol2data.html#m0">file</a>) || feof(mol2-&gt;<a class="code" href="structmol2data.html#m0">file</a>) ) {
00134       fprintf(stderr, <font class="stringliteral">"mol2plugin: Error occurred reading atom record.\n"</font>);
00135       <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a4">MOLFILE_ERROR</a>;
00136     }
00137 
00138     match = sscanf(line, <font class="stringliteral">" %*d %s %*f %*f %*f %*s %d %s %f"</font>, 
00139       atom-&gt;<a class="code" href="structmolfile__atom__t.html#m0">name</a>, &amp;atom-&gt;<a class="code" href="structmolfile__atom__t.html#m3">resid</a>, atom-&gt;<a class="code" href="structmolfile__atom__t.html#m2">resname</a>, &amp;atom-&gt;<a class="code" href="structmolfile__atom__t.html#m11">charge</a>);
00140 
00141     <font class="comment">// The last three records are optional for mol2 files, supply values if</font>
00142     <font class="comment">// any are missing. Note that these cases are meant to fall through.</font>
00143     <font class="keywordflow">switch</font> (match) {
00144       <font class="keywordflow">case</font> 0: 
00145         fprintf(stderr, <font class="stringliteral">"mol2plugin: Improperly formatted atom record.\n"</font>);
00146         <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a4">MOLFILE_ERROR</a>;
00147 
00148       <font class="keywordflow">case</font> 1:
00149         atom-&gt;<a class="code" href="structmolfile__atom__t.html#m3">resid</a> = 0;
00150 
00151       <font class="keywordflow">case</font> 2:
00152         sprintf(atom-&gt;<a class="code" href="structmolfile__atom__t.html#m2">resname</a>, <font class="stringliteral">"%d"</font>, atom-&gt;<a class="code" href="structmolfile__atom__t.html#m3">resid</a>);
00153 
00154       <font class="keywordflow">case</font> 3:
00155         atom-&gt;<a class="code" href="structmolfile__atom__t.html#m11">charge</a> = 0.0;
00156 
00157       <font class="keywordflow">default</font>:
00158         <font class="keywordflow">break</font>;
00159     }
00160 
00161     strcpy(atom-&gt;<a class="code" href="structmolfile__atom__t.html#m1">type</a>, atom-&gt;<a class="code" href="structmolfile__atom__t.html#m0">name</a>);
00162     <font class="comment">// Leave these blank when not provided by the file.</font>
00163     atom-&gt;<a class="code" href="structmolfile__atom__t.html#m5">chain</a>[0] = <font class="charliteral">'\0'</font>;
00164     atom-&gt;<a class="code" href="structmolfile__atom__t.html#m4">segid</a>[0] = <font class="charliteral">'\0'</font>;
00165   }
00166 
00167   <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a2">MOLFILE_SUCCESS</a>;
00168 }
00169 
00170 
00171 
00172 <font class="comment">// Create arrays of one-based bond indicies.</font>
<a name="l00173"></a><a class="code" href="mol2plugin_8C.html#a4">00173</a> <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="mol2plugin_8C.html#a4">read_mol2_bonds</a>(<font class="keywordtype">void</font> *v, <font class="keywordtype">int</font> *nbonds, <font class="keywordtype">int</font> **fromptr, <font class="keywordtype">int</font> **toptr, <font class="keywordtype">float</font> **bondorderptr) {
00174   <a class="code" href="structmol2data.html">mol2data</a> *mol2 = (<a class="code" href="structmol2data.html">mol2data</a> *)v;
00175   <font class="keywordtype">char</font> line[<a class="code" href="mol2plugin_8C.html#a0">LINESIZE</a>], bond_type[16]; 
00176   <font class="keywordtype">int</font> i, match, bond_from, bond_to, bond_index, current_nbonds;
00177   <font class="keywordtype">float</font> curr_order;
00178 
00179   <font class="keywordflow">if</font> (mol2-&gt;<a class="code" href="structmol2data.html#m3">nbonds</a> == 0) {
00180     *nbonds = 0;
00181     *fromptr = NULL;
00182     *toptr = NULL;
00183     <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a2">MOLFILE_SUCCESS</a>;
00184   }
00185 
00186   <font class="comment">// Allocate memory for the from and to arrays. This will be freed in</font>
00187   <font class="comment">// close_mol2_read</font>
00188   mol2-&gt;<a class="code" href="structmol2data.html#m6">from</a> = <font class="keyword">new</font> <font class="keywordtype">int</font>[mol2-&gt;<a class="code" href="structmol2data.html#m3">nbonds</a>];
00189   mol2-&gt;<a class="code" href="structmol2data.html#m7">to</a> = <font class="keyword">new</font> <font class="keywordtype">int</font>[mol2-&gt;<a class="code" href="structmol2data.html#m3">nbonds</a>];
00190   mol2-&gt;<a class="code" href="structmol2data.html#m8">bondorder</a>=<font class="keyword">new</font> <font class="keywordtype">float</font>[mol2-&gt;<a class="code" href="structmol2data.html#m3">nbonds</a>];
00191   current_nbonds = mol2-&gt;<a class="code" href="structmol2data.html#m3">nbonds</a>;
00192 
00193   <font class="comment">// Find and read the BOND record</font>
00194   rewind(mol2-&gt;<a class="code" href="structmol2data.html#m0">file</a>);
00195   <font class="keywordflow">do</font> {
00196     fgets(line, <a class="code" href="mol2plugin_8C.html#a0">LINESIZE</a>, mol2-&gt;<a class="code" href="structmol2data.html#m0">file</a>);
00197     <font class="keywordflow">if</font> ( ferror(mol2-&gt;<a class="code" href="structmol2data.html#m0">file</a>) || feof(mol2-&gt;<a class="code" href="structmol2data.html#m0">file</a>) ) {
00198       fprintf(stderr, <font class="stringliteral">"mol2plugin: No atom record found in file.\n"</font>);
00199       <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a4">MOLFILE_ERROR</a>;
00200     }
00201   } <font class="keywordflow">while</font> ( strncmp(line, <font class="stringliteral">"@&lt;TRIPOS&gt;BOND"</font>, 13) );
00202 
00203   <font class="comment">// Read the bonds</font>
00204   bond_index = 0;
00205   <font class="keywordflow">for</font> (i = 0; i &lt; mol2-&gt;<a class="code" href="structmol2data.html#m3">nbonds</a>; i++) {
00206     fgets(line, <a class="code" href="mol2plugin_8C.html#a0">LINESIZE</a>, mol2-&gt;<a class="code" href="structmol2data.html#m0">file</a>);
00207     <font class="keywordflow">if</font> ( ferror(mol2-&gt;<a class="code" href="structmol2data.html#m0">file</a>) || feof(mol2-&gt;<a class="code" href="structmol2data.html#m0">file</a>) ) {
00208       fprintf(stderr, <font class="stringliteral">"mol2plugin: Error occurred reading atom record.\n"</font>);
00209       <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a4">MOLFILE_ERROR</a>;
00210     }
00211 
00212     <font class="comment">//Move on if the next line is a header</font>
00213     <font class="keywordflow">if</font> (strncmp(line, <font class="stringliteral">"@"</font>, 1) == 0) {
00214       <font class="comment">//Then the bonds are over</font>
00215       <font class="keywordflow">break</font>;
00216     }
00217 
00218     match = sscanf(line, <font class="stringliteral">" %*d %d %d %s"</font>, &amp;bond_from, &amp;bond_to, bond_type);
00219     <font class="keywordflow">if</font> (match &lt; 3) {
00220       fprintf(stderr, <font class="stringliteral">"mol2plugin: Improperly formatted bond record.\n"</font>);
00221       <font class="keywordflow">continue</font>;
00222     }
00223     <font class="keywordflow">if</font> ( strncmp(bond_type, <font class="stringliteral">"nc"</font>, 2) == 0 ) {
00224       <font class="comment">// Not an actual bond, don't add it to the list</font>
00225       current_nbonds--;
00226     }
00227     <font class="keywordflow">else</font> {
00228       <font class="comment">// Add the bond to the list</font>
00229       curr_order=strtod(bond_type,NULL);
00230       <font class="keywordflow">if</font> (curr_order&lt;1.0 || curr_order&gt;4.0) curr_order=1;
00231 <font class="comment">//      fprintf(stdout,"mol2plugin: Bond from %d to %d of order %f\n", bond_from, bond_to, curr_order);</font>
00232       mol2-&gt;<a class="code" href="structmol2data.html#m6">from</a>[bond_index] = bond_from;
00233       mol2-&gt;<a class="code" href="structmol2data.html#m7">to</a>[bond_index] = bond_to;
00234       mol2-&gt;<a class="code" href="structmol2data.html#m8">bondorder</a>[bond_index]=curr_order;
00235       bond_index++;
00236     }
00237   }
00238   <font class="keywordflow">if</font> (bond_index &gt; 0) {
00239     *nbonds = current_nbonds;
00240     *fromptr = mol2-&gt;<a class="code" href="structmol2data.html#m6">from</a>;
00241     *toptr = mol2-&gt;<a class="code" href="structmol2data.html#m7">to</a>;
00242     *bondorderptr = mol2-&gt;<a class="code" href="structmol2data.html#m8">bondorder</a>; 
00243   } <font class="keywordflow">else</font> {
00244     printf(<font class="stringliteral">"mol2plugin) WARNING: no bonds defined in mol2 file\n"</font>);
00245     *nbonds = 0;
00246     *fromptr = NULL;
00247     *toptr = NULL;
00248     *bondorderptr = NULL; 
00249   }
00250     
00251 <font class="comment">//printf("End of read_mol2_bonds\n");</font>
00252   <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a2">MOLFILE_SUCCESS</a>;
00253 }
00254 
00255 
00256 <font class="comment">// Read atom coordinates</font>
<a name="l00257"></a><a class="code" href="mol2plugin_8C.html#a5">00257</a> <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="mol2plugin_8C.html#a5">read_mol2_timestep</a>(<font class="keywordtype">void</font> *v, <font class="keywordtype">int</font> natoms, <a class="code" href="structmolfile__timestep__t.html">molfile_timestep_t</a> *ts) {
00258   <a class="code" href="structmol2data.html">mol2data</a> *mol2 = (<a class="code" href="structmol2data.html">mol2data</a> *)v;
00259   <font class="keywordtype">char</font> line[<a class="code" href="mol2plugin_8C.html#a0">LINESIZE</a>];
00260   <font class="keywordtype">int</font> i, match;
00261   <font class="keywordtype">float</font> x, y, z;
00262 
00263   <font class="comment">// Since the file is rewound when coordinates are read, EOF shouldn't</font>
00264   <font class="comment">// happen. Instead, use a flag to indicate that the single timestep has</font>
00265   <font class="comment">// been read</font>
00266   <font class="keywordflow">if</font> (mol2-&gt;<a class="code" href="structmol2data.html#m5">coords_read</a>) {
00267     <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a3">MOLFILE_EOF</a>;
00268   }
00269 
00270   <font class="comment">// Find and read the ATOM record</font>
00271   rewind(mol2-&gt;<a class="code" href="structmol2data.html#m0">file</a>);
00272   <font class="keywordflow">do</font> {
00273     fgets(line, <a class="code" href="mol2plugin_8C.html#a0">LINESIZE</a>, mol2-&gt;<a class="code" href="structmol2data.html#m0">file</a>);
00274     <font class="keywordflow">if</font> ( ferror(mol2-&gt;<a class="code" href="structmol2data.html#m0">file</a>) || feof(mol2-&gt;<a class="code" href="structmol2data.html#m0">file</a>) ) {
00275       fprintf(stderr, <font class="stringliteral">"mol2plugin: No atom record found in file.\n"</font>);
00276       <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a4">MOLFILE_ERROR</a>;
00277     }
00278   } <font class="keywordflow">while</font> ( strncmp(line, <font class="stringliteral">"@&lt;TRIPOS&gt;ATOM"</font>, 13) );
00279 
00280   <font class="comment">// Read the atoms</font>
00281   <font class="keywordflow">for</font> (i = 0; i &lt; mol2-&gt;<a class="code" href="structmol2data.html#m2">natoms</a>; i++) {
00282     fgets(line, <a class="code" href="mol2plugin_8C.html#a0">LINESIZE</a>, mol2-&gt;<a class="code" href="structmol2data.html#m0">file</a>);
00283     <font class="keywordflow">if</font> ( ferror(mol2-&gt;<a class="code" href="structmol2data.html#m0">file</a>) || feof(mol2-&gt;<a class="code" href="structmol2data.html#m0">file</a>) ) {
00284       fprintf(stderr, <font class="stringliteral">"mol2plugin: Error occurred reading atom coordinates.\n"</font>);
00285       <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a4">MOLFILE_ERROR</a>;
00286     }
00287 
00288 
00289     match = sscanf(line, <font class="stringliteral">" %*d %*s %f %f %f"</font>, &amp;x, &amp;y, &amp;z);
00290     <font class="keywordflow">if</font> (match &lt; 3) {
00291       fprintf(stderr, <font class="stringliteral">"mol2plugin: Improperly formatted atom coordinates.\n"</font>);
00292       <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a4">MOLFILE_ERROR</a>;
00293     }
00294 
00295     <font class="keywordflow">if</font> (ts) {
00296       ts-&gt;<a class="code" href="structmolfile__timestep__t.html#m0">coords</a>[3*i  ] = x;
00297       ts-&gt;<a class="code" href="structmolfile__timestep__t.html#m0">coords</a>[3*i+1] = y;
00298       ts-&gt;<a class="code" href="structmolfile__timestep__t.html#m0">coords</a>[3*i+2] = z;
00299     }
00300   }
00301 
00302   mol2-&gt;<a class="code" href="structmol2data.html#m5">coords_read</a> = 1;
00303   <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a2">MOLFILE_SUCCESS</a>;
00304 }
00305 
00306 
<a name="l00307"></a><a class="code" href="mol2plugin_8C.html#a6">00307</a> <font class="keyword">static</font> <font class="keywordtype">void</font> *<a class="code" href="mol2plugin_8C.html#a6">open_mol2_write</a>(<font class="keyword">const</font> <font class="keywordtype">char</font> *filename, <font class="keyword">const</font> <font class="keywordtype">char</font> *filetype, 
00308                            <font class="keywordtype">int</font> natoms) {
00309   FILE *fd;
00310   <a class="code" href="structmol2data.html">mol2data</a> *data;
00311 
00312   fd = fopen(filename, <font class="stringliteral">"w"</font>);
00313   <font class="keywordflow">if</font> (!fd) { 
00314     fprintf(stderr, <font class="stringliteral">"Error) Unable to open mol2 file %s for writing\n"</font>,
00315             filename);
00316     <font class="keywordflow">return</font> NULL;
00317   }
00318   
00319   data = (<a class="code" href="structmol2data.html">mol2data</a> *)malloc(<font class="keyword">sizeof</font>(<a class="code" href="structmol2data.html">mol2data</a>));
00320   data-&gt;<a class="code" href="structmol2data.html#m2">natoms</a> = natoms;
00321   data-&gt;<a class="code" href="structmol2data.html#m0">file</a> = fd;
00322 <font class="comment">//  data-&gt;file_name = strdup(filename);</font>
00323   <font class="keywordflow">return</font> data;
00324 }
00325 
00326 
<a name="l00327"></a><a class="code" href="mol2plugin_8C.html#a7">00327</a> <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="mol2plugin_8C.html#a7">write_mol2_structure</a>(<font class="keywordtype">void</font> *mydata, <font class="keywordtype">int</font> optflags, 
00328                                <font class="keyword">const</font> <a class="code" href="structmolfile__atom__t.html">molfile_atom_t</a> *atoms) {
00329   <a class="code" href="structmol2data.html">mol2data</a> *data = (<a class="code" href="structmol2data.html">mol2data</a> *)mydata;
00330   data-&gt;<a class="code" href="structmol2data.html#m1">atomlist</a> = (<a class="code" href="structmolfile__atom__t.html">molfile_atom_t</a> *)malloc(data-&gt;<a class="code" href="structmol2data.html#m2">natoms</a>*<font class="keyword">sizeof</font>(<a class="code" href="structmolfile__atom__t.html">molfile_atom_t</a>));
00331   memcpy(data-&gt;<a class="code" href="structmol2data.html#m1">atomlist</a>, atoms, data-&gt;<a class="code" href="structmol2data.html#m2">natoms</a>*<font class="keyword">sizeof</font>(<a class="code" href="structmolfile__atom__t.html">molfile_atom_t</a>));
00332   <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a2">MOLFILE_SUCCESS</a>;
00333 }
00334 
<a name="l00335"></a><a class="code" href="mol2plugin_8C.html#a8">00335</a> <font class="keywordtype">void</font> <a class="code" href="mol2plugin_8C.html#a8">getmol2ff</a>(<font class="keywordtype">char</font>* outputtype, <font class="keyword">const</font> <font class="keywordtype">char</font>* psftype) {
00336 <font class="comment">//fprintf(stdout,"Doing ff typing on %s\n",psftype);</font>
00337   <font class="keywordflow">if</font> (strncmp(psftype,<font class="stringliteral">"H"</font>,1)==0) {
00338     <font class="comment">//It's a hydrogen</font>
00339     strncpy(outputtype, <font class="stringliteral">"H   "</font>,4);
00340     <font class="keywordflow">return</font>;
00341   } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (strncmp(psftype,<font class="stringliteral">"C"</font>,1)==0) {
00342     <font class="comment">//It's a carbon... probably</font>
00343     <font class="keywordflow">if</font> (strncmp(psftype,<font class="stringliteral">"C "</font>,2)==0 || strncmp(psftype,<font class="stringliteral">"CA "</font>,3)==0 || strncmp(psftype,<font class="stringliteral">"CPH"</font>,3)==0 || strncmp(psftype,<font class="stringliteral">"CPT"</font>,3)==0 || strncmp(psftype,<font class="stringliteral">"CC "</font>,3)==0 || strncmp(psftype,<font class="stringliteral">"CD "</font>,3)==0 || strncmp(psftype,<font class="stringliteral">"CN1"</font>,3)==0 || strncmp(psftype,<font class="stringliteral">"CN2"</font>,3)==0 || strncmp(psftype,<font class="stringliteral">"CN3"</font>,3)==0 || strncmp(psftype,<font class="stringliteral">"CN4"</font>,3)==0 || strncmp(psftype,<font class="stringliteral">"CN5"</font>,3)==0 || strncmp(psftype,<font class="stringliteral">"CNA"</font>,3)==0) {
00344           strncpy(outputtype, <font class="stringliteral">"C.2 "</font>,4);
00345           <font class="keywordflow">return</font>;
00346     } <font class="keywordflow">else</font> {
00347           strncpy(outputtype, <font class="stringliteral">"C.3 "</font>,4);
00348           <font class="keywordflow">return</font>;
00349     }  
00350   } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (strncmp(psftype,<font class="stringliteral">"N"</font>,1)==0) {
00351      <font class="comment">//It"s probably nitrogen</font>
00352      <font class="keywordflow">if</font> (strncmp(psftype,<font class="stringliteral">"NR"</font>,2)==0 || strncmp(psftype,<font class="stringliteral">"NH1"</font>,3)==0 || strncmp(psftype,<font class="stringliteral">"NH2"</font>,3)==0 || strncmp(psftype,<font class="stringliteral">"NC2"</font>,3)==0 || strncmp(psftype,<font class="stringliteral">"NY"</font>,2)==0 || (strncmp(psftype,<font class="stringliteral">"NN"</font>,2)==0 &amp;&amp; strncmp(psftype,<font class="stringliteral">"NN6"</font>,3)!=0)) {
00353        strncpy(outputtype, <font class="stringliteral">"N.am"</font>,4);
00354        <font class="keywordflow">return</font>;
00355        } <font class="keywordflow">else</font> {
00356        strncpy(outputtype, <font class="stringliteral">"N.3 "</font>,4);
00357        <font class="keywordflow">return</font>;
00358        }
00359   } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (strncmp(psftype,<font class="stringliteral">"O"</font>,1)==0) {
00360      <font class="comment">//Probably an oxygen</font>
00361      <font class="keywordflow">if</font> (strncmp(psftype,<font class="stringliteral">"OH1"</font>,3)==0 || strncmp(psftype,<font class="stringliteral">"OS"</font>,2)==0 || strncmp(psftype,<font class="stringliteral">"OT "</font>,3)==0 || strncmp(psftype,<font class="stringliteral">"ON4"</font>,3)==0 || strncmp(psftype,<font class="stringliteral">"ON5"</font>,3)==0 || strncmp(psftype,<font class="stringliteral">"ON6"</font>,3)==0) {
00362         strncpy(outputtype, <font class="stringliteral">"O.3 "</font>,4);
00363         <font class="keywordflow">return</font>;
00364      } <font class="keywordflow">else</font> {
00365         strncpy(outputtype, <font class="stringliteral">"O.2 "</font>,4);
00366         <font class="keywordflow">return</font>;
00367      } 
00368   } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (strncmp(psftype,<font class="stringliteral">"S"</font>,1)==0) {
00369      strncpy(outputtype, <font class="stringliteral">"S.3 "</font>,4);
00370      <font class="keywordflow">return</font>;
00371   } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (strncmp(psftype,<font class="stringliteral">"P"</font>,1)==0) {
00372      strncpy(outputtype, <font class="stringliteral">"P.3 "</font>,4);
00373      <font class="keywordflow">return</font>;
00374   } <font class="keywordflow">else</font> {
00375      strncpy(outputtype, <font class="stringliteral">"X.  "</font>,4);
00376      <font class="keywordflow">return</font>;
00377   }
00378 }
00379 
00380 
00381 
00382 
00383 
00384 
<a name="l00385"></a><a class="code" href="mol2plugin_8C.html#a9">00385</a> <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="mol2plugin_8C.html#a9">write_mol2_timestep</a>(<font class="keywordtype">void</font> *mydata, <font class="keyword">const</font> <a class="code" href="structmolfile__timestep__t.html">molfile_timestep_t</a> *ts) {
00386   <a class="code" href="structmol2data.html">mol2data</a> *data = (<a class="code" href="structmol2data.html">mol2data</a> *)mydata; 
00387   <font class="keyword">const</font> <a class="code" href="structmolfile__atom__t.html">molfile_atom_t</a> *atom;
00388   <font class="keyword">const</font> <font class="keywordtype">float</font> *pos;
00389   <font class="keywordtype">float</font> chrgsq;
00390   <font class="keywordtype">int</font> i;
00391 
00392   <font class="comment">// try to guess whether we have charge information.</font>
00393   chrgsq=0.0;
00394   atom = data-&gt;<a class="code" href="structmol2data.html#m1">atomlist</a>;
00395   <font class="keywordflow">for</font> (i = 0; i &lt; data-&gt;<a class="code" href="structmol2data.html#m2">natoms</a>; i++) {
00396       chrgsq += atom-&gt;<a class="code" href="structmolfile__atom__t.html#m11">charge</a>*atom-&gt;<a class="code" href="structmolfile__atom__t.html#m11">charge</a>;
00397       ++atom;
00398   }
00399 
00400   <font class="comment">//print header block</font>
00401   fprintf(data-&gt;<a class="code" href="structmol2data.html#m0">file</a>, <font class="stringliteral">"@&lt;TRIPOS&gt;MOLECULE\n"</font>);
00402   fprintf(data-&gt;<a class="code" href="structmol2data.html#m0">file</a>, <font class="stringliteral">"generated by VMD\n"</font>);
00403   fprintf(data-&gt;<a class="code" href="structmol2data.html#m0">file</a>, <font class="stringliteral">"%4d %4d 1 0 0\n"</font>, data-&gt;<a class="code" href="structmol2data.html#m2">natoms</a>, data-&gt;<a class="code" href="structmol2data.html#m3">nbonds</a>);
00404   fprintf(data-&gt;<a class="code" href="structmol2data.html#m0">file</a>, <font class="stringliteral">"SMALL\n"</font>);
00405   <font class="comment">// educated guess</font>
00406   <font class="keywordflow">if</font> (chrgsq &gt; 0.0001) {
00407       fprintf(data-&gt;<a class="code" href="structmol2data.html#m0">file</a>, <font class="stringliteral">"USER_CHARGES\n"</font>);
00408   } <font class="keywordflow">else</font> {
00409       fprintf(data-&gt;<a class="code" href="structmol2data.html#m0">file</a>, <font class="stringliteral">"NO_CHARGES\n"</font>);
00410   }
00411   fprintf(data-&gt;<a class="code" href="structmol2data.html#m0">file</a>, <font class="stringliteral">"****\n"</font>);
00412   fprintf(data-&gt;<a class="code" href="structmol2data.html#m0">file</a>, <font class="stringliteral">"Energy = 0\n\n"</font>);
00413   
00414   <font class="comment">//print atoms block</font>
00415   fprintf(data-&gt;<a class="code" href="structmol2data.html#m0">file</a>, <font class="stringliteral">"@&lt;TRIPOS&gt;ATOM\n"</font>);
00416   atom = data-&gt;<a class="code" href="structmol2data.html#m1">atomlist</a>;
00417   pos = ts-&gt;<a class="code" href="structmolfile__timestep__t.html#m0">coords</a>;
00418   <font class="keywordtype">char</font> mol2fftype[5];
00419   <font class="keywordflow">for</font> (i = 0; i &lt; data-&gt;<a class="code" href="structmol2data.html#m2">natoms</a>; i++) {
00420     <a class="code" href="mol2plugin_8C.html#a8">getmol2ff</a>(mol2fftype, atom-&gt;<a class="code" href="structmolfile__atom__t.html#m1">type</a>);
00421     fprintf(data-&gt;<a class="code" href="structmol2data.html#m0">file</a>, <font class="stringliteral">"%7d %-4s      %8.4f  %8.4f  %8.4f %4s %4d  %3s        %8.6f\n"</font>,
00422             i+1, atom-&gt;<a class="code" href="structmolfile__atom__t.html#m0">name</a>, pos[0], pos[1], pos[2], mol2fftype, 
00423             atom-&gt;<a class="code" href="structmolfile__atom__t.html#m3">resid</a>, atom-&gt;<a class="code" href="structmolfile__atom__t.html#m2">resname</a>, atom-&gt;<a class="code" href="structmolfile__atom__t.html#m11">charge</a>);
00424     ++atom; 
00425     pos += 3;
00426   }
00427 
00428   <font class="comment">//print bond info</font>
00429 
00430   <font class="keywordtype">int</font> j; <font class="comment">//temp variable</font>
00431   <font class="keywordtype">int</font> k; <font class="comment">// temp variable</font>
00432   <font class="keywordtype">int</font> l=1; <font class="comment">//number of bond record</font>
00433   printf(<font class="stringliteral">"mol2plugin) numbonds: %d\n"</font>, data-&gt;<a class="code" href="structmol2data.html#m3">nbonds</a>);
00434   <font class="keywordflow">if</font> (data-&gt;<a class="code" href="structmol2data.html#m3">nbonds</a>&gt;0) fprintf(data-&gt;<a class="code" href="structmol2data.html#m0">file</a>, <font class="stringliteral">"@&lt;TRIPOS&gt;BOND\n"</font>);
00435   <font class="keywordflow">for</font> (i=0; i&lt;data-&gt;<a class="code" href="structmol2data.html#m3">nbonds</a>; i++) {
00436     <font class="comment">//For mol2, only write bonds for fromptr[i]&lt;toptr[i]</font>
00437     j=data-&gt;<a class="code" href="structmol2data.html#m6">from</a>[i];
00438     k=data-&gt;<a class="code" href="structmol2data.html#m7">to</a>[i];
00439     <font class="comment">// bondorder is either 1, 2, 3 or a textual representation: am,ar,du,un,nc</font>
00440     <font class="comment">// we don't have the info for the text, so we truncate to integer.</font>
00441     fprintf(data-&gt;<a class="code" href="structmol2data.html#m0">file</a>, <font class="stringliteral">"%5d %5d %5d %2d\n"</font>, l ,data-&gt;<a class="code" href="structmol2data.html#m6">from</a>[i], data-&gt;<a class="code" href="structmol2data.html#m7">to</a>[i],
00442             (<font class="keywordtype">int</font>)data-&gt;<a class="code" href="structmol2data.html#m8">bondorder</a>[i]);
00443     l++;
00444 <font class="comment">//    printf("  from: %8d   to: %8d\n", fromptr[i], toptr[i]);</font>
00445   } 
00446 
00447   <font class="comment">// Print out substructure info to keep some programs sane</font>
00448   fprintf(data-&gt;<a class="code" href="structmol2data.html#m0">file</a>,<font class="stringliteral">"\n@&lt;TRIPOS&gt;SUBSTRUCTURE\n"</font>);
00449   fprintf(data-&gt;<a class="code" href="structmol2data.html#m0">file</a>,<font class="stringliteral">"1 ****        1 TEMP                        "</font>);
00450   fprintf(data-&gt;<a class="code" href="structmol2data.html#m0">file</a>,<font class="stringliteral">"0 ****  **** 0 ROOT\n"</font>);
00451 
00452   <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a2">MOLFILE_SUCCESS</a>;
00453 }
00454 
<a name="l00455"></a><a class="code" href="mol2plugin_8C.html#a10">00455</a> <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="xbgfplugin_8C.html#a13">write_bonds</a>(<font class="keywordtype">void</font> *v, <font class="keywordtype">int</font> nbonds, <font class="keywordtype">int</font> *fromptr, <font class="keywordtype">int</font> *toptr, <font class="keywordtype">float</font> *bondorderptr) {
00456   <a class="code" href="structmol2data.html">mol2data</a> *data = (<a class="code" href="structmol2data.html">mol2data</a> *)v;
00457   data-&gt;<a class="code" href="structmol2data.html#m6">from</a> = <font class="keyword">new</font> <font class="keywordtype">int</font>[nbonds];
00458   data-&gt;<a class="code" href="structmol2data.html#m7">to</a> = <font class="keyword">new</font> <font class="keywordtype">int</font>[nbonds];
00459   data-&gt;<a class="code" href="structmol2data.html#m8">bondorder</a> = <font class="keyword">new</font> <font class="keywordtype">float</font>[nbonds];
00460   <font class="comment">//set the pointers for use later</font>
00461   <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i=0;i&lt;nbonds;i++) {
00462           data-&gt;<a class="code" href="structmol2data.html#m6">from</a>[i]=fromptr[i];
00463           data-&gt;<a class="code" href="structmol2data.html#m7">to</a>[i]=toptr[i];
00464           data-&gt;<a class="code" href="structmol2data.html#m8">bondorder</a>[i]=bondorderptr[i];
00465   }
00466   data-&gt;<a class="code" href="structmol2data.html#m3">nbonds</a> = nbonds;
00467   <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a2">MOLFILE_SUCCESS</a>;
00468 }
00469 
00470 
<a name="l00471"></a><a class="code" href="mol2plugin_8C.html#a11">00471</a> <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="mol2plugin_8C.html#a11">close_mol2_write</a>(<font class="keywordtype">void</font> *mydata) {
00472   <a class="code" href="structmol2data.html">mol2data</a> *data = (<a class="code" href="structmol2data.html">mol2data</a> *)mydata;
00473   <font class="keywordflow">if</font> (data) {
00474     <font class="keywordflow">if</font> (data-&gt;<a class="code" href="structmol2data.html#m0">file</a>) fclose(data-&gt;<a class="code" href="structmol2data.html#m0">file</a>);
00475     <font class="keywordflow">if</font> (data-&gt;<a class="code" href="structmol2data.html#m6">from</a> != NULL) free(data-&gt;<a class="code" href="structmol2data.html#m6">from</a>);
00476     <font class="keywordflow">if</font> (data-&gt;<a class="code" href="structmol2data.html#m7">to</a> != NULL)   free(data-&gt;<a class="code" href="structmol2data.html#m7">to</a>);
00477     <font class="keywordflow">if</font> (data-&gt;<a class="code" href="structmol2data.html#m8">bondorder</a> != NULL)   free(data-&gt;<a class="code" href="structmol2data.html#m8">bondorder</a>);
00478     <font class="keyword">delete</font> data;
00479   }
00480 }
00481 
00482 <font class="comment">//</font>
00483 <font class="comment">// Free the memory used by the mol2 structure</font>
<a name="l00484"></a><a class="code" href="mol2plugin_8C.html#a12">00484</a> <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="mol2plugin_8C.html#a12">close_mol2_read</a>(<font class="keywordtype">void</font> *v) {
00485   <a class="code" href="structmol2data.html">mol2data</a> *mol2 = (<a class="code" href="structmol2data.html">mol2data</a> *)v;
00486   <font class="keywordflow">if</font> (mol2) {
00487     <font class="keywordflow">if</font> (mol2-&gt;<a class="code" href="structmol2data.html#m0">file</a>) fclose(mol2-&gt;<a class="code" href="structmol2data.html#m0">file</a>);
00488     <font class="keywordflow">if</font> (mol2-&gt;<a class="code" href="structmol2data.html#m6">from</a> != NULL) free(mol2-&gt;<a class="code" href="structmol2data.html#m6">from</a>);
00489     <font class="keywordflow">if</font> (mol2-&gt;<a class="code" href="structmol2data.html#m7">to</a> != NULL)   free(mol2-&gt;<a class="code" href="structmol2data.html#m7">to</a>);
00490     <font class="keywordflow">if</font> (mol2-&gt;<a class="code" href="structmol2data.html#m8">bondorder</a> != NULL)   free(mol2-&gt;<a class="code" href="structmol2data.html#m8">bondorder</a>);
00491     <font class="keyword">delete</font> mol2;
00492   }
00493 }
00494 
00495 
<a name="l00496"></a><a class="code" href="mol2plugin_8C.html#a13">00496</a> <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="xbgfplugin_8C.html#a11">read_bonds</a>(<font class="keywordtype">void</font> *v, <font class="keywordtype">int</font> *nbonds, <font class="keywordtype">int</font> **fromptr, <font class="keywordtype">int</font> **toptr, <font class="keywordtype">float</font> **bondorderptr) {
00497   <a class="code" href="structmol2data.html">mol2data</a> *mol2 = (<a class="code" href="structmol2data.html">mol2data</a> *)v;
00498 
00499   <font class="comment">/* now read bond data */</font>
00500 <font class="comment">//  *nbonds = start_psf_bonds(psf-&gt;fp);</font>
00501 
00502   <font class="keywordflow">if</font> (mol2-&gt;<a class="code" href="structmol2data.html#m3">nbonds</a> &gt; 0) {
00503     mol2-&gt;<a class="code" href="structmol2data.html#m6">from</a> = (<font class="keywordtype">int</font> *) malloc(*nbonds*<font class="keyword">sizeof</font>(<font class="keywordtype">int</font>));
00504     mol2-&gt;<a class="code" href="structmol2data.html#m7">to</a> = (<font class="keywordtype">int</font> *) malloc(*nbonds*<font class="keyword">sizeof</font>(<font class="keywordtype">int</font>));
00505     mol2-&gt;<a class="code" href="structmol2data.html#m8">bondorder</a> = (<font class="keywordtype">float</font> *) malloc(*nbonds*<font class="keyword">sizeof</font>(<font class="keywordtype">float</font>));
00506     <font class="keywordflow">if</font> ((<a class="code" href="mol2plugin_8C.html#a4">read_mol2_bonds</a>(mol2, nbonds, &amp;(mol2-&gt;<a class="code" href="structmol2data.html#m6">from</a>), &amp;(mol2-&gt;<a class="code" href="structmol2data.html#m7">to</a>), &amp;(mol2-&gt;<a class="code" href="structmol2data.html#m8">bondorder</a>))) != <a class="code" href="molfile__plugin_8h.html#a2">MOLFILE_SUCCESS</a>) {
00507       fclose(mol2-&gt;<a class="code" href="structmol2data.html#m0">file</a>);
00508       mol2-&gt;<a class="code" href="structmol2data.html#m0">file</a> = NULL;
00509       <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a4">MOLFILE_ERROR</a>;
00510     }
00511     *fromptr = mol2-&gt;<a class="code" href="structmol2data.html#m6">from</a>;
00512     *toptr = mol2-&gt;<a class="code" href="structmol2data.html#m7">to</a>;
00513     *bondorderptr = mol2-&gt;<a class="code" href="structmol2data.html#m8">bondorder</a>; 
00514   } <font class="keywordflow">else</font> {
00515     printf(<font class="stringliteral">"mol2plugin) WARNING: no bonds defined in mol2 file.\n"</font>);
00516     *fromptr=NULL;
00517     *toptr=NULL;
00518     *bondorderptr=NULL;
00519   }
00520   <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a2">MOLFILE_SUCCESS</a>;
00521 }
00522 
<a name="l00523"></a><a class="code" href="mol2plugin_8C.html#a1">00523</a> <font class="keyword">static</font> <a class="code" href="structmolfile__plugin__t.html">molfile_plugin_t</a> <a class="code" href="mol2plugin_8C.html#a1">mol2plugin</a> = {
00524   <a class="code" href="vmdplugin_8h.html#a10">vmdplugin_ABIVERSION</a>,
00525   <a class="code" href="molfile__plugin_8h.html#a0">MOLFILE_PLUGIN_TYPE</a>,                         <font class="comment">/* type */</font>
00526   <font class="stringliteral">"mol2"</font>,                                      <font class="comment">/* short name */</font>
00527   <font class="stringliteral">"MDL mol2"</font>,                                  <font class="comment">/* pretty name */</font>
00528   <font class="stringliteral">"Peter Freddolino and Eamon Caddigan"</font>,       <font class="comment">/* author */</font>
00529   0,                                           <font class="comment">/* major version */</font>
00530   8,                                           <font class="comment">/* minor version */</font>
00531   <a class="code" href="vmdplugin_8h.html#a12">VMDPLUGIN_THREADSAFE</a>,                        <font class="comment">/* is reentrant */</font>
00532   <font class="stringliteral">"mol2"</font>,
00533   <a class="code" href="mol2plugin_8C.html#a2">open_mol2_read</a>,               <font class="comment">/*open file read*/</font>
00534   <a class="code" href="mol2plugin_8C.html#a3">read_mol2</a>,                    <font class="comment">/*read structure*/</font>
00535   <a class="code" href="mol2plugin_8C.html#a13">read_bonds</a>,                   <font class="comment">/* read bond list*/</font>
00536   <a class="code" href="mol2plugin_8C.html#a5">read_mol2_timestep</a>,           <font class="comment">/* read next timestep*/</font>
00537   <a class="code" href="mol2plugin_8C.html#a12">close_mol2_read</a>,              <font class="comment">/* close_file_read */</font>
00538   <a class="code" href="mol2plugin_8C.html#a6">open_mol2_write</a>,              <font class="comment">/* open file for writing */</font>
00539   <a class="code" href="mol2plugin_8C.html#a7">write_mol2_structure</a>,         <font class="comment">/* write structure */</font>
00540   <a class="code" href="mol2plugin_8C.html#a9">write_mol2_timestep</a>,          <font class="comment">/* write tempestep*/</font>
00541   <a class="code" href="mol2plugin_8C.html#a11">close_mol2_write</a>,             <font class="comment">/*close file for writing*/</font>
00542   0,                            <font class="comment">/* read_volumetric_metadata */</font>
00543   0,                            <font class="comment">/* read_volumetric_data */</font>
00544   0,                            <font class="comment">/* read_rawgraphics */</font>
00545   0,                            <font class="comment">/*read molecule metadata */</font>
00546   <a class="code" href="mol2plugin_8C.html#a10">write_bonds</a>                   <font class="comment">/* write bonds */</font>
00547 };
00548 
<a name="l00549"></a><a class="code" href="mol2plugin_8C.html#a14">00549</a> <a class="code" href="vmdplugin_8h.html#a7">VMDPLUGIN_API</a> <font class="keywordtype">int</font> <a class="code" href="vmdplugin_8h.html#a5">VMDPLUGIN_init</a>() {
00550   <font class="keywordflow">return</font> <a class="code" href="vmdplugin_8h.html#a13">VMDPLUGIN_SUCCESS</a>;
00551 }
00552 
<a name="l00553"></a><a class="code" href="mol2plugin_8C.html#a15">00553</a> <a class="code" href="vmdplugin_8h.html#a7">VMDPLUGIN_API</a> <font class="keywordtype">int</font> <a class="code" href="vmdplugin_8h.html#a3">VMDPLUGIN_register</a>(<font class="keywordtype">void</font> *v, <a class="code" href="vmdplugin_8h.html#a15">vmdplugin_register_cb</a> cb) {
00554   (*cb)(v, (<a class="code" href="structvmdplugin__t.html">vmdplugin_t</a> *)&amp;mol2plugin);
00555   <font class="keywordflow">return</font> <a class="code" href="vmdplugin_8h.html#a13">VMDPLUGIN_SUCCESS</a>;
00556 }
00557 
<a name="l00558"></a><a class="code" href="mol2plugin_8C.html#a16">00558</a> <a class="code" href="vmdplugin_8h.html#a7">VMDPLUGIN_API</a> <font class="keywordtype">int</font> <a class="code" href="vmdplugin_8h.html#a6">VMDPLUGIN_fini</a>() {
00559   <font class="keywordflow">return</font> <a class="code" href="vmdplugin_8h.html#a13">VMDPLUGIN_SUCCESS</a>;
00560 }
00561 
</pre></div><hr><address><small>Generated on Wed Mar 22 13:15:30 2006 for VMD Plugins (current) by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.14 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2002</small></address>
</body>
</html>
