<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>xyzplugin.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.14 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>xyzplugin.c</h1><a href="xyzplugin_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/***************************************************************************</font>
00002 <font class="comment"> *cr</font>
00003 <font class="comment"> *cr            (C) Copyright 1995-2006 The Board of Trustees of the</font>
00004 <font class="comment"> *cr                        University of Illinois</font>
00005 <font class="comment"> *cr                         All Rights Reserved</font>
00006 <font class="comment"> *cr</font>
00007 <font class="comment"> ***************************************************************************/</font>
00008 
00009 <font class="comment">/***************************************************************************</font>
00010 <font class="comment"> * RCS INFORMATION:</font>
00011 <font class="comment"> *</font>
00012 <font class="comment"> *      $RCSfile: xyzplugin.c,v $</font>
00013 <font class="comment"> *      $Author: johns $       $Locker:  $             $State: Exp $</font>
00014 <font class="comment"> *      $Revision: 1.31 $       $Date: 2006/02/23 19:36:46 $</font>
00015 <font class="comment"> *</font>
00016 <font class="comment"> ***************************************************************************/</font>
00017 
00018 <font class="comment">/*</font>
00019 <font class="comment"> *  XYZ molecule file format:</font>
00020 <font class="comment"> *    XYZ files are a simple molecule file format suitable for output</font>
00021 <font class="comment"> *    by homegrown software since they are very minimalistic.  They don't</font>
00022 <font class="comment"> *    even include bonding information.</font>
00023 <font class="comment"> *</font>
00024 <font class="comment"> *  [ # optional comment line ] comment line (can be blank)</font>
00025 <font class="comment"> *                              ^^^ note, this is not supported by the current</font>
00026 <font class="comment"> *                                  version of this plugin.</font>
00027 <font class="comment"> *  [ N                       ] # of atoms, required by this xyz reader plugin</font>
00028 <font class="comment"> *  [ molecule name           ] name of molecule (can be blank)</font>
00029 <font class="comment"> *  atom1 x y z [optional data] atom name followed by xyz coords </font>
00030 <font class="comment"> *  atom2 x y z [ ...         ] and (optionally) other data.</font>
00031 <font class="comment"> *  ...                         instead of atom name the atom number in </font>
00032 <font class="comment"> *  atomN x y z [ ...         ] the PTE can be given.</font>
00033 <font class="comment"> *                      </font>
00034 <font class="comment"> *  Note that this plugin currently ignores everything following the z </font>
00035 <font class="comment"> *  coordinate (the optional data fields).</font>
00036 <font class="comment"> */</font>
00037 
00038 <font class="preprocessor">#include "<a class="code" href="largefiles_8h.html">largefiles.h</a>"</font>   <font class="comment">/* platform dependent 64-bit file I/O defines */</font>
00039 
00040 <font class="preprocessor">#include &lt;stdio.h&gt;</font>
00041 <font class="preprocessor">#include &lt;stdlib.h&gt;</font>
00042 <font class="preprocessor">#include &lt;string.h&gt;</font>
00043 <font class="preprocessor">#include &lt;ctype.h&gt;</font>
00044 <font class="preprocessor">#include "<a class="code" href="molfile__plugin_8h.html">molfile_plugin.h</a>"</font>
00045 
00046 <font class="preprocessor">#include "<a class="code" href="periodic__table_8h.html">periodic_table.h</a>"</font>
00047 
<a name="l00048"></a><a class="code" href="structxyzdata.html">00048</a> <font class="keyword">typedef</font> <font class="keyword">struct </font>{
<a name="l00049"></a><a class="code" href="structxyzdata.html#m0">00049</a>   FILE *file;
<a name="l00050"></a><a class="code" href="structxyzdata.html#m1">00050</a>   <font class="keywordtype">int</font> numatoms;
<a name="l00051"></a><a class="code" href="structxyzdata.html#m2">00051</a>   <font class="keywordtype">char</font> *file_name;
<a name="l00052"></a><a class="code" href="structxyzdata.html#m3">00052</a>   <a class="code" href="structmolfile__atom__t.html">molfile_atom_t</a> *atomlist;
00053 } <a class="code" href="structxyzdata.html">xyzdata</a>;
00054  
<a name="l00055"></a><a class="code" href="xyzplugin_8c.html#a1">00055</a> <font class="keyword">static</font> <font class="keywordtype">void</font> *<a class="code" href="xyzplugin_8c.html#a1">open_xyz_read</a>(<font class="keyword">const</font> <font class="keywordtype">char</font> *filename, <font class="keyword">const</font> <font class="keywordtype">char</font> *filetype, 
00056                            <font class="keywordtype">int</font> *natoms) {
00057   FILE *fd;
00058   <a class="code" href="structxyzdata.html">xyzdata</a> *data;
00059   <font class="keywordtype">int</font> i;
00060 
00061   fd = fopen(filename, <font class="stringliteral">"rb"</font>);
00062   <font class="keywordflow">if</font> (!fd) <font class="keywordflow">return</font> NULL;
00063   
00064   data = (<a class="code" href="structxyzdata.html">xyzdata</a> *)malloc(<font class="keyword">sizeof</font>(<a class="code" href="structxyzdata.html">xyzdata</a>));
00065   data-&gt;<a class="code" href="structxyzdata.html#m0">file</a> = fd;
00066   data-&gt;<a class="code" href="structxyzdata.html#m2">file_name</a> = strdup(filename);
00067 
00068   <font class="comment">/* First line is the number of atoms   */</font>
00069   i = fscanf(data-&gt;<a class="code" href="structxyzdata.html#m0">file</a>, <font class="stringliteral">"%d"</font>, natoms);
00070   <font class="keywordflow">if</font> (i &lt; 1) {
00071     fprintf(stderr, <font class="stringliteral">"\n\nread) ERROR: xyz file '%s' should have the number of atoms in the first line.\n"</font>, filename);
00072     <font class="keywordflow">return</font> NULL;
00073   }
00074   data-&gt;<a class="code" href="structxyzdata.html#m1">numatoms</a>=*natoms;
00075 
00076   <font class="keywordflow">while</font> (getc(fd) != <font class="charliteral">'\n'</font>);
00077   <font class="comment">/* second line is a title or empty, so skip past it */</font>
00078   <font class="keywordflow">while</font> (getc(fd) != <font class="charliteral">'\n'</font>);
00079   
00080   <font class="keywordflow">return</font> data;
00081 }
00082 
<a name="l00083"></a><a class="code" href="xyzplugin_8c.html#a2">00083</a> <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="xyzplugin_8c.html#a2">read_xyz_structure</a>(<font class="keywordtype">void</font> *mydata, <font class="keywordtype">int</font> *optflags, 
00084                               <a class="code" href="structmolfile__atom__t.html">molfile_atom_t</a> *atoms) {
00085   <font class="keywordtype">int</font> i, j;
00086   <font class="keywordtype">char</font> *k;
00087   <font class="keywordtype">float</font> coord;
00088   <a class="code" href="structmolfile__atom__t.html">molfile_atom_t</a> *atom;
00089   <a class="code" href="structxyzdata.html">xyzdata</a> *data = (<a class="code" href="structxyzdata.html">xyzdata</a> *)mydata;
00090 
00091   <font class="comment">/* we set atom mass and VDW radius from the PTE. */</font>
00092   *optflags = <a class="code" href="molfile__plugin_8h.html#a16">MOLFILE_ATOMICNUMBER</a> | <a class="code" href="molfile__plugin_8h.html#a12">MOLFILE_MASS</a> | <a class="code" href="molfile__plugin_8h.html#a14">MOLFILE_RADIUS</a>; 
00093 
00094   <font class="keywordflow">for</font>(i=0; i&lt;data-&gt;<a class="code" href="structxyzdata.html#m1">numatoms</a>; i++) {
00095     <font class="keywordtype">char</font> buffer[1024], fbuffer[1024];
00096     k = fgets(fbuffer, 1024, data-&gt;<a class="code" href="structxyzdata.html#m0">file</a>);
00097     atom = atoms + i;
00098     j=sscanf(fbuffer, <font class="stringliteral">"%s %f %f %f"</font>, buffer, &amp;coord, &amp;coord, &amp;coord);
00099     <font class="keywordflow">if</font> (k == NULL) {
00100       fprintf(stderr, <font class="stringliteral">"xyz structure) missing atom(s) in file '%s'\n"</font>, data-&gt;<a class="code" href="structxyzdata.html#m2">file_name</a>);
00101       fprintf(stderr, <font class="stringliteral">"xyz structure) expecting '%d' atoms, found only '%d'\n"</font>, data-&gt;<a class="code" href="structxyzdata.html#m1">numatoms</a>, i);
00102       <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a4">MOLFILE_ERROR</a>;
00103     } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (j &lt; 4) {
00104       fprintf(stderr, <font class="stringliteral">"xyz structure) missing type or coordinate(s) in file '%s' for atom '%d'\n"</font>,
00105           data-&gt;<a class="code" href="structxyzdata.html#m2">file_name</a>, i+1);
00106       <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a4">MOLFILE_ERROR</a>;
00107     }
00108 
00109     <font class="comment">/* handle the case if the first item is an ordinal number </font>
00110 <font class="comment">     * from the PTE */</font>
00111     <font class="keywordflow">if</font> (isdigit(buffer[0])) {
00112       <font class="keywordtype">int</font> idx;
00113       idx = atoi(buffer);
00114       strncpy(atom-&gt;<a class="code" href="structmolfile__atom__t.html#m0">name</a>, get_pte_label(idx), <font class="keyword">sizeof</font>(atom-&gt;<a class="code" href="structmolfile__atom__t.html#m0">name</a>));
00115       atom-&gt;<a class="code" href="structmolfile__atom__t.html#m13">atomicnumber</a> = idx;
00116       atom-&gt;<a class="code" href="structmolfile__atom__t.html#m10">mass</a> = <a class="code" href="periodic__table_8h.html#a5">get_pte_mass</a>(idx);
00117       atom-&gt;<a class="code" href="structmolfile__atom__t.html#m12">radius</a> = <a class="code" href="periodic__table_8h.html#a6">get_pte_vdw_radius</a>(idx);
00118     } <font class="keywordflow">else</font> {
00119       <font class="keywordtype">int</font> idx;
00120       strncpy(atom-&gt;<a class="code" href="structmolfile__atom__t.html#m0">name</a>, buffer, <font class="keyword">sizeof</font>(atom-&gt;<a class="code" href="structmolfile__atom__t.html#m0">name</a>));
00121       idx = <a class="code" href="periodic__table_8h.html#a7">get_pte_idx</a>(buffer);
00122       atom-&gt;<a class="code" href="structmolfile__atom__t.html#m13">atomicnumber</a> = idx;
00123       atom-&gt;<a class="code" href="structmolfile__atom__t.html#m10">mass</a> = <a class="code" href="periodic__table_8h.html#a5">get_pte_mass</a>(idx);
00124       atom-&gt;<a class="code" href="structmolfile__atom__t.html#m12">radius</a> = <a class="code" href="periodic__table_8h.html#a6">get_pte_vdw_radius</a>(idx);
00125     }
00126     strncpy(atom-&gt;<a class="code" href="structmolfile__atom__t.html#m1">type</a>, atom-&gt;<a class="code" href="structmolfile__atom__t.html#m0">name</a>, <font class="keyword">sizeof</font>(atom-&gt;<a class="code" href="structmolfile__atom__t.html#m1">type</a>));
00127     atom-&gt;<a class="code" href="structmolfile__atom__t.html#m2">resname</a>[0] = <font class="charliteral">'\0'</font>;
00128     atom-&gt;<a class="code" href="structmolfile__atom__t.html#m3">resid</a> = 1;
00129     atom-&gt;<a class="code" href="structmolfile__atom__t.html#m5">chain</a>[0] = <font class="charliteral">'\0'</font>;
00130     atom-&gt;<a class="code" href="structmolfile__atom__t.html#m4">segid</a>[0] = <font class="charliteral">'\0'</font>;
00131     <font class="comment">/* skip to the end of line */</font>
00132   }
00133 
00134   rewind(data-&gt;<a class="code" href="structxyzdata.html#m0">file</a>);
00135   <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a2">MOLFILE_SUCCESS</a>;
00136 }
00137 
<a name="l00138"></a><a class="code" href="xyzplugin_8c.html#a3">00138</a> <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="xyzplugin_8c.html#a3">read_xyz_timestep</a>(<font class="keywordtype">void</font> *mydata, <font class="keywordtype">int</font> natoms, <a class="code" href="structmolfile__timestep__t.html">molfile_timestep_t</a> *ts) {
00139   <font class="keywordtype">int</font> i, j;
00140   <font class="keywordtype">char</font> atom_name[1024], fbuffer[1024], *k;
00141   <font class="keywordtype">float</font> x, y, z;
00142   
00143   <a class="code" href="structxyzdata.html">xyzdata</a> *data = (<a class="code" href="structxyzdata.html">xyzdata</a> *)mydata;
00144   
00145   <font class="comment">/* skip over the first two lines */</font>
00146   <font class="keywordflow">if</font> (NULL == fgets(fbuffer, 1024, data-&gt;<a class="code" href="structxyzdata.html#m0">file</a>))  <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a4">MOLFILE_ERROR</a>;
00147   <font class="keywordflow">if</font> (NULL == fgets(fbuffer, 1024, data-&gt;<a class="code" href="structxyzdata.html#m0">file</a>))  <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a4">MOLFILE_ERROR</a>;
00148 
00149   <font class="comment">/* read the coordinates */</font>
00150   <font class="keywordflow">for</font> (i=0; i&lt;natoms; i++) {
00151     k = fgets(fbuffer, 1024, data-&gt;<a class="code" href="structxyzdata.html#m0">file</a>);
00152 
00153     <font class="comment">/* Read in atom type, X, Y, Z, skipping any remaining data fields */</font>
00154     j = sscanf(fbuffer, <font class="stringliteral">"%s %f %f %f"</font>, atom_name, &amp;x, &amp;y, &amp;z);
00155     <font class="keywordflow">if</font> (k == NULL) {
00156       <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a4">MOLFILE_ERROR</a>;
00157     } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (j &lt; 4) {
00158       fprintf(stderr, <font class="stringliteral">"xyz timestep) missing type or coordinate(s) in file '%s' for atom '%d'\n"</font>,data-&gt;<a class="code" href="structxyzdata.html#m2">file_name</a>,i+1);
00159       <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a4">MOLFILE_ERROR</a>;
00160     } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (j &gt;= 4) {
00161       <font class="keywordflow">if</font> (ts != NULL) { 
00162         <font class="comment">/* only save coords if we're given a timestep pointer, */</font>
00163         <font class="comment">/* otherwise assume that VMD wants us to skip past it. */</font>
00164         ts-&gt;<a class="code" href="structmolfile__timestep__t.html#m0">coords</a>[3*i  ] = x;
00165         ts-&gt;<a class="code" href="structmolfile__timestep__t.html#m0">coords</a>[3*i+1] = y;
00166         ts-&gt;<a class="code" href="structmolfile__timestep__t.html#m0">coords</a>[3*i+2] = z;
00167       }
00168     } <font class="keywordflow">else</font> {
00169       <font class="keywordflow">break</font>;
00170     }
00171   }
00172   
00173   <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a2">MOLFILE_SUCCESS</a>;
00174 }
00175     
<a name="l00176"></a><a class="code" href="xyzplugin_8c.html#a4">00176</a> <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="xyzplugin_8c.html#a4">close_xyz_read</a>(<font class="keywordtype">void</font> *mydata) {
00177   <a class="code" href="structxyzdata.html">xyzdata</a> *data = (<a class="code" href="structxyzdata.html">xyzdata</a> *)mydata;
00178   fclose(data-&gt;<a class="code" href="structxyzdata.html#m0">file</a>);
00179   free(data-&gt;<a class="code" href="structxyzdata.html#m2">file_name</a>);
00180   free(data);
00181 }
00182 
00183 
<a name="l00184"></a><a class="code" href="xyzplugin_8c.html#a5">00184</a> <font class="keyword">static</font> <font class="keywordtype">void</font> *<a class="code" href="xyzplugin_8c.html#a5">open_xyz_write</a>(<font class="keyword">const</font> <font class="keywordtype">char</font> *filename, <font class="keyword">const</font> <font class="keywordtype">char</font> *filetype, 
00185                            <font class="keywordtype">int</font> natoms) {
00186   FILE *fd;
00187   <a class="code" href="structxyzdata.html">xyzdata</a> *data;
00188 
00189   fd = fopen(filename, <font class="stringliteral">"w"</font>);
00190   <font class="keywordflow">if</font> (!fd) { 
00191     fprintf(stderr, <font class="stringliteral">"Error) Unable to open xyz file %s for writing\n"</font>,
00192             filename);
00193     <font class="keywordflow">return</font> NULL;
00194   }
00195   
00196   data = (<a class="code" href="structxyzdata.html">xyzdata</a> *)malloc(<font class="keyword">sizeof</font>(<a class="code" href="structxyzdata.html">xyzdata</a>));
00197   data-&gt;<a class="code" href="structxyzdata.html#m1">numatoms</a> = natoms;
00198   data-&gt;<a class="code" href="structxyzdata.html#m0">file</a> = fd;
00199   data-&gt;<a class="code" href="structxyzdata.html#m2">file_name</a> = strdup(filename);
00200   <font class="keywordflow">return</font> data;
00201 }
00202 
<a name="l00203"></a><a class="code" href="xyzplugin_8c.html#a6">00203</a> <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="xyzplugin_8c.html#a6">write_xyz_structure</a>(<font class="keywordtype">void</font> *mydata, <font class="keywordtype">int</font> optflags, 
00204                                <font class="keyword">const</font> <a class="code" href="structmolfile__atom__t.html">molfile_atom_t</a> *atoms) {
00205   <a class="code" href="structxyzdata.html">xyzdata</a> *data = (<a class="code" href="structxyzdata.html">xyzdata</a> *)mydata;
00206   data-&gt;<a class="code" href="structxyzdata.html#m3">atomlist</a> = (<a class="code" href="structmolfile__atom__t.html">molfile_atom_t</a> *)malloc(data-&gt;<a class="code" href="structxyzdata.html#m1">numatoms</a>*<font class="keyword">sizeof</font>(<a class="code" href="structmolfile__atom__t.html">molfile_atom_t</a>));
00207   memcpy(data-&gt;<a class="code" href="structxyzdata.html#m3">atomlist</a>, atoms, data-&gt;<a class="code" href="structxyzdata.html#m1">numatoms</a>*<font class="keyword">sizeof</font>(<a class="code" href="structmolfile__atom__t.html">molfile_atom_t</a>));
00208   <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a2">MOLFILE_SUCCESS</a>;
00209 }
00210 
<a name="l00211"></a><a class="code" href="xyzplugin_8c.html#a7">00211</a> <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="xyzplugin_8c.html#a7">write_xyz_timestep</a>(<font class="keywordtype">void</font> *mydata, <font class="keyword">const</font> <a class="code" href="structmolfile__timestep__t.html">molfile_timestep_t</a> *ts) {
00212   <a class="code" href="structxyzdata.html">xyzdata</a> *data = (<a class="code" href="structxyzdata.html">xyzdata</a> *)mydata; 
00213   <font class="keyword">const</font> <a class="code" href="structmolfile__atom__t.html">molfile_atom_t</a> *atom;
00214   <font class="keyword">const</font> <font class="keywordtype">float</font> *pos;
00215   <font class="keywordtype">int</font> i;
00216 
00217   fprintf(data-&gt;<a class="code" href="structxyzdata.html#m0">file</a>, <font class="stringliteral">"%d\n"</font>, data-&gt;<a class="code" href="structxyzdata.html#m1">numatoms</a>);
00218   fprintf(data-&gt;<a class="code" href="structxyzdata.html#m0">file</a>, <font class="stringliteral">" generated by VMD\n"</font>);
00219   
00220   atom = data-&gt;<a class="code" href="structxyzdata.html#m3">atomlist</a>;
00221   pos = ts-&gt;<a class="code" href="structmolfile__timestep__t.html#m0">coords</a>;
00222   <font class="keywordflow">for</font> (i = 0; i &lt; data-&gt;<a class="code" href="structxyzdata.html#m1">numatoms</a>; ++i) {
00223     fprintf(data-&gt;<a class="code" href="structxyzdata.html#m0">file</a>, <font class="stringliteral">" %-2s %15.6f %15.6f %15.6f\n"</font>, 
00224             atom-&gt;<a class="code" href="structmolfile__atom__t.html#m1">type</a>, pos[0], pos[1], pos[2]);
00225     ++atom; 
00226     pos += 3;
00227   }
00228   <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a2">MOLFILE_SUCCESS</a>;
00229 }
00230 
00231 
<a name="l00232"></a><a class="code" href="xyzplugin_8c.html#a8">00232</a> <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="xyzplugin_8c.html#a8">close_xyz_write</a>(<font class="keywordtype">void</font> *mydata) {
00233   <a class="code" href="structxyzdata.html">xyzdata</a> *data = (<a class="code" href="structxyzdata.html">xyzdata</a> *)mydata;
00234   fclose(data-&gt;<a class="code" href="structxyzdata.html#m0">file</a>);
00235   free(data-&gt;<a class="code" href="structxyzdata.html#m3">atomlist</a>);
00236   free(data-&gt;<a class="code" href="structxyzdata.html#m2">file_name</a>);
00237   free(data);
00238 }
00239 
00240 <font class="comment">/* registration stuff */</font>
<a name="l00241"></a><a class="code" href="xyzplugin_8c.html#a0">00241</a> <font class="keyword">static</font> <a class="code" href="structmolfile__plugin__t.html">molfile_plugin_t</a> <a class="code" href="xyzplugin_8c.html#a0">xyzplugin</a> = {
00242   <a class="code" href="vmdplugin_8h.html#a10">vmdplugin_ABIVERSION</a>,
00243   <a class="code" href="molfile__plugin_8h.html#a0">MOLFILE_PLUGIN_TYPE</a>,                         <font class="comment">/* type */</font>
00244   <font class="stringliteral">"xyz"</font>,                                       <font class="comment">/* name */</font>
00245   <font class="stringliteral">"XYZ"</font>,                                       <font class="comment">/* name */</font>
00246   <font class="stringliteral">"Mauricio Carrillo Tripp, John E. Stone, Axel Kohlmeyer"</font>,    <font class="comment">/* author */</font>
00247   0,                                           <font class="comment">/* major version */</font>
00248   9,                                           <font class="comment">/* minor version */</font>
00249   <a class="code" href="vmdplugin_8h.html#a12">VMDPLUGIN_THREADSAFE</a>,                        <font class="comment">/* is reentrant */</font>
00250   <font class="stringliteral">"xyz"</font>,
00251   <a class="code" href="xyzplugin_8c.html#a1">open_xyz_read</a>,
00252   <a class="code" href="xyzplugin_8c.html#a2">read_xyz_structure</a>,
00253   0,
00254   <a class="code" href="xyzplugin_8c.html#a3">read_xyz_timestep</a>,
00255   <a class="code" href="xyzplugin_8c.html#a4">close_xyz_read</a>,
00256   <a class="code" href="xyzplugin_8c.html#a5">open_xyz_write</a>,
00257   <a class="code" href="xyzplugin_8c.html#a6">write_xyz_structure</a>,
00258   <a class="code" href="xyzplugin_8c.html#a7">write_xyz_timestep</a>,
00259   <a class="code" href="xyzplugin_8c.html#a8">close_xyz_write</a>,
00260   0,                            <font class="comment">/* read_volumetric_metadata */</font>
00261   0,                            <font class="comment">/* read_volumetric_data */</font>
00262   0                             <font class="comment">/* read_rawgraphics */</font>
00263 };
00264 
<a name="l00265"></a><a class="code" href="xyzplugin_8c.html#a9">00265</a> <a class="code" href="vmdplugin_8h.html#a7">VMDPLUGIN_API</a> <font class="keywordtype">int</font> <a class="code" href="vmdplugin_8h.html#a5">VMDPLUGIN_init</a>() {
00266   <font class="keywordflow">return</font> <a class="code" href="vmdplugin_8h.html#a13">VMDPLUGIN_SUCCESS</a>;
00267 }
00268 
<a name="l00269"></a><a class="code" href="xyzplugin_8c.html#a10">00269</a> <a class="code" href="vmdplugin_8h.html#a7">VMDPLUGIN_API</a> <font class="keywordtype">int</font> <a class="code" href="vmdplugin_8h.html#a3">VMDPLUGIN_register</a>(<font class="keywordtype">void</font> *v, <a class="code" href="vmdplugin_8h.html#a15">vmdplugin_register_cb</a> cb) {
00270   (*cb)(v, (<a class="code" href="structvmdplugin__t.html">vmdplugin_t</a> *)&amp;xyzplugin);
00271   <font class="keywordflow">return</font> <a class="code" href="vmdplugin_8h.html#a13">VMDPLUGIN_SUCCESS</a>;
00272 }
00273 
<a name="l00274"></a><a class="code" href="xyzplugin_8c.html#a11">00274</a> <a class="code" href="vmdplugin_8h.html#a7">VMDPLUGIN_API</a> <font class="keywordtype">int</font> <a class="code" href="vmdplugin_8h.html#a6">VMDPLUGIN_fini</a>() {
00275   <font class="keywordflow">return</font> <a class="code" href="vmdplugin_8h.html#a13">VMDPLUGIN_SUCCESS</a>;
00276 }
00277 
00278 
00279 <font class="preprocessor">#ifdef TEST_PLUGIN</font>
00280 <font class="preprocessor"></font>
00281 <font class="keywordtype">int</font> <a class="code" href="main_8c.html#a3">main</a>(<font class="keywordtype">int</font> argc, <font class="keywordtype">char</font> *argv[]) {
00282   <a class="code" href="structmolfile__timestep__t.html">molfile_timestep_t</a> timestep;
00283   <font class="keywordtype">void</font> *v;
00284   <font class="keywordtype">int</font> natoms;
00285   <font class="keywordtype">int</font> i, nsets, set;
00286 
00287   <font class="keywordflow">while</font> (--argc) {
00288     ++argv;
00289     v = <a class="code" href="xyzplugin_8c.html#a1">open_xyz_read</a>(*argv, <font class="stringliteral">"xyz"</font>, &amp;natoms);
00290     <font class="keywordflow">if</font> (!v) {
00291       fprintf(stderr, <font class="stringliteral">"open_xyz_read failed for file %s\n"</font>, *argv);
00292       <font class="keywordflow">return</font> 1;
00293     }
00294     fprintf(stderr, <font class="stringliteral">"open_xyz_read succeeded for file %s\n"</font>, *argv);
00295     fprintf(stderr, <font class="stringliteral">"number of atoms: %d\n"</font>, natoms);
00296 
00297     i = 0;
00298     timestep.<a class="code" href="structmolfile__timestep__t.html#m0">coords</a> = (<font class="keywordtype">float</font> *)malloc(3*<font class="keyword">sizeof</font>(<font class="keywordtype">float</font>)*natoms);
00299     <font class="keywordflow">while</font> (!<a class="code" href="xyzplugin_8c.html#a3">read_xyz_timestep</a>(v, natoms, &amp;timestep)) {
00300       i++;
00301     }
00302     fprintf(stderr, <font class="stringliteral">"ended read_next_timestep on frame %d\n"</font>, i);
00303 
00304     <a class="code" href="xyzplugin_8c.html#a4">close_xyz_read</a>(v);
00305   }
00306   <font class="keywordflow">return</font> 0;
00307 }
00308 
00309 <font class="preprocessor">#endif</font>
00310 <font class="preprocessor"></font>
</pre></div><hr><address><small>Generated on Wed Mar 22 13:15:32 2006 for VMD Plugins (current) by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.14 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2002</small></address>
</body>
</html>
