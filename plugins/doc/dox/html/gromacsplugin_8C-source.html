<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>gromacsplugin.C Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.14 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>gromacsplugin.C</h1><a href="gromacsplugin_8C.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/***************************************************************************</font>
00002 <font class="comment"> *cr</font>
00003 <font class="comment"> *cr            (C) Copyright 1995-2006 The Board of Trustees of the</font>
00004 <font class="comment"> *cr                        University of Illinois</font>
00005 <font class="comment"> *cr                         All Rights Reserved</font>
00006 <font class="comment"> *cr</font>
00007 <font class="comment"> ***************************************************************************/</font>
00008 
00009 <font class="comment">/***************************************************************************</font>
00010 <font class="comment"> * RCS INFORMATION:</font>
00011 <font class="comment"> *</font>
00012 <font class="comment"> *      $RCSfile: gromacsplugin.C,v $</font>
00013 <font class="comment"> *      $Author: johns $       $Locker:  $             $State: Exp $</font>
00014 <font class="comment"> *      $Revision: 1.42 $       $Date: 2006/02/24 00:57:10 $</font>
00015 <font class="comment"> *</font>
00016 <font class="comment"> ***************************************************************************/</font>
00017 
00018 <font class="preprocessor">#include "<a class="code" href="largefiles_8h.html">largefiles.h</a>"</font>   <font class="comment">/* platform dependent 64-bit file I/O defines */</font>
00019 
00020 <font class="preprocessor">#include &lt;math.h&gt;</font>
00021 <font class="preprocessor">#include &lt;stdio.h&gt;</font>
00022 <font class="preprocessor">#include &lt;stdlib.h&gt;</font>
00023 <font class="preprocessor">#include &lt;string.h&gt;</font>
00024 <font class="preprocessor">#include &lt;ctype.h&gt;</font>
00025 <font class="preprocessor">#include "<a class="code" href="Gromacs_8h.html">Gromacs.h</a>"</font>
00026 <font class="preprocessor">#include "<a class="code" href="molfile__plugin_8h.html">molfile_plugin.h</a>"</font>
00027 
00028 <font class="preprocessor">#if defined(_AIX)</font>
00029 <font class="preprocessor"></font><font class="preprocessor">#include &lt;strings.h&gt;</font>
00030 <font class="preprocessor">#endif</font>
00031 <font class="preprocessor"></font>
00032 <font class="preprocessor">#ifndef M_PI</font>
<a name="l00033"></a><a class="code" href="gromacsplugin_8C.html#a0">00033</a> <font class="preprocessor"></font><font class="preprocessor">#define M_PI           3.14159265358979323846</font>
00034 <font class="preprocessor"></font><font class="preprocessor">#endif</font>
00035 <font class="preprocessor"></font>
00036 <font class="preprocessor">#if defined(WIN32) || defined(WIN64)</font>
00037 <font class="preprocessor"></font><font class="preprocessor">#define strcasecmp stricmp</font>
00038 <font class="preprocessor"></font><font class="preprocessor">#endif</font>
00039 <font class="preprocessor"></font>
<a name="l00040"></a><a class="code" href="structgmxdata.html">00040</a> <font class="keyword">typedef</font> <font class="keyword">struct </font>{
<a name="l00041"></a><a class="code" href="structgmxdata.html#m0">00041</a>   <a class="code" href="structmd__file.html">md_file</a> *mf;
<a name="l00042"></a><a class="code" href="structgmxdata.html#m1">00042</a>   <font class="keywordtype">int</font> natoms;
<a name="l00043"></a><a class="code" href="structgmxdata.html#m2">00043</a>   <font class="keywordtype">int</font> step;
00044 } <a class="code" href="structgmxdata.html">gmxdata</a>;
00045 
<a name="l00046"></a><a class="code" href="gromacsplugin_8C.html#a7">00046</a> <font class="keyword">static</font> <font class="keywordtype">void</font> *<a class="code" href="gromacsplugin_8C.html#a7">open_gro_read</a>(<font class="keyword">const</font> <font class="keywordtype">char</font> *filename, <font class="keyword">const</font> <font class="keywordtype">char</font> *,
00047     <font class="keywordtype">int</font> *natoms) {
00048 
00049     <a class="code" href="structmd__file.html">md_file</a> *mf;
00050     <a class="code" href="structmd__header.html">md_header</a> mdh;
00051     <a class="code" href="structgmxdata.html">gmxdata</a> *gmx;
00052 
00053     mf = <a class="code" href="Gromacs_8h.html#a36">mdio_open</a>(filename, <a class="code" href="Gromacs_8h.html#a25">MDFMT_GRO</a>);
00054     <font class="keywordflow">if</font> (!mf) {
00055         fprintf(stderr, <font class="stringliteral">"Cannot open file '%s', %s\n"</font>,
00056                 filename, <a class="code" href="Gromacs_8h.html#a58">mdio_errmsg</a>(<a class="code" href="Gromacs_8h.html#a57">mdio_errno</a>()));
00057         <font class="keywordflow">return</font> NULL;
00058     }
00059 
00060     <font class="comment">// read in the header data (careful not to rewind!)</font>
00061     <font class="keywordflow">if</font> (<a class="code" href="Gromacs_8h.html#a40">gro_header</a>(mf, mdh.<a class="code" href="structmd__header.html#m0">title</a>, <a class="code" href="Gromacs_8h.html#a23">MAX_MDIO_TITLE</a>,
00062     &amp;mdh.<a class="code" href="structmd__header.html#m2">timeval</a>, &amp;mdh.<a class="code" href="structmd__header.html#m1">natoms</a>, 0) &lt; 0) {
00063         fprintf(stderr, <font class="stringliteral">"Cannot read header fromm '%s', %s\n"</font>,
00064             filename, <a class="code" href="Gromacs_8h.html#a58">mdio_errmsg</a>(<a class="code" href="Gromacs_8h.html#a57">mdio_errno</a>()));
00065             <font class="comment">// XXX should free the file handle...</font>
00066         <font class="keywordflow">return</font> NULL;
00067     }
00068     *natoms = mdh.<a class="code" href="structmd__header.html#m1">natoms</a>;
00069     gmx = <font class="keyword">new</font> <a class="code" href="structgmxdata.html">gmxdata</a>;
00070     gmx-&gt;<a class="code" href="structgmxdata.html#m0">mf</a> = mf;
00071     gmx-&gt;<a class="code" href="structgmxdata.html#m1">natoms</a> = mdh.<a class="code" href="structmd__header.html#m1">natoms</a>;
00072     <font class="keywordflow">return</font> gmx;
00073 }
00074 
<a name="l00075"></a><a class="code" href="gromacsplugin_8C.html#a8">00075</a> <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="gromacsplugin_8C.html#a8">read_gro_structure</a>(<font class="keywordtype">void</font> *mydata, <font class="keywordtype">int</font> *optflags,
00076     <a class="code" href="structmolfile__atom__t.html">molfile_atom_t</a> *atoms) {
00077 
00078   <a class="code" href="structmd__atom.html">md_atom</a> ma;
00079   <font class="keywordtype">char</font> buf[<a class="code" href="Gromacs_8h.html#a20">MAX_GRO_LINE</a> + 1];
00080   <a class="code" href="structgmxdata.html">gmxdata</a> *gmx = (<a class="code" href="structgmxdata.html">gmxdata</a> *)mydata;
00081  
00082   *optflags = <a class="code" href="molfile__plugin_8h.html#a8">MOLFILE_NOOPTIONS</a>; <font class="comment">// no optional data</font>
00083 
00084   <font class="comment">// read in each atom and add it into the molecule</font>
00085   <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = 0; i &lt; gmx-&gt;<a class="code" href="structgmxdata.html#m1">natoms</a>; i++) {
00086     <a class="code" href="structmolfile__atom__t.html">molfile_atom_t</a> *atom = atoms+i; 
00087     <font class="keywordflow">if</font> (<a class="code" href="Gromacs_8h.html#a41">gro_rec</a>(gmx-&gt;<a class="code" href="structgmxdata.html#m0">mf</a>, &amp;ma) &lt; 0) {
00088       fprintf(stderr, <font class="stringliteral">"Error reading atom %d from file, %s\n"</font>, i+1, 
00089               <a class="code" href="Gromacs_8h.html#a58">mdio_errmsg</a>(<a class="code" href="Gromacs_8h.html#a57">mdio_errno</a>()));
00090       <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a4">MOLFILE_ERROR</a>;
00091     }
00092     strcpy(atom-&gt;<a class="code" href="structmolfile__atom__t.html#m0">name</a>, ma.<a class="code" href="structmd__atom.html#m3">atomname</a>);
00093     strcpy(atom-&gt;<a class="code" href="structmolfile__atom__t.html#m1">type</a>, ma.<a class="code" href="structmd__atom.html#m3">atomname</a>);
00094     strcpy(atom-&gt;<a class="code" href="structmolfile__atom__t.html#m2">resname</a>, ma.<a class="code" href="structmd__atom.html#m1">resname</a>);
00095     atom-&gt;<a class="code" href="structmolfile__atom__t.html#m3">resid</a> = atoi(ma.<a class="code" href="structmd__atom.html#m0">resid</a>);
00096     atom-&gt;<a class="code" href="structmolfile__atom__t.html#m5">chain</a>[0] = <font class="charliteral">'\0'</font>;
00097     atom-&gt;<a class="code" href="structmolfile__atom__t.html#m4">segid</a>[0] = <font class="charliteral">'\0'</font>;
00098   }
00099   
00100   <font class="keywordflow">if</font> (<a class="code" href="Gromacs_8h.html#a61">mdio_readline</a>(gmx-&gt;<a class="code" href="structgmxdata.html#m0">mf</a>, buf, <a class="code" href="Gromacs_8h.html#a20">MAX_GRO_LINE</a> + 1, 0) &lt; 0) {
00101     fprintf(stderr, <font class="stringliteral">"Warning, error reading box, %s\n"</font>, 
00102       <a class="code" href="Gromacs_8h.html#a58">mdio_errmsg</a>(<a class="code" href="Gromacs_8h.html#a57">mdio_errno</a>())); 
00103   }
00104 
00105   rewind(gmx-&gt;<a class="code" href="structgmxdata.html#m0">mf</a>-&gt;<a class="code" href="structmd__file.html#m0">f</a>);
00106   <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a2">MOLFILE_SUCCESS</a>;
00107 }
00108 
<a name="l00109"></a><a class="code" href="gromacsplugin_8C.html#a9">00109</a> <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="gromacsplugin_8C.html#a9">read_gro_timestep</a>(<font class="keywordtype">void</font> *v, <font class="keywordtype">int</font> natoms, <a class="code" href="structmolfile__timestep__t.html">molfile_timestep_t</a> *ts) {
00110   <a class="code" href="structgmxdata.html">gmxdata</a> *gmx = (<a class="code" href="structgmxdata.html">gmxdata</a> *)v;
00111   <a class="code" href="structmd__ts.html">md_ts</a> mdts;
00112   memset(&amp;mdts, 0, <font class="keyword">sizeof</font>(<a class="code" href="structmd__ts.html">md_ts</a>));
00113   mdts.<a class="code" href="structmd__ts.html#m1">natoms</a> = natoms;
00114  
00115   <font class="keywordflow">if</font> (<a class="code" href="Gromacs_8h.html#a39">mdio_timestep</a>(gmx-&gt;<a class="code" href="structgmxdata.html#m0">mf</a>, &amp;mdts) &lt; 0) 
00116     <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a4">MOLFILE_ERROR</a>;
00117   <font class="keywordflow">if</font> (ts) {
00118     memcpy(ts-&gt;<a class="code" href="structmolfile__timestep__t.html#m0">coords</a>, mdts.<a class="code" href="structmd__ts.html#m0">pos</a>, 3 * <font class="keyword">sizeof</font>(<font class="keywordtype">float</font>) * gmx-&gt;<a class="code" href="structgmxdata.html#m1">natoms</a>);
00119     <font class="keywordflow">if</font> (mdts.<a class="code" href="structmd__ts.html#m4">box</a>) {
00120       ts-&gt;<a class="code" href="structmolfile__timestep__t.html#z4_0">A</a> = mdts.<a class="code" href="structmd__ts.html#m4">box</a>-&gt;<a class="code" href="structmd__box.html#m0">A</a>;
00121       ts-&gt;<a class="code" href="structmolfile__timestep__t.html#z4_1">B</a> = mdts.<a class="code" href="structmd__ts.html#m4">box</a>-&gt;<a class="code" href="structmd__box.html#m1">B</a>;
00122       ts-&gt;<a class="code" href="structmolfile__timestep__t.html#z4_2">C</a> = mdts.<a class="code" href="structmd__ts.html#m4">box</a>-&gt;<a class="code" href="structmd__box.html#m2">C</a>;
00123       ts-&gt;<a class="code" href="structmolfile__timestep__t.html#z4_3">alpha</a> = mdts.<a class="code" href="structmd__ts.html#m4">box</a>-&gt;<a class="code" href="structmd__box.html#m3">alpha</a>;
00124       ts-&gt;<a class="code" href="structmolfile__timestep__t.html#z4_4">beta</a> = mdts.<a class="code" href="structmd__ts.html#m4">box</a>-&gt;<a class="code" href="structmd__box.html#m4">beta</a>;
00125       ts-&gt;<a class="code" href="structmolfile__timestep__t.html#z4_5">gamma</a> = mdts.<a class="code" href="structmd__ts.html#m4">box</a>-&gt;<a class="code" href="structmd__box.html#m5">gamma</a>;
00126     }
00127   }
00128   <a class="code" href="Gromacs_8h.html#a62">mdio_tsfree</a>(&amp;mdts);
00129   <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a2">MOLFILE_SUCCESS</a>;
00130 }
00131 
<a name="l00132"></a><a class="code" href="gromacsplugin_8C.html#a10">00132</a> <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="gromacsplugin_8C.html#a10">close_gro_read</a>(<font class="keywordtype">void</font> *v) {
00133   <a class="code" href="structgmxdata.html">gmxdata</a> *gmx = (<a class="code" href="structgmxdata.html">gmxdata</a> *)v;
00134   <a class="code" href="Gromacs_8h.html#a37">mdio_close</a>(gmx-&gt;<a class="code" href="structgmxdata.html#m0">mf</a>);
00135   <font class="keyword">delete</font> gmx;
00136 }
00137 
<a name="l00138"></a><a class="code" href="gromacsplugin_8C.html#a11">00138</a> <font class="keyword">static</font> <font class="keywordtype">void</font> *<a class="code" href="gromacsplugin_8C.html#a11">open_g96_read</a>(<font class="keyword">const</font> <font class="keywordtype">char</font> *filename, <font class="keyword">const</font> <font class="keywordtype">char</font> *,
00139     <font class="keywordtype">int</font> *natoms) {
00140 
00141     <a class="code" href="structmd__file.html">md_file</a> *mf;
00142     <a class="code" href="structmd__header.html">md_header</a> mdh;
00143     <font class="keywordtype">char</font> gbuf[<a class="code" href="Gromacs_8h.html#a21">MAX_G96_LINE</a> + 1];
00144 
00145     mf = <a class="code" href="Gromacs_8h.html#a36">mdio_open</a>(filename, <a class="code" href="Gromacs_8h.html#a27">MDFMT_G96</a>);
00146     <font class="keywordflow">if</font> (!mf) {
00147         fprintf(stderr, <font class="stringliteral">"Cannot open file '%s', %s\n"</font>,
00148                 filename, <a class="code" href="Gromacs_8h.html#a58">mdio_errmsg</a>(<a class="code" href="Gromacs_8h.html#a57">mdio_errno</a>()));
00149         <font class="keywordflow">return</font> NULL;
00150     }
00151     
00152         <font class="comment">// read in the header data</font>
00153         <font class="keywordflow">if</font> (<a class="code" href="Gromacs_8h.html#a49">g96_header</a>(mf, mdh.<a class="code" href="structmd__header.html#m0">title</a>, <a class="code" href="Gromacs_8h.html#a23">MAX_MDIO_TITLE</a>, &amp;mdh.<a class="code" href="structmd__header.html#m2">timeval</a>) &lt; 0) {
00154             fprintf(stderr, <font class="stringliteral">"Cannot read header from '%s', %s\n"</font>, 
00155               filename, <a class="code" href="Gromacs_8h.html#a58">mdio_errmsg</a>(<a class="code" href="Gromacs_8h.html#a57">mdio_errno</a>()));
00156             <font class="keywordflow">return</font> NULL;
00157         }
00158 
00159         <font class="comment">// First, look for a timestep block</font>
00160         <font class="keywordflow">if</font> (<a class="code" href="Gromacs_8h.html#a61">mdio_readline</a>(mf, gbuf, <a class="code" href="Gromacs_8h.html#a21">MAX_G96_LINE</a> + 1) &lt; 0) {
00161             fprintf(stderr, <font class="stringliteral">"Cannot read header from '%s', %s\n"</font>, 
00162               filename, <a class="code" href="Gromacs_8h.html#a58">mdio_errmsg</a>(<a class="code" href="Gromacs_8h.html#a57">mdio_errno</a>()));
00163             <font class="keywordflow">return</font> NULL;
00164         }
00165         <font class="keywordflow">if</font> (!strcasecmp(gbuf, <font class="stringliteral">"TIMESTEP"</font>)) {
00166             <font class="comment">// Read in the value line and the END line, and the next</font>
00167             <font class="keywordflow">if</font> (<a class="code" href="Gromacs_8h.html#a61">mdio_readline</a>(mf, gbuf, <a class="code" href="Gromacs_8h.html#a21">MAX_G96_LINE</a> + 1) &lt; 0 ||
00168                 <a class="code" href="Gromacs_8h.html#a61">mdio_readline</a>(mf, gbuf, <a class="code" href="Gromacs_8h.html#a21">MAX_G96_LINE</a> + 1) &lt; 0 ||
00169                 <a class="code" href="Gromacs_8h.html#a61">mdio_readline</a>(mf, gbuf, <a class="code" href="Gromacs_8h.html#a21">MAX_G96_LINE</a> + 1) &lt; 0) {
00170               fprintf(stderr, <font class="stringliteral">"Cannot read header from '%s', %s\n"</font>, 
00171                 filename, <a class="code" href="Gromacs_8h.html#a58">mdio_errmsg</a>(<a class="code" href="Gromacs_8h.html#a57">mdio_errno</a>()));
00172               <font class="keywordflow">return</font> NULL;
00173             }
00174         }
00175         <font class="keywordflow">if</font> (strcasecmp(gbuf, <font class="stringliteral">"POSITION"</font>) &amp;&amp; strcasecmp(gbuf, <font class="stringliteral">"REFPOSITION"</font>)) {
00176           fprintf(stderr, <font class="stringliteral">"No structure information in file %s\n"</font>, filename);
00177           <font class="keywordflow">return</font> NULL;
00178         }
00179         *natoms = <a class="code" href="Gromacs_8h.html#a52">g96_countatoms</a>(mf); 
00180        
00181         <a class="code" href="structgmxdata.html">gmxdata</a> *gmx = <font class="keyword">new</font> <a class="code" href="structgmxdata.html">gmxdata</a>;
00182         gmx-&gt;<a class="code" href="structgmxdata.html#m0">mf</a> = mf;
00183         gmx-&gt;<a class="code" href="structgmxdata.html#m1">natoms</a> = *natoms; 
00184         <font class="keywordflow">return</font> gmx;
00185 }
00186 
<a name="l00187"></a><a class="code" href="gromacsplugin_8C.html#a12">00187</a> <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="gromacsplugin_8C.html#a12">read_g96_structure</a>(<font class="keywordtype">void</font> *mydata, <font class="keywordtype">int</font> *optflags,
00188     <a class="code" href="structmolfile__atom__t.html">molfile_atom_t</a> *atoms) {
00189   
00190     <font class="keywordtype">char</font> gbuf[<a class="code" href="Gromacs_8h.html#a21">MAX_G96_LINE</a> + 1];
00191     <a class="code" href="structgmxdata.html">gmxdata</a> *gmx = (<a class="code" href="structgmxdata.html">gmxdata</a> *)mydata;
00192     <a class="code" href="structmd__atom.html">md_atom</a> ma;
00193     <a class="code" href="structmd__file.html">md_file</a> *mf = gmx-&gt;<a class="code" href="structgmxdata.html#m0">mf</a>;
00194     
00195     *optflags = <a class="code" href="molfile__plugin_8h.html#a8">MOLFILE_NOOPTIONS</a>; <font class="comment">// no optional data</font>
00196 
00197         <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = 0; i &lt; gmx-&gt;<a class="code" href="structgmxdata.html#m1">natoms</a>; i++) {
00198             <a class="code" href="structmolfile__atom__t.html">molfile_atom_t</a> *atom = atoms+i; 
00199             <font class="keywordflow">if</font> (<a class="code" href="Gromacs_8h.html#a51">g96_rec</a>(mf, &amp;ma) &lt; 0) {
00200                 fprintf(stderr, <font class="stringliteral">"Error reading atom %d from file, %s\n"</font>,
00201                   i+1, <a class="code" href="Gromacs_8h.html#a58">mdio_errmsg</a>(<a class="code" href="Gromacs_8h.html#a57">mdio_errno</a>()));
00202                 <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a4">MOLFILE_ERROR</a>;
00203             }
00204             strcpy(atom-&gt;<a class="code" href="structmolfile__atom__t.html#m0">name</a>, ma.<a class="code" href="structmd__atom.html#m3">atomname</a>);
00205             strcpy(atom-&gt;<a class="code" href="structmolfile__atom__t.html#m1">type</a>, ma.<a class="code" href="structmd__atom.html#m3">atomname</a>);
00206             strcpy(atom-&gt;<a class="code" href="structmolfile__atom__t.html#m2">resname</a>, ma.<a class="code" href="structmd__atom.html#m1">resname</a>);
00207             atom-&gt;<a class="code" href="structmolfile__atom__t.html#m3">resid</a> = atoi(ma.<a class="code" href="structmd__atom.html#m0">resid</a>);
00208             atom-&gt;<a class="code" href="structmolfile__atom__t.html#m5">chain</a>[0] = <font class="charliteral">'\0'</font>;
00209             atom-&gt;<a class="code" href="structmolfile__atom__t.html#m4">segid</a>[0] = <font class="charliteral">'\0'</font>;
00210         }
00211         
00212         <font class="keywordflow">if</font> (<a class="code" href="Gromacs_8h.html#a61">mdio_readline</a>(mf, gbuf, <a class="code" href="Gromacs_8h.html#a21">MAX_G96_LINE</a> + 1) &lt; 0) {
00213             fprintf(stderr, <font class="stringliteral">"Warning, error reading END record, %s\n"</font>,
00214                 <a class="code" href="Gromacs_8h.html#a58">mdio_errmsg</a>(<a class="code" href="Gromacs_8h.html#a57">mdio_errno</a>()));
00215         }
00216 
00217             <font class="comment">// ... another problem: there may or may not be a VELOCITY</font>
00218             <font class="comment">// block or a BOX block, so we need to read one line beyond</font>
00219             <font class="comment">// the POSITION block to determine this. If neither VEL. nor</font>
00220             <font class="comment">// BOX are present we've read a line too far and infringed</font>
00221             <font class="comment">// on the next timestep, so we need to keep track of the</font>
00222             <font class="comment">// position now for a possible fseek() later to backtrack.</font>
00223             <font class="keywordtype">long</font> fpos = ftell(mf-&gt;<a class="code" href="structmd__file.html#m0">f</a>);
00224 
00225             <font class="comment">// Now we must read in the velocities and the box, if present</font>
00226             <font class="keywordflow">if</font> (<a class="code" href="Gromacs_8h.html#a61">mdio_readline</a>(mf, gbuf, <a class="code" href="Gromacs_8h.html#a21">MAX_G96_LINE</a> + 1) &gt;= 0) {
00227 
00228                 <font class="comment">// Is there a velocity block present ?</font>
00229                 <font class="keywordflow">if</font> (!strcasecmp(gbuf, <font class="stringliteral">"VELOCITY"</font>) || !strcasecmp(gbuf, <font class="stringliteral">"VELOCITYRED"</font>)) {
00230                         <font class="comment">// Ignore all the coordinates - VMD doesn't use them</font>
00231                         <font class="keywordflow">for</font> (;;) {
00232                                 <font class="keywordflow">if</font> (<a class="code" href="Gromacs_8h.html#a61">mdio_readline</a>(mf, gbuf, <a class="code" href="Gromacs_8h.html#a21">MAX_G96_LINE</a> + 1) &lt; 0)
00233                                         <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a4">MOLFILE_ERROR</a>;
00234                                 <font class="keywordflow">if</font> (!strcasecmp(gbuf, <font class="stringliteral">"END"</font>)) <font class="keywordflow">break</font>;
00235                         }
00236     
00237                         <font class="comment">// Again, record our position because we may need</font>
00238                         <font class="comment">// to fseek here later if we read too far.</font>
00239                         fpos = ftell(mf-&gt;<a class="code" href="structmd__file.html#m0">f</a>);
00240     
00241                         <font class="comment">// Go ahead and read the next line.</font>
00242                         <font class="keywordflow">if</font> (<a class="code" href="Gromacs_8h.html#a61">mdio_readline</a>(mf, gbuf, <a class="code" href="Gromacs_8h.html#a21">MAX_G96_LINE</a> + 1) &lt; 0)
00243                     <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a4">MOLFILE_ERROR</a>;
00244                 }
00245     
00246                 <font class="comment">// Is there a box present ?</font>
00247                 <font class="keywordflow">if</font> (!strcasecmp(gbuf, <font class="stringliteral">"BOX"</font>)) {
00248                         <font class="comment">// Ignore the box coordinates at this time.</font>
00249                         <font class="keywordflow">if</font> (<a class="code" href="Gromacs_8h.html#a61">mdio_readline</a>(mf, gbuf, <a class="code" href="Gromacs_8h.html#a21">MAX_G96_LINE</a> + 1) &lt; 0)
00250                     <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a4">MOLFILE_ERROR</a>;
00251                         <font class="keywordflow">if</font> (<a class="code" href="Gromacs_8h.html#a61">mdio_readline</a>(mf, gbuf, <a class="code" href="Gromacs_8h.html#a21">MAX_G96_LINE</a> + 1) &lt; 0)
00252                     <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a4">MOLFILE_ERROR</a>;
00253                         <font class="keywordflow">if</font> (strcasecmp(gbuf, <font class="stringliteral">"END"</font>)) 
00254                     <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a4">MOLFILE_ERROR</a>;
00255                 }
00256                 <font class="keywordflow">else</font> {
00257                         <font class="comment">// We have read too far, so fseek back to the</font>
00258                         <font class="comment">// last known safe position so we don't return</font>
00259                         <font class="comment">// with the file pointer set infringing on the</font>
00260                         <font class="comment">// next timestep data.</font>
00261                         fseek(mf-&gt;<a class="code" href="structmd__file.html#m0">f</a>, fpos, SEEK_SET);
00262                 }
00263         }
00264         <font class="keywordflow">else</font> {
00265             <font class="comment">// Go ahead and rewind for good measure</font>
00266             fseek(mf-&gt;<a class="code" href="structmd__file.html#m0">f</a>, fpos, SEEK_SET);
00267         }
00268         rewind(mf-&gt;<a class="code" href="structmd__file.html#m0">f</a>);
00269         <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a2">MOLFILE_SUCCESS</a>;
00270 }
00271 
<a name="l00272"></a><a class="code" href="gromacsplugin_8C.html#a13">00272</a> <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="gromacsplugin_8C.html#a13">read_g96_timestep</a>(<font class="keywordtype">void</font> *v, <font class="keywordtype">int</font> natoms, <a class="code" href="structmolfile__timestep__t.html">molfile_timestep_t</a> *ts) {
00273 
00274   <a class="code" href="structgmxdata.html">gmxdata</a> *gmx = (<a class="code" href="structgmxdata.html">gmxdata</a> *)v;
00275   <a class="code" href="structmd__ts.html">md_ts</a> mdts;
00276   memset(&amp;mdts, 0, <font class="keyword">sizeof</font>(<a class="code" href="structmd__ts.html">md_ts</a>));
00277   mdts.<a class="code" href="structmd__ts.html#m1">natoms</a> = natoms;
00278 
00279   <font class="keywordflow">if</font> (<a class="code" href="Gromacs_8h.html#a39">mdio_timestep</a>(gmx-&gt;<a class="code" href="structgmxdata.html#m0">mf</a>, &amp;mdts) &lt; 0) 
00280     <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a4">MOLFILE_ERROR</a>;
00281   <font class="keywordflow">if</font> (ts) {
00282     memcpy(ts-&gt;<a class="code" href="structmolfile__timestep__t.html#m0">coords</a>, mdts.<a class="code" href="structmd__ts.html#m0">pos</a>, 3 * <font class="keyword">sizeof</font>(<font class="keywordtype">float</font>) * gmx-&gt;<a class="code" href="structgmxdata.html#m1">natoms</a>);
00283     <font class="keywordflow">if</font> (mdts.<a class="code" href="structmd__ts.html#m4">box</a>) {
00284       ts-&gt;<a class="code" href="structmolfile__timestep__t.html#z4_0">A</a> = mdts.<a class="code" href="structmd__ts.html#m4">box</a>-&gt;<a class="code" href="structmd__box.html#m0">A</a>;
00285       ts-&gt;<a class="code" href="structmolfile__timestep__t.html#z4_1">B</a> = mdts.<a class="code" href="structmd__ts.html#m4">box</a>-&gt;<a class="code" href="structmd__box.html#m1">B</a>;
00286       ts-&gt;<a class="code" href="structmolfile__timestep__t.html#z4_2">C</a> = mdts.<a class="code" href="structmd__ts.html#m4">box</a>-&gt;<a class="code" href="structmd__box.html#m2">C</a>;
00287       ts-&gt;<a class="code" href="structmolfile__timestep__t.html#z4_3">alpha</a> = mdts.<a class="code" href="structmd__ts.html#m4">box</a>-&gt;<a class="code" href="structmd__box.html#m3">alpha</a>;
00288       ts-&gt;<a class="code" href="structmolfile__timestep__t.html#z4_4">beta</a> = mdts.<a class="code" href="structmd__ts.html#m4">box</a>-&gt;<a class="code" href="structmd__box.html#m4">beta</a>;
00289       ts-&gt;<a class="code" href="structmolfile__timestep__t.html#z4_5">gamma</a> = mdts.<a class="code" href="structmd__ts.html#m4">box</a>-&gt;<a class="code" href="structmd__box.html#m5">gamma</a>;
00290     }
00291   }
00292   <a class="code" href="Gromacs_8h.html#a62">mdio_tsfree</a>(&amp;mdts);
00293   <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a2">MOLFILE_SUCCESS</a>;
00294 }
00295 
<a name="l00296"></a><a class="code" href="gromacsplugin_8C.html#a14">00296</a> <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="gromacsplugin_8C.html#a14">close_g96_read</a>(<font class="keywordtype">void</font> *v) {
00297   <a class="code" href="structgmxdata.html">gmxdata</a> *gmx = (<a class="code" href="structgmxdata.html">gmxdata</a> *)v;
00298   <a class="code" href="Gromacs_8h.html#a37">mdio_close</a>(gmx-&gt;<a class="code" href="structgmxdata.html#m0">mf</a>);
00299   <font class="keyword">delete</font> gmx;
00300 }
00301   
00302 
00303 <font class="comment">//</font>
00304 <font class="comment">// TRR and XTC files</font>
00305 <font class="comment">//</font>
00306 
<a name="l00307"></a><a class="code" href="gromacsplugin_8C.html#a15">00307</a> <font class="keyword">static</font> <font class="keywordtype">void</font> *<a class="code" href="gromacsplugin_8C.html#a15">open_trr_read</a>(<font class="keyword">const</font> <font class="keywordtype">char</font> *filename, <font class="keyword">const</font> <font class="keywordtype">char</font> *filetype,
00308     <font class="keywordtype">int</font> *natoms) {
00309 
00310     <a class="code" href="structmd__file.html">md_file</a> *mf;
00311     <a class="code" href="structmd__header.html">md_header</a> mdh;
00312     <a class="code" href="structgmxdata.html">gmxdata</a> *gmx;
00313     <font class="keywordtype">int</font> format;
00314   
00315     <font class="keywordflow">if</font> (!strcmp(filetype, <font class="stringliteral">"trr"</font>)) 
00316       format = <a class="code" href="Gromacs_8h.html#a26">MDFMT_TRR</a>;
00317     <font class="keywordflow">else</font> <font class="keywordflow">if</font> (!strcmp(filetype, <font class="stringliteral">"xtc"</font>)) 
00318       format = <a class="code" href="Gromacs_8h.html#a29">MDFMT_XTC</a>;
00319     <font class="keywordflow">else</font>
00320       <font class="keywordflow">return</font> NULL;
00321 
00322     mf = <a class="code" href="Gromacs_8h.html#a36">mdio_open</a>(filename, format);
00323     <font class="keywordflow">if</font> (!mf) {
00324         fprintf(stderr, <font class="stringliteral">"Cannot open file '%s', %s\n"</font>,
00325                 filename, <a class="code" href="Gromacs_8h.html#a58">mdio_errmsg</a>(<a class="code" href="Gromacs_8h.html#a57">mdio_errno</a>()));
00326         <font class="keywordflow">return</font> NULL;
00327     }
00328     <font class="keywordflow">if</font> (<a class="code" href="Gromacs_8h.html#a38">mdio_header</a>(mf, &amp;mdh) &lt; 0) {
00329         <a class="code" href="Gromacs_8h.html#a37">mdio_close</a>(mf);
00330         fprintf(stderr, <font class="stringliteral">"Cannot read header fromm '%s', %s\n"</font>,
00331             filename, <a class="code" href="Gromacs_8h.html#a58">mdio_errmsg</a>(<a class="code" href="Gromacs_8h.html#a57">mdio_errno</a>()));
00332         <font class="keywordflow">return</font> NULL;
00333     }
00334     *natoms = mdh.<a class="code" href="structmd__header.html#m1">natoms</a>;
00335     gmx = <font class="keyword">new</font> <a class="code" href="structgmxdata.html">gmxdata</a>;
00336     gmx-&gt;<a class="code" href="structgmxdata.html#m0">mf</a> = mf;
00337     gmx-&gt;<a class="code" href="structgmxdata.html#m1">natoms</a> = mdh.<a class="code" href="structmd__header.html#m1">natoms</a>;
00338     <font class="keywordflow">return</font> gmx;
00339 }
00340 
<a name="l00341"></a><a class="code" href="gromacsplugin_8C.html#a16">00341</a> <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="gromacsplugin_8C.html#a16">read_trr_timestep</a>(<font class="keywordtype">void</font> *v, <font class="keywordtype">int</font> natoms, <a class="code" href="structmolfile__timestep__t.html">molfile_timestep_t</a> *ts) {
00342   <a class="code" href="structgmxdata.html">gmxdata</a> *gmx = (<a class="code" href="structgmxdata.html">gmxdata</a> *)v;
00343   <a class="code" href="structmd__ts.html">md_ts</a> mdts;
00344   memset(&amp;mdts, 0, <font class="keyword">sizeof</font>(<a class="code" href="structmd__ts.html">md_ts</a>));
00345   mdts.<a class="code" href="structmd__ts.html#m1">natoms</a> = natoms;
00346 
00347   <font class="keywordflow">if</font> (<a class="code" href="Gromacs_8h.html#a39">mdio_timestep</a>(gmx-&gt;<a class="code" href="structgmxdata.html#m0">mf</a>, &amp;mdts) &lt; 0) {
00348     <font class="keywordflow">if</font> (<a class="code" href="Gromacs_8h.html#a57">mdio_errno</a>() == <a class="code" href="Gromacs_8h.html#a3">MDIO_EOF</a> || <a class="code" href="Gromacs_8h.html#a57">mdio_errno</a>() == <a class="code" href="Gromacs_8h.html#a5">MDIO_IOERROR</a>) {
00349       <font class="comment">// XXX Lame, why does mdio treat IOERROR like EOF?  </font>
00350       <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a4">MOLFILE_ERROR</a>;
00351     }
00352     fprintf(stderr, <font class="stringliteral">"Error reading timestep, %s\n"</font>, <a class="code" href="Gromacs_8h.html#a58">mdio_errmsg</a>(<a class="code" href="Gromacs_8h.html#a57">mdio_errno</a>()));
00353     <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a4">MOLFILE_ERROR</a>;
00354   }
00355   <font class="keywordflow">if</font> (mdts.<a class="code" href="structmd__ts.html#m1">natoms</a> != natoms) {
00356     fprintf(stderr, <font class="stringliteral">"Timestep in file contains wrong number of atoms\n"</font>);
00357     fprintf(stderr, <font class="stringliteral">"Found %d, expected %d\n"</font>, mdts.<a class="code" href="structmd__ts.html#m1">natoms</a>, natoms);
00358     <a class="code" href="Gromacs_8h.html#a62">mdio_tsfree</a>(&amp;mdts);
00359     <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a4">MOLFILE_ERROR</a>;
00360   }
00361    
00362   <font class="keywordflow">if</font> (ts) {
00363     memcpy(ts-&gt;<a class="code" href="structmolfile__timestep__t.html#m0">coords</a>, mdts.<a class="code" href="structmd__ts.html#m0">pos</a>, 3 * <font class="keyword">sizeof</font>(<font class="keywordtype">float</font>) * gmx-&gt;<a class="code" href="structgmxdata.html#m1">natoms</a>);
00364     <font class="keywordflow">if</font> (mdts.<a class="code" href="structmd__ts.html#m4">box</a>) {
00365       ts-&gt;<a class="code" href="structmolfile__timestep__t.html#z4_0">A</a> = mdts.<a class="code" href="structmd__ts.html#m4">box</a>-&gt;<a class="code" href="structmd__box.html#m0">A</a>;
00366       ts-&gt;<a class="code" href="structmolfile__timestep__t.html#z4_1">B</a> = mdts.<a class="code" href="structmd__ts.html#m4">box</a>-&gt;<a class="code" href="structmd__box.html#m1">B</a>;
00367       ts-&gt;<a class="code" href="structmolfile__timestep__t.html#z4_2">C</a> = mdts.<a class="code" href="structmd__ts.html#m4">box</a>-&gt;<a class="code" href="structmd__box.html#m2">C</a>;
00368       ts-&gt;<a class="code" href="structmolfile__timestep__t.html#z4_3">alpha</a> = mdts.<a class="code" href="structmd__ts.html#m4">box</a>-&gt;<a class="code" href="structmd__box.html#m3">alpha</a>;
00369       ts-&gt;<a class="code" href="structmolfile__timestep__t.html#z4_4">beta</a> = mdts.<a class="code" href="structmd__ts.html#m4">box</a>-&gt;<a class="code" href="structmd__box.html#m4">beta</a>;
00370       ts-&gt;<a class="code" href="structmolfile__timestep__t.html#z4_5">gamma</a> = mdts.<a class="code" href="structmd__ts.html#m4">box</a>-&gt;<a class="code" href="structmd__box.html#m5">gamma</a>;
00371     }
00372   }
00373   <a class="code" href="Gromacs_8h.html#a62">mdio_tsfree</a>(&amp;mdts);
00374   <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a2">MOLFILE_SUCCESS</a>;
00375 }
00376 
<a name="l00377"></a><a class="code" href="gromacsplugin_8C.html#a17">00377</a> <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="gromacsplugin_8C.html#a17">close_trr_read</a>(<font class="keywordtype">void</font> *v) {
00378   <a class="code" href="structgmxdata.html">gmxdata</a> *gmx = (<a class="code" href="structgmxdata.html">gmxdata</a> *)v;
00379   <a class="code" href="Gromacs_8h.html#a37">mdio_close</a>(gmx-&gt;<a class="code" href="structgmxdata.html#m0">mf</a>);
00380   <font class="keyword">delete</font> gmx;
00381 }
00382 
00383 <font class="comment">// open file for writing</font>
<a name="l00384"></a><a class="code" href="gromacsplugin_8C.html#a18">00384</a> <font class="keyword">static</font> <font class="keywordtype">void</font> *<a class="code" href="gromacsplugin_8C.html#a18">open_trr_write</a>(<font class="keyword">const</font> <font class="keywordtype">char</font> *filename, <font class="keyword">const</font> <font class="keywordtype">char</font> *filetype,
00385     <font class="keywordtype">int</font> natoms) {
00386 
00387     <a class="code" href="structmd__file.html">md_file</a> *mf;
00388     <a class="code" href="structgmxdata.html">gmxdata</a> *gmx;
00389     <font class="keywordtype">int</font> format;
00390   
00391     <font class="keywordflow">if</font> (!strcmp(filetype, <font class="stringliteral">"trr"</font>)) 
00392       format = <a class="code" href="Gromacs_8h.html#a26">MDFMT_TRR</a>;
00393     <font class="keywordflow">else</font> <font class="keywordflow">if</font> (!strcmp(filetype, <font class="stringliteral">"xtc"</font>)) 
00394       format = <a class="code" href="Gromacs_8h.html#a29">MDFMT_XTC</a>;
00395     <font class="keywordflow">else</font>
00396       <font class="keywordflow">return</font> NULL;
00397 
00398     mf = <a class="code" href="Gromacs_8h.html#a36">mdio_open</a>(filename, format, <a class="code" href="Gromacs_8h.html#a16">MDIO_WRITE</a>);
00399     <font class="keywordflow">if</font> (!mf) {
00400         fprintf(stderr, <font class="stringliteral">"Cannot open file '%s', %s\n"</font>,
00401                 filename, <a class="code" href="Gromacs_8h.html#a58">mdio_errmsg</a>(<a class="code" href="Gromacs_8h.html#a57">mdio_errno</a>()));
00402         <font class="keywordflow">return</font> NULL;
00403     }
00404     gmx = <font class="keyword">new</font> <a class="code" href="structgmxdata.html">gmxdata</a>;
00405     gmx-&gt;<a class="code" href="structgmxdata.html#m0">mf</a> = mf;
00406     gmx-&gt;<a class="code" href="structgmxdata.html#m1">natoms</a> = natoms;
00407     <font class="comment">// set some parameters for the output stream:</font>
00408     <font class="comment">// start at step 0, convert to big-endian, write single precision.</font>
00409     gmx-&gt;<a class="code" href="structgmxdata.html#m2">step</a>   = 0;
00410     gmx-&gt;<a class="code" href="structgmxdata.html#m0">mf</a>-&gt;<a class="code" href="structmd__file.html#m3">rev</a> = <a class="code" href="Gromacs_8h.html#a65">host_is_little_endian</a>();
00411     gmx-&gt;<a class="code" href="structgmxdata.html#m0">mf</a>-&gt;<a class="code" href="structmd__file.html#m2">prec</a> = <font class="keyword">sizeof</font>(float);
00412     <font class="keywordflow">return</font> gmx;
00413 }
00414 
00415 <font class="comment">// write a trr timestep. the file format has a header with each record</font>
<a name="l00416"></a><a class="code" href="gromacsplugin_8C.html#a19">00416</a> <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="gromacsplugin_8C.html#a19">write_trr_timestep</a>(<font class="keywordtype">void</font> *mydata, <font class="keyword">const</font> <a class="code" href="structmolfile__timestep__t.html">molfile_timestep_t</a> *ts) 
00417 {
00418   <font class="keyword">const</font> <font class="keywordtype">float</font> nm=0.1;
00419   
00420   <a class="code" href="structgmxdata.html">gmxdata</a> *gmx = (<a class="code" href="structgmxdata.html">gmxdata</a> *)mydata;
00421   
00422   <font class="comment">// determine and write header from structure info.</font>
00423   <font class="comment">// write trr header. XXX: move this to Gromacs.h ??</font>
00424   <font class="keywordflow">if</font> (gmx-&gt;<a class="code" href="structgmxdata.html#m0">mf</a>-&gt;<a class="code" href="structmd__file.html#m1">fmt</a> == <a class="code" href="Gromacs_8h.html#a26">MDFMT_TRR</a>) {
00425     <font class="keywordtype">int</font> i;
00426 
00427     <font class="keywordflow">if</font> ( <a class="code" href="Gromacs_8h.html#a66">put_trx_int</a>(gmx-&gt;<a class="code" href="structgmxdata.html#m0">mf</a>, <a class="code" href="Gromacs_8h.html#a18">TRX_MAGIC</a>)            <font class="comment">// ID</font>
00428          || <a class="code" href="Gromacs_8h.html#a68">put_trx_string</a>(gmx-&gt;<a class="code" href="structgmxdata.html#m0">mf</a>, <font class="stringliteral">"GMX_trn_file"</font>) <font class="comment">// version</font>
00429          || <a class="code" href="Gromacs_8h.html#a66">put_trx_int</a>(gmx-&gt;<a class="code" href="structgmxdata.html#m0">mf</a>, 0)                 <font class="comment">// ir_size (ignored)</font>
00430          || <a class="code" href="Gromacs_8h.html#a66">put_trx_int</a>(gmx-&gt;<a class="code" href="structgmxdata.html#m0">mf</a>, 0)                 <font class="comment">// e_size (ignored)</font>
00431          || <a class="code" href="Gromacs_8h.html#a66">put_trx_int</a>(gmx-&gt;<a class="code" href="structgmxdata.html#m0">mf</a>, 9*<font class="keyword">sizeof</font>(<font class="keywordtype">float</font>))   <font class="comment">// box</font>
00432          || <a class="code" href="Gromacs_8h.html#a66">put_trx_int</a>(gmx-&gt;<a class="code" href="structgmxdata.html#m0">mf</a>, 0)                 <font class="comment">// vir_size (ignored)</font>
00433          || <a class="code" href="Gromacs_8h.html#a66">put_trx_int</a>(gmx-&gt;<a class="code" href="structgmxdata.html#m0">mf</a>, 0)                 <font class="comment">// pres_size (ignored)</font>
00434          || <a class="code" href="Gromacs_8h.html#a66">put_trx_int</a>(gmx-&gt;<a class="code" href="structgmxdata.html#m0">mf</a>, 0)                 <font class="comment">// top_size (ignored)</font>
00435          || <a class="code" href="Gromacs_8h.html#a66">put_trx_int</a>(gmx-&gt;<a class="code" href="structgmxdata.html#m0">mf</a>, 0)                 <font class="comment">// sym_size (ignored)</font>
00436          || <a class="code" href="Gromacs_8h.html#a66">put_trx_int</a>(gmx-&gt;<a class="code" href="structgmxdata.html#m0">mf</a>, 3*<font class="keyword">sizeof</font>(<font class="keywordtype">float</font>)*gmx-&gt;<a class="code" href="structgmxdata.html#m1">natoms</a>) <font class="comment">// coordinates </font>
00437          || <a class="code" href="Gromacs_8h.html#a66">put_trx_int</a>(gmx-&gt;<a class="code" href="structgmxdata.html#m0">mf</a>, 0)                 <font class="comment">// no velocities</font>
00438          || <a class="code" href="Gromacs_8h.html#a66">put_trx_int</a>(gmx-&gt;<a class="code" href="structgmxdata.html#m0">mf</a>, 0)                 <font class="comment">// no forces</font>
00439          || <a class="code" href="Gromacs_8h.html#a66">put_trx_int</a>(gmx-&gt;<a class="code" href="structgmxdata.html#m0">mf</a>, gmx-&gt;<a class="code" href="structgmxdata.html#m1">natoms</a>)       <font class="comment">// number of atoms</font>
00440          || <a class="code" href="Gromacs_8h.html#a66">put_trx_int</a>(gmx-&gt;<a class="code" href="structgmxdata.html#m0">mf</a>, gmx-&gt;<a class="code" href="structgmxdata.html#m2">step</a>)         <font class="comment">// current step number</font>
00441          || <a class="code" href="Gromacs_8h.html#a66">put_trx_int</a>(gmx-&gt;<a class="code" href="structgmxdata.html#m0">mf</a>, 0)                 <font class="comment">// nre (ignored)</font>
00442          || <a class="code" href="Gromacs_8h.html#a67">put_trx_real</a>(gmx-&gt;<a class="code" href="structgmxdata.html#m0">mf</a>, 0.1*gmx-&gt;<a class="code" href="structgmxdata.html#m2">step</a>)    <font class="comment">// current time. (dummy value: 0.1)</font>
00443          || <a class="code" href="Gromacs_8h.html#a67">put_trx_real</a>(gmx-&gt;<a class="code" href="structgmxdata.html#m0">mf</a>, 0.0))             <font class="comment">// current lambda</font>
00444       <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a4">MOLFILE_ERROR</a>;
00445 
00446     <font class="comment">// set up box according to the VMD unitcell conventions.</font>
00447     <font class="comment">// the a-vector is collinear with the x-axis and</font>
00448     <font class="comment">// the b-vector is in the xy-plane. </font>
00449     <font class="keyword">const</font> <font class="keywordtype">float</font> sa = sin((<font class="keywordtype">double</font>)ts-&gt;<a class="code" href="structmolfile__timestep__t.html#z4_3">alpha</a>/180.0*<a class="code" href="gromacsplugin_8C.html#a0">M_PI</a>);
00450     <font class="keyword">const</font> <font class="keywordtype">float</font> ca = cos((<font class="keywordtype">double</font>)ts-&gt;<a class="code" href="structmolfile__timestep__t.html#z4_3">alpha</a>/180.0*<a class="code" href="gromacsplugin_8C.html#a0">M_PI</a>);
00451     <font class="keyword">const</font> <font class="keywordtype">float</font> cb = cos((<font class="keywordtype">double</font>)ts-&gt;<a class="code" href="structmolfile__timestep__t.html#z4_4">beta</a>/180.0*<a class="code" href="gromacsplugin_8C.html#a0">M_PI</a>);
00452     <font class="keyword">const</font> <font class="keywordtype">float</font> cg = cos((<font class="keywordtype">double</font>)ts-&gt;<a class="code" href="structmolfile__timestep__t.html#z4_5">gamma</a>/180.0*<a class="code" href="gromacsplugin_8C.html#a0">M_PI</a>);
00453     <font class="keyword">const</font> <font class="keywordtype">float</font> sg = sin((<font class="keywordtype">double</font>)ts-&gt;<a class="code" href="structmolfile__timestep__t.html#z4_5">gamma</a>/180.0*<a class="code" href="gromacsplugin_8C.html#a0">M_PI</a>);
00454     <font class="keywordtype">float</font> box[9];
00455     box[0] = ts-&gt;<a class="code" href="structmolfile__timestep__t.html#z4_0">A</a>;    box[1] = 0.0;      box[2] = 0.0;
00456     box[3] = ts-&gt;<a class="code" href="structmolfile__timestep__t.html#z4_1">B</a>*ca; box[4] = ts-&gt;<a class="code" href="structmolfile__timestep__t.html#z4_1">B</a>*sa; box[5] = 0.0;
00457     box[6] = ts-&gt;<a class="code" href="structmolfile__timestep__t.html#z4_2">C</a>*cb; box[7] = ts-&gt;<a class="code" href="structmolfile__timestep__t.html#z4_2">C</a>*(ca - cb*cg)/sg;
00458     box[8] = ts-&gt;<a class="code" href="structmolfile__timestep__t.html#z4_2">C</a>*sqrt((<font class="keywordtype">double</font>)(1.0 + 2.0*ca*cb*cg 
00459                                  - ca*ca - cb*cb - cg*cg)/(1.0 - cg*cg));
00460 
00461     <font class="keywordflow">for</font> (i=0; i&lt;9; ++i) {
00462       <font class="keywordflow">if</font> (<a class="code" href="Gromacs_8h.html#a67">put_trx_real</a>(gmx-&gt;<a class="code" href="structgmxdata.html#m0">mf</a>, box[i]*nm))
00463         <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a4">MOLFILE_ERROR</a>;
00464     }
00465 <font class="preprocessor">#ifdef TEST_TRR_PLUGIN</font>
00466 <font class="preprocessor"></font>    fprintf(stderr, <font class="stringliteral">"box is:\n %f %f %f\n %f %f %f\n %f %f %f\n\n"</font>,
00467             box[0], box[1], box[2], box[3], box[4], box[5], box[6], box[7], box[8]);
00468 <font class="preprocessor">#endif</font>
00469 <font class="preprocessor"></font>
00470     <font class="comment">// write coordinates</font>
00471     <font class="keywordflow">for</font> (i=0; i&lt;(3*gmx-&gt;<a class="code" href="structgmxdata.html#m1">natoms</a>); ++i) {
00472       <font class="keywordflow">if</font> (<a class="code" href="Gromacs_8h.html#a67">put_trx_real</a>(gmx-&gt;<a class="code" href="structgmxdata.html#m0">mf</a>, ts-&gt;<a class="code" href="structmolfile__timestep__t.html#m0">coords</a>[i]*nm))
00473         <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a4">MOLFILE_ERROR</a>;
00474     }
00475   } <font class="keywordflow">else</font> {
00476     fprintf(stderr, <font class="stringliteral">"only .trr is supported for writing\n"</font>);
00477     <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a4">MOLFILE_ERROR</a>;
00478   }
00479 
00480   ++ gmx-&gt;<a class="code" href="structgmxdata.html#m2">step</a>;
00481   <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a2">MOLFILE_SUCCESS</a>;
00482   }
00483 
00484 
<a name="l00485"></a><a class="code" href="gromacsplugin_8C.html#a20">00485</a> <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="gromacsplugin_8C.html#a20">close_trr_write</a>(<font class="keywordtype">void</font> *v) {
00486   <a class="code" href="structgmxdata.html">gmxdata</a> *gmx = (<a class="code" href="structgmxdata.html">gmxdata</a> *)v;
00487   <a class="code" href="Gromacs_8h.html#a37">mdio_close</a>(gmx-&gt;<a class="code" href="structgmxdata.html#m0">mf</a>);
00488   <font class="keyword">delete</font> gmx;
00489 }
00490 
<a name="l00491"></a><a class="code" href="gromacsplugin_8C.html#a1">00491</a> <font class="preprocessor">#define GROMACS_PLUGIN_MAJOR_VERSION 0</font>
<a name="l00492"></a><a class="code" href="gromacsplugin_8C.html#a2">00492</a> <font class="preprocessor"></font><font class="preprocessor">#define GROMACS_PLUGIN_MINOR_VERSION 8</font>
00493 <font class="preprocessor"></font>
00494 <font class="comment">//</font>
00495 <font class="comment">// plugin registration stuff below</font>
00496 <font class="comment">//</font>
<a name="l00497"></a><a class="code" href="gromacsplugin_8C.html#a3">00497</a> <font class="keyword">static</font> <a class="code" href="structmolfile__plugin__t.html">molfile_plugin_t</a> <a class="code" href="gromacsplugin_8C.html#a3">gro_plugin</a> = {
00498   <a class="code" href="vmdplugin_8h.html#a10">vmdplugin_ABIVERSION</a>,               <font class="comment">// ABI version</font>
00499   <a class="code" href="molfile__plugin_8h.html#a0">MOLFILE_PLUGIN_TYPE</a>,                <font class="comment">// type of plugin</font>
00500   <font class="stringliteral">"gro"</font>,                              <font class="comment">// short name of plugin</font>
00501   <font class="stringliteral">"Gromacs GRO"</font>,                      <font class="comment">// pretty name of plugin</font>
00502   <font class="stringliteral">"David Norris, Justin Gullingsrud"</font>, <font class="comment">// authors</font>
00503   <a class="code" href="gromacsplugin_8C.html#a1">GROMACS_PLUGIN_MAJOR_VERSION</a>,       <font class="comment">// major version</font>
00504   <a class="code" href="gromacsplugin_8C.html#a2">GROMACS_PLUGIN_MINOR_VERSION</a>,       <font class="comment">// minor version</font>
00505   <a class="code" href="vmdplugin_8h.html#a11">VMDPLUGIN_THREADUNSAFE</a>,             <font class="comment">// is not reentrant</font>
00506   <font class="stringliteral">"gro"</font>,                              <font class="comment">// filename extension</font>
00507   <a class="code" href="gromacsplugin_8C.html#a7">open_gro_read</a>,
00508   <a class="code" href="gromacsplugin_8C.html#a8">read_gro_structure</a>,
00509   0,
00510   <a class="code" href="gromacsplugin_8C.html#a9">read_gro_timestep</a>,
00511   <a class="code" href="gromacsplugin_8C.html#a10">close_gro_read</a>,
00512   0,                                  <font class="comment">// open_write</font>
00513   0,                                  <font class="comment">// write_structure</font>
00514   0,                                  <font class="comment">// write_timestep</font>
00515   0,                                  <font class="comment">// close_write</font>
00516   0,                                  <font class="comment">// read_volumetric_metadata</font>
00517   0,                                  <font class="comment">// read_volumetric_data</font>
00518   0                                   <font class="comment">// read_rawgraphics</font>
00519 };
00520 
<a name="l00521"></a><a class="code" href="gromacsplugin_8C.html#a4">00521</a> <font class="keyword">static</font> <a class="code" href="structmolfile__plugin__t.html">molfile_plugin_t</a> <a class="code" href="gromacsplugin_8C.html#a4">g96_plugin</a> = {
00522   <a class="code" href="vmdplugin_8h.html#a10">vmdplugin_ABIVERSION</a>,               <font class="comment">// ABI version</font>
00523   <a class="code" href="molfile__plugin_8h.html#a0">MOLFILE_PLUGIN_TYPE</a>,                <font class="comment">// type of plugin</font>
00524   <font class="stringliteral">"g96"</font>,                              <font class="comment">// short name of plugin</font>
00525   <font class="stringliteral">"Gromacs g96"</font>,                      <font class="comment">// pretty name of plugin</font>
00526   <font class="stringliteral">"David Norris, Justin Gullingsrud"</font>, <font class="comment">// authors</font>
00527   <a class="code" href="gromacsplugin_8C.html#a1">GROMACS_PLUGIN_MAJOR_VERSION</a>,       <font class="comment">// major version</font>
00528   <a class="code" href="gromacsplugin_8C.html#a2">GROMACS_PLUGIN_MINOR_VERSION</a>,       <font class="comment">// minor version</font>
00529   <a class="code" href="vmdplugin_8h.html#a11">VMDPLUGIN_THREADUNSAFE</a>,             <font class="comment">// is not reentrant</font>
00530   <font class="stringliteral">"g96"</font>,                              <font class="comment">// filename extension</font>
00531   <a class="code" href="gromacsplugin_8C.html#a11">open_g96_read</a>,
00532   <a class="code" href="gromacsplugin_8C.html#a12">read_g96_structure</a>,
00533   0,
00534   <a class="code" href="gromacsplugin_8C.html#a13">read_g96_timestep</a>,
00535   <a class="code" href="gromacsplugin_8C.html#a14">close_g96_read</a>,
00536   0,                                  <font class="comment">// open_write</font>
00537   0,                                  <font class="comment">// write_structure</font>
00538   0,                                  <font class="comment">// write_timestep</font>
00539   0,                                  <font class="comment">// close_write</font>
00540   0,                                  <font class="comment">// read_volumetric_metadata</font>
00541   0,                                  <font class="comment">// read_volumetric_data</font>
00542   0                                   <font class="comment">// read_rawgraphics</font>
00543 };
00544 
<a name="l00545"></a><a class="code" href="gromacsplugin_8C.html#a5">00545</a> <font class="keyword">static</font> <a class="code" href="structmolfile__plugin__t.html">molfile_plugin_t</a> <a class="code" href="gromacsplugin_8C.html#a5">trr_plugin</a> = {
00546   <a class="code" href="vmdplugin_8h.html#a10">vmdplugin_ABIVERSION</a>,               <font class="comment">// ABI version</font>
00547   <a class="code" href="molfile__plugin_8h.html#a0">MOLFILE_PLUGIN_TYPE</a>,                <font class="comment">// type of plugin</font>
00548   <font class="stringliteral">"trr"</font>,                              <font class="comment">// short name of plugin</font>
00549   <font class="stringliteral">"Gromacs TRR Trajectory"</font>,           <font class="comment">// pretty name of plugin</font>
00550   <font class="stringliteral">"David Norris, Justin Gullingsrud, Axel Kohlmeyer"</font>, <font class="comment">// authors</font>
00551   <a class="code" href="gromacsplugin_8C.html#a1">GROMACS_PLUGIN_MAJOR_VERSION</a>,       <font class="comment">// major version</font>
00552   <a class="code" href="gromacsplugin_8C.html#a2">GROMACS_PLUGIN_MINOR_VERSION</a>,       <font class="comment">// minor version</font>
00553   <a class="code" href="vmdplugin_8h.html#a11">VMDPLUGIN_THREADUNSAFE</a>,             <font class="comment">// is not reentrant</font>
00554   <font class="stringliteral">"trr"</font>,                              <font class="comment">// filename extension</font>
00555   <a class="code" href="gromacsplugin_8C.html#a15">open_trr_read</a>,
00556   0,
00557   0,
00558   <a class="code" href="gromacsplugin_8C.html#a16">read_trr_timestep</a>,
00559   <a class="code" href="gromacsplugin_8C.html#a17">close_trr_read</a>,
00560   <a class="code" href="gromacsplugin_8C.html#a18">open_trr_write</a>,
00561   0,                            <font class="comment">// write_structure</font>
00562   <a class="code" href="gromacsplugin_8C.html#a19">write_trr_timestep</a>,
00563   <a class="code" href="gromacsplugin_8C.html#a20">close_trr_write</a>,
00564   0,                            <font class="comment">// read_volumetric_metadata</font>
00565   0,                            <font class="comment">// read_volumetric_data</font>
00566   0                             <font class="comment">// read_rawgraphics</font>
00567 };
00568 
<a name="l00569"></a><a class="code" href="gromacsplugin_8C.html#a6">00569</a> <font class="keyword">static</font> <a class="code" href="structmolfile__plugin__t.html">molfile_plugin_t</a> <a class="code" href="gromacsplugin_8C.html#a6">xtc_plugin</a> = {
00570   <a class="code" href="vmdplugin_8h.html#a10">vmdplugin_ABIVERSION</a>,                <font class="comment">// ABI version</font>
00571   <a class="code" href="molfile__plugin_8h.html#a0">MOLFILE_PLUGIN_TYPE</a>,                 <font class="comment">// type of plugin</font>
00572   <font class="stringliteral">"xtc"</font>,                               <font class="comment">// short name of plugin</font>
00573   <font class="stringliteral">"Gromacs XTC Compressed Trajectory"</font>, <font class="comment">// pretty name of plugin</font>
00574   <font class="stringliteral">"David Norris, Justin Gullingsrud"</font>,  <font class="comment">// authors</font>
00575   <a class="code" href="gromacsplugin_8C.html#a1">GROMACS_PLUGIN_MAJOR_VERSION</a>,        <font class="comment">// major version</font>
00576   <a class="code" href="gromacsplugin_8C.html#a2">GROMACS_PLUGIN_MINOR_VERSION</a>,        <font class="comment">// minor version</font>
00577   <a class="code" href="vmdplugin_8h.html#a11">VMDPLUGIN_THREADUNSAFE</a>,              <font class="comment">// is not reentrant</font>
00578   <font class="stringliteral">"xtc"</font>,                               <font class="comment">// filename extension</font>
00579   <a class="code" href="gromacsplugin_8C.html#a15">open_trr_read</a>,
00580   0,
00581   0,
00582   <a class="code" href="gromacsplugin_8C.html#a16">read_trr_timestep</a>,
00583   <a class="code" href="gromacsplugin_8C.html#a17">close_trr_read</a>,
00584   0,                                  <font class="comment">// open_write</font>
00585   0,                                  <font class="comment">// write_structure</font>
00586   0,                                  <font class="comment">// write_timestep</font>
00587   0,                                  <font class="comment">// close_write</font>
00588   0,                                  <font class="comment">// read_volumetric_metadata</font>
00589   0,                                  <font class="comment">// read_volumetric_data</font>
00590   0                                   <font class="comment">// read_rawgraphics</font>
00591 };
00592 
<a name="l00593"></a><a class="code" href="gromacsplugin_8C.html#a21">00593</a> <a class="code" href="vmdplugin_8h.html#a7">VMDPLUGIN_API</a> <font class="keywordtype">int</font> <a class="code" href="vmdplugin_8h.html#a5">VMDPLUGIN_init</a>() { 
00594   <font class="keywordflow">return</font> 0; 
00595 }
00596 
<a name="l00597"></a><a class="code" href="gromacsplugin_8C.html#a22">00597</a> <a class="code" href="vmdplugin_8h.html#a7">VMDPLUGIN_API</a> <font class="keywordtype">int</font> <a class="code" href="vmdplugin_8h.html#a3">VMDPLUGIN_register</a>(<font class="keywordtype">void</font> *v, <a class="code" href="vmdplugin_8h.html#a15">vmdplugin_register_cb</a> cb) {
00598   (*cb)(v, (<a class="code" href="structvmdplugin__t.html">vmdplugin_t</a> *)&amp;gro_plugin);
00599   (*cb)(v, (<a class="code" href="structvmdplugin__t.html">vmdplugin_t</a> *)&amp;g96_plugin);
00600   (*cb)(v, (<a class="code" href="structvmdplugin__t.html">vmdplugin_t</a> *)&amp;trr_plugin);
00601   (*cb)(v, (<a class="code" href="structvmdplugin__t.html">vmdplugin_t</a> *)&amp;xtc_plugin);
00602   <font class="keywordflow">return</font> 0;
00603 }
00604 
<a name="l00605"></a><a class="code" href="gromacsplugin_8C.html#a23">00605</a> <a class="code" href="vmdplugin_8h.html#a7">VMDPLUGIN_API</a> <font class="keywordtype">int</font> <a class="code" href="vmdplugin_8h.html#a6">VMDPLUGIN_fini</a>() {
00606   <font class="keywordflow">return</font> 0;
00607 }
00608 
00609   
00610 <font class="preprocessor">#ifdef TEST_G96_PLUGIN</font>
00611 <font class="preprocessor"></font>
00612 <font class="keywordtype">int</font> <a class="code" href="main_8c.html#a3">main</a>(<font class="keywordtype">int</font> argc, <font class="keywordtype">char</font> *argv[]) {
00613   <font class="keywordtype">int</font> natoms;
00614   
00615   <a class="code" href="structmolfile__timestep__t.html">molfile_timestep_t</a> timestep;
00616   <font class="keywordtype">void</font> *v;
00617   <font class="keywordtype">int</font> i;
00618 
00619   <font class="keywordflow">if</font> (argc &lt; 2) <font class="keywordflow">return</font> 1;
00620   <font class="keywordflow">while</font> (--argc) {
00621     ++argv;
00622     v = <a class="code" href="gromacsplugin_8C.html#a11">open_g96_read</a>(*argv, <font class="stringliteral">"g96"</font>, &amp;natoms);
00623     <font class="keywordflow">if</font> (!v) {
00624       fprintf(stderr, <font class="stringliteral">"open_g96_read failed for file %s\n"</font>, *argv);
00625       <font class="keywordflow">return</font> 1;
00626     }
00627     timestep.<a class="code" href="structmolfile__timestep__t.html#m0">coords</a> = (<font class="keywordtype">float</font> *)malloc(3*<font class="keyword">sizeof</font>(<font class="keywordtype">float</font>)*natoms);
00628     i = 0;
00629     <font class="keywordflow">while</font>(!<a class="code" href="gromacsplugin_8C.html#a13">read_g96_timestep</a>(v, natoms, &amp;timestep)) {
00630       ++i;
00631     }
00632     fprintf(stderr, <font class="stringliteral">"ended read_g96_timestep on step %d\n"</font>, i);
00633     free(timestep.<a class="code" href="structmolfile__timestep__t.html#m0">coords</a>);
00634     <a class="code" href="gromacsplugin_8C.html#a14">close_g96_read</a>(v);
00635   }
00636   <font class="keywordflow">return</font> 0;
00637 }
00638 
00639 <font class="preprocessor">#endif</font>
00640 <font class="preprocessor"></font>
00641 <font class="preprocessor">#ifdef TEST_TRR_PLUGIN</font>
00642 <font class="preprocessor"></font>
00643 <font class="keywordtype">int</font> <a class="code" href="main_8c.html#a3">main</a>(<font class="keywordtype">int</font> argc, <font class="keywordtype">char</font> *argv[]) {
00644   <font class="keywordtype">int</font> natoms;
00645   
00646   <a class="code" href="structmolfile__timestep__t.html">molfile_timestep_t</a> timestep;
00647   <font class="keywordtype">void</font> *v, *w;
00648   <font class="keywordtype">int</font> i;
00649 
00650   <font class="keywordflow">if</font> (argc != 3) <font class="keywordflow">return</font> 1;
00651   v = <a class="code" href="gromacsplugin_8C.html#a15">open_trr_read</a>(argv[1], <font class="stringliteral">"trr"</font>, &amp;natoms);
00652   <font class="keywordflow">if</font> (!v) {
00653     fprintf(stderr, <font class="stringliteral">"open_trr_read failed for file %s\n"</font>, argv[1]);
00654     <font class="keywordflow">return</font> 1;
00655   }
00656   timestep.<a class="code" href="structmolfile__timestep__t.html#m0">coords</a> = (<font class="keywordtype">float</font> *)malloc(3*<font class="keyword">sizeof</font>(<font class="keywordtype">float</font>)*natoms);
00657   w = <a class="code" href="gromacsplugin_8C.html#a18">open_trr_write</a>(argv[2], <font class="stringliteral">"trr"</font>, natoms);
00658   <font class="keywordflow">if</font> (!w) {
00659     fprintf(stderr, <font class="stringliteral">"open_trr_write failed for file %s\n"</font>, argv[2]);
00660     <font class="keywordflow">return</font> 1;
00661   }
00662   
00663   i = 0;
00664   <font class="keywordflow">while</font>(!<a class="code" href="gromacsplugin_8C.html#a16">read_trr_timestep</a>(v, natoms, &amp;timestep)) {
00665     ++i;
00666     <font class="keywordflow">if</font> (<a class="code" href="gromacsplugin_8C.html#a19">write_trr_timestep</a>(w, &amp;timestep)) {
00667       fprintf(stderr, <font class="stringliteral">"write error\n"</font>);
00668       <font class="keywordflow">return</font> 1;
00669     }
00670   }
00671   
00672   fprintf(stderr, <font class="stringliteral">"ended read_trr_timestep on step %d\n"</font>, i);
00673   free(timestep.<a class="code" href="structmolfile__timestep__t.html#m0">coords</a>);
00674   <a class="code" href="gromacsplugin_8C.html#a17">close_trr_read</a>(v);
00675   <a class="code" href="gromacsplugin_8C.html#a20">close_trr_write</a>(w);
00676   <font class="keywordflow">return</font> 0;
00677 }
00678 
00679 <font class="preprocessor">#endif</font>
00680 <font class="preprocessor"></font>
</pre></div><hr><address><small>Generated on Wed Mar 22 13:15:30 2006 for VMD Plugins (current) by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.14 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2002</small></address>
</body>
</html>
