<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>corplugin.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.14 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>corplugin.c</h1><a href="corplugin_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/***************************************************************************</font>
00002 <font class="comment"> *cr</font>
00003 <font class="comment"> *cr            (C) Copyright 1995-2006 The Board of Trustees of the</font>
00004 <font class="comment"> *cr                        University of Illinois</font>
00005 <font class="comment"> *cr                         All Rights Reserved</font>
00006 <font class="comment"> *cr</font>
00007 <font class="comment"> ***************************************************************************/</font>
00008 
00009 <font class="comment">/***************************************************************************</font>
00010 <font class="comment"> * RCS INFORMATION:</font>
00011 <font class="comment"> *</font>
00012 <font class="comment"> *      $RCSfile: corplugin.c,v $</font>
00013 <font class="comment"> *      $Author: johns $       $Locker:  $             $State: Exp $</font>
00014 <font class="comment"> *      $Revision: 1.26 $       $Date: 2006/02/23 19:36:44 $</font>
00015 <font class="comment"> *</font>
00016 <font class="comment"> ***************************************************************************/</font>
00017 
00018 <font class="comment">/*</font>
00019 <font class="comment"> * This plugin reads molecular coordinate data stored in </font>
00020 <font class="comment"> * CHARMM Cartesian Coordinate format (ascii text format, not binary).</font>
00021 <font class="comment"> *    http://www.charmm.org/</font>
00022 <font class="comment"> *    http://brooks.scripps.edu/charmm_docs/TSRI_docs-list.htm</font>
00023 <font class="comment"> */</font>
00024 
00025 <font class="preprocessor">#include "<a class="code" href="molfile__plugin_8h.html">molfile_plugin.h</a>"</font>
00026 
00027 <font class="preprocessor">#include &lt;stdio.h&gt;</font>
00028 <font class="preprocessor">#include &lt;string.h&gt;</font>
00029 <font class="preprocessor">#include &lt;stdlib.h&gt;</font>
00030 
<a name="l00031"></a><a class="code" href="corplugin_8c.html#a0">00031</a> <font class="preprocessor">#define COR_RECORD_LENGTH   141 </font><font class="comment">/* 80 */</font>
00032 
00033 <font class="comment">/* Remove leading and trailing whitespace from the string str of size n */</font>
<a name="l00034"></a><a class="code" href="corplugin_8c.html#a2">00034</a> <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="corplugin_8c.html#a2">strip_whitespace</a>(<font class="keywordtype">char</font> *str, <font class="keywordtype">int</font> n) {
00035   <font class="keywordtype">char</font> *beg, *end;
00036 
00037   beg = str;
00038   end = str + (n-2); <font class="comment">/* Point to the last non-null character in the string */</font>
00039 
00040   <font class="comment">/* Remove leading whitespace */</font>
00041   <font class="keywordflow">while</font>(beg &lt;= end &amp;&amp; *beg == <font class="charliteral">' '</font>) {
00042     beg++;
00043   }
00044 
00045   <font class="comment">/* Remove trailing whitespace */</font>
00046   <font class="keywordflow">while</font>(end &gt;= str &amp;&amp; *end == <font class="charliteral">' '</font>) {
00047     end--;
00048   }
00049 
00050   <font class="keywordflow">if</font> (beg &lt; end) {
00051     <font class="comment">/* Shift the string */</font>
00052     *(end+1) = <font class="charliteral">'\0'</font>;
00053     memmove(str, beg, (end - beg + 2));
00054   } <font class="keywordflow">else</font> {
00055     str[0] = <font class="charliteral">'\0'</font>;
00056   }
00057 
00058   <font class="keywordflow">return</font>;
00059 }
00060 
00061 <font class="comment">/* Get a string from a stream, printing any errors that occur */</font>
<a name="l00062"></a><a class="code" href="corplugin_8c.html#a3">00062</a> <font class="keyword">static</font> <font class="keywordtype">char</font> *<a class="code" href="corplugin_8c.html#a3">corgets</a>(<font class="keywordtype">char</font> *s, <font class="keywordtype">int</font> n, FILE *stream) {
00063   <font class="keywordtype">char</font> *returnVal;
00064 
00065   <font class="keywordflow">if</font> (feof(stream)) {
00066     printf(<font class="stringliteral">"corplugin) Unexpected end-of-file.\n"</font>);
00067     returnVal = NULL;
00068   } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (ferror(stream)) {
00069     printf(<font class="stringliteral">"corplugin) Error reading file.\n"</font>);
00070     <font class="keywordflow">return</font> NULL;
00071   } <font class="keywordflow">else</font> {
00072     returnVal = fgets(s, n, stream);
00073     <font class="keywordflow">if</font> (returnVal == NULL) {
00074       printf(<font class="stringliteral">"corplugin) Error reading line.\n"</font>);
00075     }
00076   }
00077 
00078   <font class="keywordflow">return</font> returnVal;
00079 }
00080 
00081 
00082 <font class="comment">/* Open the .cor file and skip past the remarks to the first data section.</font>
00083 <font class="comment"> * Returns the file pointer, or NULL if error.  Also puts the number of</font>
00084 <font class="comment"> * atoms in the molecule into the given integer.  </font>
00085 <font class="comment"> */</font>
<a name="l00086"></a><a class="code" href="corplugin_8c.html#a4">00086</a> <font class="keyword">static</font> FILE *<a class="code" href="corplugin_8c.html#a4">open_cor_file</a>(<font class="keyword">const</font> <font class="keywordtype">char</font> *fname, <font class="keywordtype">int</font> *natom, <font class="keywordtype">int</font> *iofoext) {
00087   <font class="keywordtype">char</font> inbuf[<a class="code" href="corplugin_8c.html#a0">COR_RECORD_LENGTH</a>+2], header[11];
00088   FILE *f;
00089 
00090   *natom = <a class="code" href="molfile__plugin_8h.html#a7">MOLFILE_NUMATOMS_NONE</a>;
00091 
00092   <font class="keywordflow">if</font> (!fname) {
00093     printf(<font class="stringliteral">"corplugin) Error opening file: no filename given.\n"</font>);
00094     <font class="keywordflow">return</font> NULL;
00095   }
00096 
00097   <font class="keywordflow">if</font> ((f = fopen(fname, <font class="stringliteral">"r"</font>)) == NULL) {
00098     printf(<font class="stringliteral">"corplugin) Error opening file.\n"</font>);
00099     <font class="keywordflow">return</font> NULL;
00100   }
00101 
00102   <font class="comment">/* Read and discard the header */</font>
00103   <font class="keywordflow">do</font> {
00104     <font class="keywordflow">if</font> (fgets(inbuf, <a class="code" href="corplugin_8c.html#a0">COR_RECORD_LENGTH</a>+1, f) == NULL) {
00105       fclose(f);
00106       printf(<font class="stringliteral">"corplugin) Error opening file: cannot read line.\n"</font>);
00107       <font class="keywordflow">return</font> NULL;
00108     }
00109 
00110     <font class="keywordflow">if</font> (sscanf(inbuf, <font class="stringliteral">"%10c"</font>, header) != 1) {
00111       fclose(f);
00112       printf(<font class="stringliteral">"corplugin) Error opening file: improperly formatted line.\n"</font>);
00113       <font class="keywordflow">return</font> NULL;
00114     }
00115 
00116   } <font class="keywordflow">while</font> (header[0]==<font class="charliteral">'*'</font>);
00117 
00118   <font class="comment">/* check for EXT keyword */</font>
00119   *iofoext = 0 ;
00120   <font class="keywordflow">if</font> (strstr(inbuf,<font class="stringliteral">"EXT"</font>) != NULL) 
00121     *iofoext = 1;
00122 
00123   <font class="comment">/* check atom count */</font>
00124   header[10] = <font class="charliteral">'\0'</font>;
00125   *natom = atoi(header);
00126   <font class="keywordflow">if</font> (*natom &gt; 99999) 
00127     *iofoext = 1;
00128 
00129   <font class="keywordflow">if</font> (*iofoext == 1)
00130     printf(<font class="stringliteral">"corplugin) Using EXTended CHARMM coordinates file\n"</font>);
00131 
00132   <font class="keywordflow">return</font> f;
00133 }
00134 
00135 <font class="comment">/* Read in the next atom info into the given storage areas; this assumes</font>
00136 <font class="comment">   that file has already been moved to the beginning of the atom records.</font>
00137 <font class="comment">   Returns the serial number of the atom. If there is an error, returns -1.*/</font>
<a name="l00138"></a><a class="code" href="corplugin_8c.html#a5">00138</a> <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="corplugin_8c.html#a5">get_cor_atom</a>(FILE *f, <font class="keywordtype">char</font> *atomName, <font class="keywordtype">char</font> *atomType, <font class="keywordtype">char</font>
00139     *resName, <font class="keywordtype">char</font> *segName, <font class="keywordtype">int</font> *resId, <font class="keywordtype">int</font> ioext) {
00140   <font class="keywordtype">char</font> inbuf[<a class="code" href="corplugin_8c.html#a0">COR_RECORD_LENGTH</a>+2], numAtomStr[11], resNStr[11], resIdStr[11];
00141   <font class="keywordtype">char</font> atomNameStr[11], segNameStr[11], resNameStr[11];
00142   <font class="keywordtype">int</font> numAtom;
00143 
00144   <font class="keywordflow">if</font> (<a class="code" href="corplugin_8c.html#a3">corgets</a>(inbuf, <a class="code" href="corplugin_8c.html#a0">COR_RECORD_LENGTH</a>+1, f) == NULL) {
00145     <font class="keywordflow">return</font> -1;
00146   }
00147 
00148   <font class="keywordflow">if</font> (strlen(inbuf) &lt; 60) {
00149     printf(<font class="stringliteral">"corplugin) Line too short: \n%s\n"</font>, inbuf);
00150     <font class="keywordflow">return</font> -1;
00151   }
00152 
00153   memset(numAtomStr, 0, <font class="keyword">sizeof</font>(numAtomStr));
00154   memset(resNStr, 0, <font class="keyword">sizeof</font>(resNStr));
00155   memset(resIdStr, 0, <font class="keyword">sizeof</font>(resIdStr));
00156   memset(resNameStr, 0, <font class="keyword">sizeof</font>(resNameStr));
00157   memset(segNameStr, 0, <font class="keyword">sizeof</font>(segNameStr));
00158   memset(atomNameStr, 0, <font class="keyword">sizeof</font>(atomNameStr));
00159 
00160   <font class="comment">/*</font>
00161 <font class="comment"></font>
00162 <font class="comment">    CHARMM has a variety of input formats for the</font>
00163 <font class="comment">       read coor card</font>
00164 <font class="comment">    command. In order to support all of them the simplest would be to replace </font>
00165 <font class="comment"></font>
00166 <font class="comment">    if (sscanf(inbuf, "%5c%5c%5c%5c%*10c%*10c%*10c%5c", </font>
00167 <font class="comment"></font>
00168 <font class="comment">    with</font>
00169 <font class="comment"></font>
00170 <font class="comment">    if (sscanf(inbuf, "%s %s %s %s %*s %*s %*s %s", </font>
00171 <font class="comment"></font>
00172 <font class="comment">    However this solution has 2 problems:</font>
00173 <font class="comment">     1. buffer overruns</font>
00174 <font class="comment">     2. it doesn't handle the cases where X,Y,Z values have no spaces in-between</font>
00175 <font class="comment"></font>
00176 <font class="comment">    In this fix we handle only two most important cases, depending on</font>
00177 <font class="comment">     the value of IOFOrmat command (either EXTEnded or NOEXtended):</font>
00178 <font class="comment">     EXT:    2I10,2X,A8,2X,A8,3F20.10,2X,A8,2X,A8,F20.10</font>
00179 <font class="comment">     NOEXT:  2I5,1X,A4,1X,A4,3F10.5,1X,A4,1X,A4,F10.5</font>
00180 <font class="comment"></font>
00181 <font class="comment">    This implementation introduces new flag iofoext in cordata</font>
00182 <font class="comment">    structure, which can choose between the 2 formats. Note that</font>
00183 <font class="comment">    CHARMM adds EXT keyword in the coordinate and psf files in the</font>
00184 <font class="comment">    case of IOFO EXTE command in the input script, or automatically</font>
00185 <font class="comment">    when there are 100,000 or more atoms in the system!</font>
00186 <font class="comment"></font>
00187 <font class="comment">  */</font>
00188 
00189   <font class="keywordflow">if</font> (ioext == 1 ) {
00190     <font class="keywordflow">if</font> (sscanf(inbuf, <font class="stringliteral">"%10c%10c%10c%10c%*20c%*20c%*20c%10c%10c"</font>,
00191                numAtomStr, resNStr, resNameStr, atomNameStr, segNameStr, resIdStr) != 6) {
00192       printf(<font class="stringliteral">"corplugin) Improperly formatted line: \n%s\n"</font>, inbuf);
00193       <font class="keywordflow">return</font> -1;
00194     }
00195     <a class="code" href="corplugin_8c.html#a2">strip_whitespace</a>(resName, <font class="keyword">sizeof</font>(resName));  <font class="comment">// strip from long original</font>
00196     <a class="code" href="corplugin_8c.html#a2">strip_whitespace</a>(atomName, <font class="keyword">sizeof</font>(atomName));
00197     <a class="code" href="corplugin_8c.html#a2">strip_whitespace</a>(segName, <font class="keyword">sizeof</font>(segName));
00198     memcpy(resName, resNameStr, 7);              <font class="comment">// XXX truncate extra chars</font>
00199     memcpy(atomName, atomNameStr, 7);
00200     memcpy(segName, segNameStr, 7);
00201     resName[7] = <font class="charliteral">'\0'</font>;                           <font class="comment">// NUL terminate strings..</font>
00202     atomName[7] = <font class="charliteral">'\0'</font>;
00203     segName[7] = <font class="charliteral">'\0'</font>;
00204   } <font class="keywordflow">else</font> {
00205     <font class="keywordflow">if</font> (sscanf(inbuf, <font class="stringliteral">"%5c%5c%5c%5c%*10c%*10c%*10c%5c%5c"</font>,
00206                numAtomStr, resNStr, resName, atomName, segName, resIdStr) != 6) {
00207       printf(<font class="stringliteral">"corplugin) Improperly formatted line: \n%s\n"</font>, inbuf);
00208       <font class="keywordflow">return</font> -1;
00209     }
00210     <a class="code" href="corplugin_8c.html#a2">strip_whitespace</a>(resName, 8);
00211     <a class="code" href="corplugin_8c.html#a2">strip_whitespace</a>(atomName, 8);
00212     <a class="code" href="corplugin_8c.html#a2">strip_whitespace</a>(segName, 8);
00213   }
00214 
00215   numAtom = atoi(numAtomStr);
00216   *resId = atoi(resIdStr);
00217   strcpy(atomType, atomName);
00218 
00219   <font class="keywordflow">return</font> numAtom;
00220 }
00221 
00222 
00223 <font class="comment">/*</font>
00224 <font class="comment"> * API functions</font>
00225 <font class="comment"> */</font>
00226 
<a name="l00227"></a><a class="code" href="structcordata.html">00227</a> <font class="keyword">typedef</font> <font class="keyword">struct </font>{
<a name="l00228"></a><a class="code" href="structcordata.html#m0">00228</a>   FILE *file;
<a name="l00229"></a><a class="code" href="structcordata.html#m1">00229</a>   <font class="keywordtype">int</font> numatoms;
<a name="l00230"></a><a class="code" href="structcordata.html#m2">00230</a>   <font class="keywordtype">int</font> iofoext;      <font class="comment">/* flag for extended CHARMM c31 version support */</font>
00231 } <a class="code" href="structcordata.html">cordata</a>;
00232 
<a name="l00233"></a><a class="code" href="corplugin_8c.html#a6">00233</a> <font class="keyword">static</font> <font class="keywordtype">void</font> *<a class="code" href="corplugin_8c.html#a6">open_cor_read</a>(<font class="keyword">const</font> <font class="keywordtype">char</font> *path, <font class="keyword">const</font> <font class="keywordtype">char</font> *filetype, 
00234     <font class="keywordtype">int</font> *natoms) {
00235   <font class="keywordtype">int</font> ioext ;
00236   FILE *fd;
00237   <a class="code" href="structcordata.html">cordata</a> *cor;
00238 
00239   <font class="keywordflow">if</font> (!(fd = <a class="code" href="corplugin_8c.html#a4">open_cor_file</a>(path, natoms, &amp;ioext))) {
00240     <font class="keywordflow">return</font> NULL;
00241   } 
00242   cor = (<a class="code" href="structcordata.html">cordata</a> *) malloc(<font class="keyword">sizeof</font>(<a class="code" href="structcordata.html">cordata</a>));
00243   memset(cor, 0, <font class="keyword">sizeof</font>(<a class="code" href="structcordata.html">cordata</a>));
00244   cor-&gt;<a class="code" href="structcordata.html#m1">numatoms</a> = *natoms;
00245   cor-&gt;<a class="code" href="structcordata.html#m0">file</a> = fd;
00246   cor-&gt;<a class="code" href="structcordata.html#m2">iofoext</a> = ioext ;
00247   <font class="keywordflow">return</font> cor;
00248 }
00249 
<a name="l00250"></a><a class="code" href="corplugin_8c.html#a7">00250</a> <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="corplugin_8c.html#a7">read_cor_structure</a>(<font class="keywordtype">void</font> *v, <font class="keywordtype">int</font> *optflags, <a class="code" href="structmolfile__atom__t.html">molfile_atom_t</a> *atoms) {
00251   <a class="code" href="structcordata.html">cordata</a> *data = (<a class="code" href="structcordata.html">cordata</a> *)v;
00252   <font class="keywordtype">int</font> i;
00253   
00254   <font class="comment">/* we don't read any optional data */</font>
00255   *optflags = <a class="code" href="molfile__plugin_8h.html#a8">MOLFILE_NOOPTIONS</a>;
00256 
00257   <font class="keywordflow">for</font> (i=0; i&lt;data-&gt;<a class="code" href="structcordata.html#m1">numatoms</a>; i++) {
00258     <a class="code" href="structmolfile__atom__t.html">molfile_atom_t</a> *atom = atoms+i; 
00259     <font class="keywordflow">if</font> (<a class="code" href="corplugin_8c.html#a5">get_cor_atom</a>(data-&gt;<a class="code" href="structcordata.html#m0">file</a>, atom-&gt;<a class="code" href="structmolfile__atom__t.html#m0">name</a>, atom-&gt;<a class="code" href="structmolfile__atom__t.html#m1">type</a>, 
00260                      atom-&gt;<a class="code" href="structmolfile__atom__t.html#m2">resname</a>, atom-&gt;<a class="code" href="structmolfile__atom__t.html#m4">segid</a>, 
00261                      &amp;atom-&gt;<a class="code" href="structmolfile__atom__t.html#m3">resid</a>, data-&gt;<a class="code" href="structcordata.html#m2">iofoext</a>) &lt; 0) {
00262       printf(<font class="stringliteral">"corplugin) couldn't read atom %d\n"</font>, i);
00263       <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a4">MOLFILE_ERROR</a>;
00264     }
00265     atom-&gt;<a class="code" href="structmolfile__atom__t.html#m5">chain</a>[0] = atom-&gt;<a class="code" href="structmolfile__atom__t.html#m4">segid</a>[0];
00266     atom-&gt;<a class="code" href="structmolfile__atom__t.html#m5">chain</a>[1] = <font class="charliteral">'\0'</font>;
00267   }
00268 
00269   rewind(data-&gt;<a class="code" href="structcordata.html#m0">file</a>);
00270   <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a2">MOLFILE_SUCCESS</a>;
00271 }
00272 
<a name="l00273"></a><a class="code" href="corplugin_8c.html#a8">00273</a> <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="corplugin_8c.html#a8">read_cor_timestep</a>(<font class="keywordtype">void</font> *v, <font class="keywordtype">int</font> natoms, <a class="code" href="structmolfile__timestep__t.html">molfile_timestep_t</a> *ts) {
00274   <a class="code" href="structcordata.html">cordata</a> *cor = (<a class="code" href="structcordata.html">cordata</a> *)v;
00275   <font class="keywordtype">char</font> inbuf[<a class="code" href="corplugin_8c.html#a0">COR_RECORD_LENGTH</a>+2], header[6];
00276   <font class="keywordtype">char</font> xStr[21], yStr[21], zStr[21];
00277   <font class="keywordtype">int</font> i;
00278 
00279   xStr[20] = <font class="charliteral">'\0'</font>;
00280   yStr[20] = <font class="charliteral">'\0'</font>;
00281   zStr[20] = <font class="charliteral">'\0'</font>;
00282 
00283   <font class="comment">/* Skip the header */</font>
00284   <font class="keywordflow">do</font> {
00285     <font class="comment">/* Return -1 on EOF */</font>
00286     <font class="keywordflow">if</font> (feof(cor-&gt;<a class="code" href="structcordata.html#m0">file</a>) || ferror(cor-&gt;<a class="code" href="structcordata.html#m0">file</a>) || 
00287         (fgets(inbuf, <a class="code" href="corplugin_8c.html#a0">COR_RECORD_LENGTH</a>+1, cor-&gt;<a class="code" href="structcordata.html#m0">file</a>) == NULL)) {
00288       <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a4">MOLFILE_ERROR</a>;
00289     }
00290 
00291     <font class="keywordflow">if</font> (sscanf(inbuf, <font class="stringliteral">" %5c"</font>, header) != 1) {
00292       printf(<font class="stringliteral">"corplugin) Improperly formatted line.\n"</font>);
00293       <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a4">MOLFILE_ERROR</a>;
00294     }
00295 
00296   } <font class="keywordflow">while</font> (header[0]==<font class="charliteral">'*'</font>);
00297 
00298 
00299   <font class="comment">/* read the coordinates */</font>
00300   <font class="keywordflow">for</font> (i = 0; i &lt; natoms; i++) {
00301     <font class="keywordflow">if</font> (<a class="code" href="corplugin_8c.html#a3">corgets</a>(inbuf, <a class="code" href="corplugin_8c.html#a0">COR_RECORD_LENGTH</a>+1, cor-&gt;<a class="code" href="structcordata.html#m0">file</a>) == NULL) {
00302       <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a4">MOLFILE_ERROR</a>;
00303     }
00304     
00305     <font class="keywordflow">if</font> (cor-&gt;<a class="code" href="structcordata.html#m2">iofoext</a> == 1 ) {
00306       <font class="keywordflow">if</font> (sscanf(inbuf, <font class="stringliteral">"%*10c%*10c%*10c%*10c%20c%20c%20c%*10c"</font>, 
00307                  xStr, yStr, zStr) != 3) {
00308         printf(<font class="stringliteral">"corplugin) Error reading coordinates on line %d.\n%s\n"</font>, i, inbuf);
00309         <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a4">MOLFILE_ERROR</a>;
00310       } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (ts != NULL) {
00311         <font class="comment">/* We have a timestep -- save the coordinates */</font>
00312         ts-&gt;<a class="code" href="structmolfile__timestep__t.html#m0">coords</a>[3*i  ] = atof(xStr);
00313         ts-&gt;<a class="code" href="structmolfile__timestep__t.html#m0">coords</a>[3*i+1] = atof(yStr);
00314         ts-&gt;<a class="code" href="structmolfile__timestep__t.html#m0">coords</a>[3*i+2] = atof(zStr);
00315       }
00316     } <font class="keywordflow">else</font> {
00317       <font class="keywordflow">if</font> (sscanf(inbuf, <font class="stringliteral">"%*5c%*5c%*5c%*5c%10c%10c%10c%*5c"</font>, 
00318                  xStr, yStr, zStr) != 3) {
00319         printf(<font class="stringliteral">"corplugin) Error reading coordinates on line %d.\n%s\n"</font>, i, inbuf);
00320         <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a4">MOLFILE_ERROR</a>;
00321       } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (ts != NULL) {
00322         <font class="comment">/* We have a timestep -- save the coordinates */</font>
00323         ts-&gt;<a class="code" href="structmolfile__timestep__t.html#m0">coords</a>[3*i  ] = atof(xStr);
00324         ts-&gt;<a class="code" href="structmolfile__timestep__t.html#m0">coords</a>[3*i+1] = atof(yStr);
00325         ts-&gt;<a class="code" href="structmolfile__timestep__t.html#m0">coords</a>[3*i+2] = atof(zStr);
00326       }
00327     }
00328   }
00329 
00330   <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a2">MOLFILE_SUCCESS</a>;
00331 }
00332 
<a name="l00333"></a><a class="code" href="corplugin_8c.html#a9">00333</a> <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="corplugin_8c.html#a9">close_cor_read</a>(<font class="keywordtype">void</font> *mydata) {
00334   <a class="code" href="structcordata.html">cordata</a> *data = (<a class="code" href="structcordata.html">cordata</a> *)mydata;
00335   <font class="keywordflow">if</font> (data) {
00336     <font class="keywordflow">if</font> (data-&gt;<a class="code" href="structcordata.html#m0">file</a>) fclose(data-&gt;<a class="code" href="structcordata.html#m0">file</a>);
00337     free(data);
00338   }
00339 }  
00340 
00341 <font class="comment">/*</font>
00342 <font class="comment"> * Initialization stuff down here</font>
00343 <font class="comment"> */</font>
00344 
<a name="l00345"></a><a class="code" href="corplugin_8c.html#a1">00345</a> <font class="keyword">static</font> <a class="code" href="structmolfile__plugin__t.html">molfile_plugin_t</a> <a class="code" href="corplugin_8c.html#a1">plugin</a> = {
00346   <a class="code" href="vmdplugin_8h.html#a10">vmdplugin_ABIVERSION</a>,         <font class="comment">/* ABI version */</font>
00347   <a class="code" href="molfile__plugin_8h.html#a0">MOLFILE_PLUGIN_TYPE</a>,          <font class="comment">/* type */</font>
00348   <font class="stringliteral">"cor"</font>,                        <font class="comment">/* short name */</font>
00349   <font class="stringliteral">"CHARMM Coordinates"</font>,         <font class="comment">/* pretty name */</font>
00350   <font class="stringliteral">"Eamon Caddigan, John Stone"</font>, <font class="comment">/* author */</font>
00351   0,                            <font class="comment">/* major version */</font>
00352   7,                            <font class="comment">/* minor version */</font>
00353   <a class="code" href="vmdplugin_8h.html#a12">VMDPLUGIN_THREADSAFE</a>,         <font class="comment">/* is_reentrant  */</font>
00354   <font class="stringliteral">"cor"</font>,                        <font class="comment">/* filename extensions */</font>
00355   <a class="code" href="corplugin_8c.html#a6">open_cor_read</a>,                <font class="comment">/* open_file_read     */</font>
00356   <a class="code" href="corplugin_8c.html#a7">read_cor_structure</a>,           <font class="comment">/* read_structure     */</font>
00357   0,                            <font class="comment">/* read bond list     */</font>
00358   <a class="code" href="corplugin_8c.html#a8">read_cor_timestep</a>,            <font class="comment">/* read_next_timestep */</font>
00359   <a class="code" href="corplugin_8c.html#a9">close_cor_read</a>                <font class="comment">/* close_file_read    */</font>
00360 };
00361 
<a name="l00362"></a><a class="code" href="corplugin_8c.html#a10">00362</a> <a class="code" href="vmdplugin_8h.html#a7">VMDPLUGIN_API</a> <font class="keywordtype">int</font> <a class="code" href="vmdplugin_8h.html#a5">VMDPLUGIN_init</a>() {
00363   <font class="keywordflow">return</font> <a class="code" href="vmdplugin_8h.html#a13">VMDPLUGIN_SUCCESS</a>;
00364 }
00365 
<a name="l00366"></a><a class="code" href="corplugin_8c.html#a11">00366</a> <a class="code" href="vmdplugin_8h.html#a7">VMDPLUGIN_API</a> <font class="keywordtype">int</font> <a class="code" href="vmdplugin_8h.html#a3">VMDPLUGIN_register</a>(<font class="keywordtype">void</font> *v, <a class="code" href="vmdplugin_8h.html#a15">vmdplugin_register_cb</a> cb) {
00367   (*cb)(v, (<a class="code" href="structvmdplugin__t.html">vmdplugin_t</a> *)&amp;plugin);
00368   <font class="keywordflow">return</font> <a class="code" href="vmdplugin_8h.html#a13">VMDPLUGIN_SUCCESS</a>;
00369 }
00370 
<a name="l00371"></a><a class="code" href="corplugin_8c.html#a12">00371</a> <a class="code" href="vmdplugin_8h.html#a7">VMDPLUGIN_API</a> <font class="keywordtype">int</font> <a class="code" href="vmdplugin_8h.html#a6">VMDPLUGIN_fini</a>() {
00372   <font class="keywordflow">return</font> <a class="code" href="vmdplugin_8h.html#a13">VMDPLUGIN_SUCCESS</a>;
00373 }
</pre></div><hr><address><small>Generated on Wed Mar 22 13:15:28 2006 for VMD Plugins (current) by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.14 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2002</small></address>
</body>
</html>
