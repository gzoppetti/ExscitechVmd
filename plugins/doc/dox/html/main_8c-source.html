<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>main.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.14 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>main.c</h1><a href="main_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/***************************************************************************</font>
00002 <font class="comment"> *cr</font>
00003 <font class="comment"> *cr            (C) Copyright 1995-2006 The Board of Trustees of the</font>
00004 <font class="comment"> *cr                        University of Illinois</font>
00005 <font class="comment"> *cr                         All Rights Reserved</font>
00006 <font class="comment"> *cr</font>
00007 <font class="comment"> ***************************************************************************/</font>
00008 
00009 <font class="comment">/***************************************************************************</font>
00010 <font class="comment"> * RCS INFORMATION:</font>
00011 <font class="comment"> *</font>
00012 <font class="comment"> *      $RCSfile: main.c,v $</font>
00013 <font class="comment"> *      $Author: johns $       $Locker:  $             $State: Exp $</font>
00014 <font class="comment"> *      $Revision: 1.12 $       $Date: 2006/01/05 00:05:53 $</font>
00015 <font class="comment"> *</font>
00016 <font class="comment"> ***************************************************************************/</font>
00017 
00018 <font class="comment">/*</font>
00019 <font class="comment"> * A general main for testing plugins.  </font>
00020 <font class="comment"> * Compile using: gcc main.c plugin.c -I../../include -o plugintest</font>
00021 <font class="comment"> * Replace plugin.c with the plugin file you want to test.</font>
00022 <font class="comment"> * Usage: plugintest &lt;filetype&gt; &lt;file&gt; </font>
00023 <font class="comment"> */</font>
00024 
00025 <font class="preprocessor">#include &lt;stdio.h&gt;</font>
00026 <font class="preprocessor">#include &lt;stdlib.h&gt;</font>
00027 <font class="preprocessor">#include &lt;string.h&gt;</font>
00028 <font class="preprocessor">#include "<a class="code" href="molfile__plugin_8h.html">molfile_plugin.h</a>"</font>
00029 
<a name="l00030"></a><a class="code" href="main_8c.html#a0">00030</a> <font class="keyword">static</font> <a class="code" href="structmolfile__plugin__t.html">molfile_plugin_t</a> *<a class="code" href="main_8c.html#a0">plugin</a> = 0;
<a name="l00031"></a><a class="code" href="main_8c.html#a1">00031</a> <font class="keyword">static</font> <font class="keyword">const</font> <font class="keywordtype">char</font> *<a class="code" href="main_8c.html#a1">filetype</a> = NULL;
00032 
<a name="l00033"></a><a class="code" href="main_8c.html#a2">00033</a> <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="main_8c.html#a2">register_cb</a>(<font class="keywordtype">void</font> *v, <a class="code" href="structvmdplugin__t.html">vmdplugin_t</a> *p) {
00034   <font class="keywordflow">if</font> (!strcmp(p-&gt;type, <a class="code" href="molfile__plugin_8h.html#a0">MOLFILE_PLUGIN_TYPE</a>) &amp;&amp; !strcmp(p-&gt;name, <a class="code" href="main_8c.html#a1">filetype</a>))
00035     plugin = (<a class="code" href="structmolfile__plugin__t.html">molfile_plugin_t</a> *)p;
00036 
00037   <font class="keywordflow">return</font> <a class="code" href="vmdplugin_8h.html#a13">VMDPLUGIN_SUCCESS</a>;
00038 }
00039 
<a name="l00040"></a><a class="code" href="main_8c.html#a3">00040</a> <font class="keywordtype">int</font> <a class="code" href="main_8c.html#a3">main</a>(<font class="keywordtype">int</font> argc, <font class="keywordtype">char</font> *argv[]) {
00041   <font class="keyword">const</font> <font class="keywordtype">char</font> *filename;
00042   <font class="keywordtype">int</font> rc, natoms;
00043   <a class="code" href="structmolfile__timestep__t.html">molfile_timestep_t</a> timestep;
00044   <font class="keywordtype">void</font> *handle;
00045 
00046   <font class="keywordflow">if</font> (argc &lt; 3) {
00047     fprintf(stderr, <font class="stringliteral">"Usage: %s &lt;filetype&gt; &lt;filename&gt;\n"</font>, argv[0]);
00048     <font class="keywordflow">return</font> 1;
00049   }
00050   <a class="code" href="main_8c.html#a1">filetype</a> = argv[1];
00051   filename = argv[2];
00052  
00053   vmdplugin_init();
00054   vmdplugin_register(NULL, <a class="code" href="main_8c.html#a2">register_cb</a>);
00055   <font class="keywordflow">if</font> (!plugin) {
00056     fprintf(stderr, <font class="stringliteral">"No plugin for filetype %s was linked in!\n"</font>, <a class="code" href="main_8c.html#a1">filetype</a>);
00057     <font class="keywordflow">return</font> 1;
00058   }
00059   
00060   <font class="keywordflow">if</font> (!plugin-&gt;<a class="code" href="structmolfile__plugin__t.html#m1">open_file_read</a>) {
00061     fprintf(stdout, <font class="stringliteral">"FAILED: No open_file_read found.\n"</font>);
00062     <font class="keywordflow">return</font> 1;
00063   } 
00064   handle = plugin-&gt;<a class="code" href="structmolfile__plugin__t.html#m1">open_file_read</a>(filename, <a class="code" href="main_8c.html#a1">filetype</a>, &amp;natoms);
00065   <font class="keywordflow">if</font> (!handle) {
00066     fprintf(stderr, <font class="stringliteral">"FAILED: open_file_read returned NULL\n"</font>);
00067     <font class="keywordflow">return</font> 1;
00068   }
00069   printf(<font class="stringliteral">"Opened file %s; found %d atoms\n"</font>, 
00070     filename, natoms);
00071   <font class="keywordflow">if</font> (plugin-&gt;<a class="code" href="structmolfile__plugin__t.html#m2">read_structure</a>) {
00072     <font class="keywordtype">int</font> optflags;
00073     <a class="code" href="structmolfile__atom__t.html">molfile_atom_t</a> *atoms;
00074     atoms = (<a class="code" href="structmolfile__atom__t.html">molfile_atom_t</a> *)malloc(natoms * <font class="keyword">sizeof</font>(<a class="code" href="structmolfile__atom__t.html">molfile_atom_t</a>));
00075     rc = plugin-&gt;<a class="code" href="structmolfile__plugin__t.html#m2">read_structure</a>(handle, &amp;optflags, atoms);
00076     <font class="keywordflow">if</font> (rc) {
00077       fprintf(stderr, <font class="stringliteral">"FAILED: read_structure returned %d\n"</font>, rc);
00078       plugin-&gt;<a class="code" href="structmolfile__plugin__t.html#m5">close_file_read</a>(handle);
00079       <font class="keywordflow">return</font> 1;
00080     } <font class="keywordflow">else</font> {
00081       printf(<font class="stringliteral">"Succesfully read atom structure information.\n"</font>);
00082     }
00083     <font class="keywordflow">if</font> (plugin-&gt;<a class="code" href="structmolfile__plugin__t.html#m3">read_bonds</a>) {
00084       <font class="keywordtype">int</font> nbonds, *from, *to;
00085       <font class="keywordflow">if</font> ((rc = plugin-&gt;<a class="code" href="structmolfile__plugin__t.html#m3">read_bonds</a>(handle, &amp;nbonds, &amp;from, &amp;to))) {
00086         fprintf(stderr, <font class="stringliteral">"FAILED: read_bonds returned %d\n"</font>, rc);
00087       } <font class="keywordflow">else</font> {
00088         printf(<font class="stringliteral">"read_bonds read %d bonds\n"</font>, nbonds);
00089         free(from);
00090         free(to);
00091       }
00092     } <font class="keywordflow">else</font> {
00093       printf(<font class="stringliteral">"File contains no bond information\n"</font>);
00094     }
00095   }
00096   <font class="keywordflow">if</font> (plugin-&gt;<a class="code" href="structmolfile__plugin__t.html#m4">read_next_timestep</a>) {
00097     <font class="keywordtype">int</font> nsteps = 0;
00098     timestep.<a class="code" href="structmolfile__timestep__t.html#m0">coords</a> = (<font class="keywordtype">float</font> *)malloc(3*natoms*<font class="keyword">sizeof</font>(<font class="keywordtype">float</font>));
00099     <font class="keywordflow">while</font> (!(rc = plugin-&gt;<a class="code" href="structmolfile__plugin__t.html#m4">read_next_timestep</a>(handle, natoms, &amp;timestep))) 
00100       nsteps++;
00101     free(timestep.<a class="code" href="structmolfile__timestep__t.html#m0">coords</a>);
00102     <font class="keywordflow">if</font> (rc != -1) {
00103       fprintf(stderr, <font class="stringliteral">"FAILED: read_next_timestep returned %d\n"</font>, rc);
00104     } <font class="keywordflow">else</font> {
00105       printf(<font class="stringliteral">"successfully read %d timesteps\n"</font>, nsteps);
00106     }
00107   }
00108   plugin-&gt;<a class="code" href="structmolfile__plugin__t.html#m5">close_file_read</a>(handle); 
00109 
00110   vmdplugin_fini();
00111   printf(<font class="stringliteral">"Tests finished.\n"</font>);
00112   <font class="keywordflow">return</font> 0;
00113 }
00114 
</pre></div><hr><address><small>Generated on Wed Mar 22 13:15:30 2006 for VMD Plugins (current) by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.14 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2002</small></address>
</body>
</html>
