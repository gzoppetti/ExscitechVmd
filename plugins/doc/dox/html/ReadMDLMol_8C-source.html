<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>ReadMDLMol.C Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.14 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>ReadMDLMol.C</h1><a href="ReadMDLMol_8C.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/***************************************************************************</font>
00002 <font class="comment"> *cr                                                                       </font>
00003 <font class="comment"> *cr            (C) Copyright 1995-2006 The Board of Trustees of the           </font>
00004 <font class="comment"> *cr                        University of Illinois                       </font>
00005 <font class="comment"> *cr                         All Rights Reserved                        </font>
00006 <font class="comment"> *cr                                                                   </font>
00007 <font class="comment"> *cr    Portions contributed and copyright (C) 1998 by Andrew Dalke and</font>
00008 <font class="comment"> *cr    Bioreason, Inc.                                                </font>
00009 <font class="comment"> *cr                                                                   </font>
00010 <font class="comment"> *cr    Some information comes from the Daylight Information Systems'</font>
00011 <font class="comment"> *cr    contrib program "mol2smi" which was placed into the public domain.</font>
00012 <font class="comment"> *cr                                                                   </font>
00013 <font class="comment"> ***************************************************************************/</font>
00014 
00015 <font class="comment">/***************************************************************************</font>
00016 <font class="comment"> * RCS INFORMATION:</font>
00017 <font class="comment"> *</font>
00018 <font class="comment"> *      $RCSfile: ReadMDLMol.C,v $</font>
00019 <font class="comment"> *      $Author: johns $        $Locker:  $             $State: Exp $</font>
00020 <font class="comment"> *      $Revision: 1.10 $       $Date: 2003/12/31 20:14:01 $</font>
00021 <font class="comment"> *</font>
00022 <font class="comment"> ***************************************************************************</font>
00023 <font class="comment"> * DESCRIPTION:</font>
00024 <font class="comment"> *</font>
00025 <font class="comment"> *  Read and write from the MDL ".mol" file format</font>
00026 <font class="comment"> *</font>
00027 <font class="comment"> ***************************************************************************/</font>
00028 
00029 <font class="preprocessor">#include "<a class="code" href="ReadMDLMol_8h.html">ReadMDLMol.h</a>"</font>
00030 <font class="preprocessor">#include "Molecule.h"</font>
00031 <font class="preprocessor">#include "Atom.h"</font>
00032 
<a name="l00033"></a><a class="code" href="ReadMDLMol_8C.html#a0">00033</a> <font class="keywordtype">int</font> <a class="code" href="ReadMDLMol_8C.html#a0">read_mdl_header</a>(FILE *infile, <font class="keywordtype">int</font> *natoms, <font class="keywordtype">int</font> *nbonds)
00034 {
00035   <font class="comment">// skip the first three lines, the slow way</font>
00036   <font class="keywordtype">int</font> i;
00037   <font class="keywordflow">for</font> (<font class="keywordtype">int</font> count = 0; count &lt; 3; count++) {
00038     <font class="keywordflow">while</font> (1) {
00039       i = fgetc(infile);
00040       <font class="comment">//printf("Read: %c\n", i);</font>
00041       <font class="keywordflow">if</font> (i == EOF) {
00042         <font class="keywordflow">return</font> 0;
00043       }
00044       <font class="keywordflow">if</font> (i == <font class="charliteral">'\n'</font>) {
00045         <font class="keywordflow">break</font>;
00046       }
00047     }
00048   }
00049   <font class="comment">// read the sizes</font>
00050   i = fscanf(infile, <font class="stringliteral">"%d %d\n"</font>, natoms, nbonds);
00051   <font class="keywordflow">if</font> (i != 2) {
00052     <font class="keywordflow">return</font> 0;
00053   }
00054   <font class="keywordflow">return</font> 1;
00055 }
00056 
<a name="l00057"></a><a class="code" href="ReadMDLMol_8C.html#a1">00057</a> <font class="keywordtype">int</font> <a class="code" href="ReadMDLMol_8C.html#a1">write_mdl_atom</a>(FILE *outfile, <font class="keyword">const</font> <a class="code" href="structmdl__atom.html">mdl_atom</a>&amp; atom)
00058 {
00059 
00060   <font class="keywordtype">int</font> i = fprintf(outfile,
00061                   <font class="stringliteral">"%10.4f%10.4f%10.4f %-3s%2d%3d%3d%3d%3d%3d\n"</font>,
00062                   atom.<a class="code" href="structmdl__atom.html#m0">x</a>, atom.<a class="code" href="structmdl__atom.html#m1">y</a>, atom.<a class="code" href="structmdl__atom.html#m2">z</a>,
00063                   atom.<a class="code" href="structmdl__atom.html#m3">symbol</a>, atom.<a class="code" href="structmdl__atom.html#m4">mass_difference</a>,
00064                   atom.<a class="code" href="structmdl__atom.html#m5">charge</a>, atom.<a class="code" href="structmdl__atom.html#m6">stereo_parity</a>,
00065                   atom.<a class="code" href="structmdl__atom.html#m7">hcount</a>, atom.<a class="code" href="structmdl__atom.html#m8">stereo_care_box</a>,
00066                   atom.<a class="code" href="structmdl__atom.html#m9">valence</a>);
00067   <font class="keywordflow">return</font> i &gt; 0;
00068     
00069 }
00070 
<a name="l00071"></a><a class="code" href="ReadMDLMol_8C.html#a2">00071</a> <font class="keywordtype">int</font> <a class="code" href="ReadMDLMol_8C.html#a2">read_mdl_atom</a>(FILE *infile, <a class="code" href="structmdl__atom.html">mdl_atom</a> *atom)
00072 {
00073   <font class="comment">// read the line</font>
00074   <font class="comment">//    From the Daylight contrib code 'mol2smi'</font>
00075   <font class="comment">//  ATOM LOOP: Note that atom indices start at one...  If an</font>
00076   <font class="comment">//  atom is not interpreted, go to next CT.  Charge is decoded</font>
00077   <font class="comment">//  by the formula: charge = (4 - charge_code)  Note that</font>
00078   <font class="comment">//  atoms are added with (hcount) implicit hydrogens.</font>
00079   <font class="comment">//</font>
00080   <font class="comment">//  The format is:</font>
00081   <font class="comment">//  xxxxx.xxxxyyyyy.yyyyzzzzz.zzzz aaaddcccssshhhbbbvvv</font>
00082   <font class="comment">//  12345678901234567890123456789012345678901234567890123456789</font>
00083   <font class="comment">//          |10       |20       |30       |40       |50        </font>
00084   <font class="comment">//</font>
00085   <font class="comment">//  xyz's   - coordinates           sss    - stereo parity </font>
00086   <font class="comment">//  aaa     - atom symbol           hhh    - (hcount + 1)</font>
00087   <font class="comment">//  dd      - mass difference       bbb    - stereo care box</font>
00088   <font class="comment">//  ccc     - (4 - charge)          vvv    - valence</font>
00089   <font class="comment">//</font>
00090 
00091   <font class="comment">// I forgot how to do this correctly, and it isn't very important</font>
00092   <font class="keywordtype">char</font> s[201];
00093   <font class="keywordflow">if</font> (!fgets(s, 200, infile)) {
00094     <font class="keywordflow">return</font> 0;
00095   }
00096   
00097   <font class="keywordtype">int</font> i = sscanf(s, <font class="stringliteral">"%10f%10f%10f %3s%2d%3d%3d%3d%3d%3d"</font>,
00098                  &amp;(atom-&gt;<a class="code" href="structmdl__atom.html#m0">x</a>), &amp;(atom-&gt;<a class="code" href="structmdl__atom.html#m1">y</a>), &amp;(atom-&gt;<a class="code" href="structmdl__atom.html#m2">z</a>),
00099                  &amp;(atom-&gt;<a class="code" href="structmdl__atom.html#m3">symbol</a>), &amp;(atom-&gt;<a class="code" href="structmdl__atom.html#m4">mass_difference</a>),
00100                  &amp;(atom-&gt;<a class="code" href="structmdl__atom.html#m5">charge</a>), &amp;(atom-&gt;<a class="code" href="structmdl__atom.html#m6">stereo_parity</a>),
00101                  &amp;(atom-&gt;<a class="code" href="structmdl__atom.html#m7">hcount</a>), &amp;(atom-&gt;<a class="code" href="structmdl__atom.html#m8">stereo_care_box</a>),
00102                  &amp;(atom-&gt;<a class="code" href="structmdl__atom.html#m9">valence</a>));
00103 
00104   <font class="keywordflow">return</font> i &gt;= 8;
00105 }
00106 
<a name="l00107"></a><a class="code" href="ReadMDLMol_8C.html#a3">00107</a> <font class="keywordtype">int</font> <a class="code" href="ReadMDLMol_8C.html#a3">read_mdl_bond</a>(FILE *infile, <a class="code" href="structmdl__bond.html">mdl_bond</a> *bond)
00108 {
00109   <font class="comment">// Again, quoting from mol2smi</font>
00110   <font class="comment">// BOND LOOP: </font>
00111   <font class="comment">//  </font>
00112   <font class="comment">//  The format is:</font>
00113   <font class="comment">//  111222tttsssxxxrrrccc</font>
00114   <font class="comment">//  12345678901234567890123456789</font>
00115   <font class="comment">//           |10       |20       </font>
00116   <font class="comment">//</font>
00117   <font class="comment">//  111  -  bond_from</font>
00118   <font class="comment">//  222  -  bond_to</font>
00119   <font class="comment">//  ttt  -  bond_type</font>
00120   <font class="comment">//  sss  -  bond_stereo</font>
00121   <font class="comment">// I'm not sure how the other fields are used.</font>
00122 
00123   <font class="keywordtype">char</font> s[201];
00124   <font class="keywordflow">if</font> (!fgets(s, 200, infile)) {
00125     <font class="keywordflow">return</font> 0;
00126   }
00127   <font class="keywordtype">int</font> i = sscanf(s, <font class="stringliteral">"%3d%3d%3d%3d"</font>,
00128                  &amp;(bond-&gt;<a class="code" href="structmdl__bond.html#m0">bond_from</a>), &amp;(bond-&gt;<a class="code" href="structmdl__bond.html#m1">bond_to</a>),
00129                  &amp;(bond-&gt;<a class="code" href="structmdl__bond.html#m2">bond_type</a>), &amp;(bond-&gt;<a class="code" href="structmdl__bond.html#m3">bond_stereo</a>)
00130                  );
00131   <font class="keywordflow">return</font> i == 4;
00132 }
<a name="l00133"></a><a class="code" href="ReadMDLMol_8C.html#a4">00133</a> <font class="keywordtype">int</font> <a class="code" href="ReadMDLMol_8C.html#a4">write_mdl_bond</a>(FILE *infile, <font class="keyword">const</font> <a class="code" href="structmdl__bond.html">mdl_bond</a>&amp; bond)
00134 {
00135   <font class="keywordtype">int</font> i = fprintf(infile, <font class="stringliteral">"%3d%3d%3d%3d\n"</font>,
00136                   bond.<a class="code" href="structmdl__bond.html#m0">bond_from</a>, bond.<a class="code" href="structmdl__bond.html#m1">bond_to</a>,
00137                   bond.<a class="code" href="structmdl__bond.html#m2">bond_type</a>, bond.<a class="code" href="structmdl__bond.html#m3">bond_stereo</a>
00138                   );
00139   <font class="keywordflow">return</font> i &gt; 0;
00140 }
00141 
<a name="l00142"></a><a class="code" href="ReadMDLMol_8C.html#a5">00142</a> <font class="keywordtype">int</font> <a class="code" href="ReadMDLMol_8C.html#a5">write_mdl_trailer</a>(FILE *outfile)
00143 {
00144   <font class="keywordtype">int</font> i = fprintf(outfile, <font class="stringliteral">"\n%%%%\n"</font>);
00145   <font class="keywordflow">return</font> i &gt; 0;
00146 }
00147 
00148 
<a name="l00149"></a><a class="code" href="ReadMDLMol_8C.html#a6">00149</a> <font class="keywordtype">int</font> <a class="code" href="ReadMDLMol_8C.html#a6">molecule_mdl</a>(Molecule *mol, <font class="keyword">const</font> <font class="keywordtype">char</font> *molfile) {
00150   FILE *infile = fopen(molfile, <font class="stringliteral">"rt"</font>);
00151   <font class="keywordflow">if</font> (!infile) {
00152     <font class="keywordflow">return</font> <a class="code" href="gamessplugin_8h.html#a6">FALSE</a>;
00153   }
00154   <font class="keywordtype">int</font> num_atoms, num_bonds;
00155 
00156   <font class="keywordflow">if</font> (!<a class="code" href="ReadMDLMol_8C.html#a0">read_mdl_header</a>(infile, &amp;num_atoms, &amp;num_bonds)) {
00157     fclose(infile);
00158     <font class="keywordflow">return</font> <a class="code" href="gamessplugin_8h.html#a6">FALSE</a>;
00159   }
00160   <font class="keywordtype">int</font> i;
00161 
00162   <a class="code" href="structmdl__atom.html">mdl_atom</a> atom;
00163   <font class="keywordtype">float</font> pos[3];
00164 
00165   <font class="keywordtype">float</font> newdata[ATOMEXTRA];
00166   newdata[ATOMBETA] = mol-&gt;default_beta();
00167   newdata[ATOMOCCUP] = mol-&gt;default_occup();
00168 
00169   <font class="keywordflow">for</font> (i=0; i&lt;num_atoms; i++) {
00170     <font class="keywordflow">if</font> (!<a class="code" href="ReadMDLMol_8C.html#a2">read_mdl_atom</a>(infile, &amp;atom)) {
00171       fclose(infile);
00172       <font class="keywordflow">return</font> <a class="code" href="gamessplugin_8h.html#a6">FALSE</a>;
00173     }
00174     pos[0] = atom.<a class="code" href="structmdl__atom.html#m0">x</a>;
00175     pos[1] = atom.<a class="code" href="structmdl__atom.html#m1">y</a>;
00176     pos[2] = atom.<a class="code" href="structmdl__atom.html#m2">z</a>;
00177 
00178     newdata[ATOMCHARGE] = (float) 4.0 - atom.<a class="code" href="structmdl__atom.html#m5">charge</a>;
00179     newdata[ATOMMASS] = mol-&gt;default_mass(atom.<a class="code" href="structmdl__atom.html#m3">symbol</a>) + atom.<a class="code" href="structmdl__atom.html#m4">mass_difference</a>;
00180     newdata[ATOMRAD] = mol-&gt;default_radius(atom.<a class="code" href="structmdl__atom.html#m3">symbol</a>);
00181     mol-&gt;add_atom(atom.<a class="code" href="structmdl__atom.html#m3">symbol</a>, atom.<a class="code" href="structmdl__atom.html#m3">symbol</a>, <font class="stringliteral">"UNK"</font>, 0, <font class="stringliteral">" "</font>, <font class="stringliteral">"UNK"</font>, pos,
00182              newdata);
00183   }
00184   
00185   <a class="code" href="structmdl__bond.html">mdl_bond</a> bond;
00186   <font class="keywordflow">for</font> (i=0; i&lt;num_bonds; i++) {
00187     <font class="keywordflow">if</font> (!<a class="code" href="ReadMDLMol_8C.html#a3">read_mdl_bond</a>(infile, &amp;bond)) {
00188       fclose(infile);
00189       <font class="keywordflow">return</font> <a class="code" href="gamessplugin_8h.html#a6">FALSE</a>;
00190     }
00191     <font class="keywordtype">int</font> bf = bond.<a class="code" href="structmdl__bond.html#m0">bond_from</a> - 1;
00192     <font class="keywordtype">int</font> bt = bond.<a class="code" href="structmdl__bond.html#m1">bond_to</a> - 1;
00193     <font class="keywordflow">if</font> (bf &gt;= 0 &amp;&amp; bf &lt; num_atoms &amp;&amp;
00194         bt &gt;= 0 &amp;&amp; bt &lt; num_atoms) {
00195       mol-&gt;add_bond(bond.<a class="code" href="structmdl__bond.html#m0">bond_from</a>, bond.<a class="code" href="structmdl__bond.html#m1">bond_to</a>);
00196     }
00197   }
00198 
00199   fclose(infile);
00200   <font class="keywordflow">return</font> <a class="code" href="gamessplugin_8h.html#a7">TRUE</a>;
00201 }
00202 
00203 
00204 
00205 
</pre></div><hr><address><small>Generated on Wed Mar 22 13:15:31 2006 for VMD Plugins (current) by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.14 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2002</small></address>
</body>
</html>
