<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>readpdb.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.14 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>readpdb.h</h1><a href="readpdb_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/***************************************************************************</font>
00002 <font class="comment"> *cr</font>
00003 <font class="comment"> *cr            (C) Copyright 1995-2006 The Board of Trustees of the</font>
00004 <font class="comment"> *cr                        University of Illinois</font>
00005 <font class="comment"> *cr                         All Rights Reserved</font>
00006 <font class="comment"> *cr</font>
00007 <font class="comment"> ***************************************************************************/</font>
00008 
00009 <font class="comment">/***************************************************************************</font>
00010 <font class="comment"> * RCS INFORMATION:</font>
00011 <font class="comment"> *</font>
00012 <font class="comment"> *      $RCSfile: readpdb.h,v $</font>
00013 <font class="comment"> *      $Author: johns $       $Locker:  $             $State: Exp $</font>
00014 <font class="comment"> *      $Revision: 1.38 $       $Date: 2006/03/01 19:55:25 $</font>
00015 <font class="comment"> *</font>
00016 <font class="comment"> ***************************************************************************/</font>
00017 
00018 <font class="preprocessor">#ifndef READ_PDB_H</font>
00019 <font class="preprocessor"></font><font class="preprocessor">#define READ_PDB_H</font>
00020 <font class="preprocessor"></font>
00021 <font class="preprocessor">#include &lt;stdio.h&gt;</font>
00022 <font class="preprocessor">#include &lt;stdlib.h&gt;</font>
00023 <font class="preprocessor">#include &lt;string.h&gt;</font>
00024 
<a name="l00025"></a><a class="code" href="readpdb_8h.html#a0">00025</a> <font class="preprocessor">#define PDB_RECORD_LENGTH   80   </font><font class="comment">/* actual record size */</font>
<a name="l00026"></a><a class="code" href="readpdb_8h.html#a1">00026</a> <font class="preprocessor">#define PDB_BUFFER_LENGTH   83   </font><font class="comment">/* size need to buffer + CR, LF, and NUL */</font>
00027 
<a name="l00028"></a><a class="code" href="readpdb_8h.html#a2">00028</a> <font class="preprocessor">#define VMDUSECONECTRECORDS 1</font>
00029 <font class="preprocessor"></font>
00030 <font class="comment">/*  record type defines */</font>
00031 <font class="keyword">enum</font> {
00032   <a class="code" href="readpdb_8h.html#a19a3">PDB_HEADER</a>, <a class="code" href="readpdb_8h.html#a19a4">PDB_REMARK</a>, <a class="code" href="readpdb_8h.html#a19a5">PDB_ATOM</a>, <a class="code" href="readpdb_8h.html#a19a6">PDB_CONECT</a>, <a class="code" href="readpdb_8h.html#a19a7">PDB_UNKNOWN</a>, <a class="code" href="readpdb_8h.html#a19a8">PDB_END</a>, <a class="code" href="readpdb_8h.html#a19a9">PDB_EOF</a>, <a class="code" href="readpdb_8h.html#a19a10">PDB_CRYST1</a>
00033 };
00034 
00035 <font class="comment">/* read the next record from the specified pdb file, and put the string found</font>
00036 <font class="comment">   in the given string pointer (the caller must provide adequate (81 chars)</font>
00037 <font class="comment">   buffer space); return the type of record found</font>
00038 <font class="comment">*/</font>
<a name="l00039"></a><a class="code" href="readpdb_8h.html#a11">00039</a> <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="readpdb_8h.html#a11">read_pdb_record</a>(FILE *f, <font class="keywordtype">char</font> *retStr) {
00040   <font class="keywordtype">int</font> ch;
00041   <font class="keywordtype">char</font> inbuf[<a class="code" href="readpdb_8h.html#a1">PDB_BUFFER_LENGTH</a>]; <font class="comment">/* space for line + cr + lf + NUL */</font>
00042   <font class="keywordtype">int</font> recType = <a class="code" href="readpdb_8h.html#a19a7">PDB_UNKNOWN</a>;
00043  
00044   <font class="comment">/* XXX This PDB record reading code breaks with files that use</font>
00045 <font class="comment">   * Mac or DOS style line breaks with ctrl-M characters.  We need</font>
00046 <font class="comment">   * to replace the use of fgets() and comparisons against \n with</font>
00047 <font class="comment">   * code that properly handles the other cases.</font>
00048 <font class="comment">   */</font>
00049  
00050   <font class="comment">/* read the next line, including any ending cr/lf char */</font>
00051   <font class="keywordflow">if</font> (inbuf != fgets(inbuf, <a class="code" href="readpdb_8h.html#a0">PDB_RECORD_LENGTH</a> + 2, f)) {
00052     retStr[0] = <font class="charliteral">'\0'</font>;
00053     recType = <a class="code" href="readpdb_8h.html#a19a9">PDB_EOF</a>;
00054   } <font class="keywordflow">else</font> {
00055 <font class="preprocessor">#if 0</font>
00056 <font class="preprocessor"></font>    <font class="comment">/* XXX disabled this code since \n chars are desirable in remarks */</font>
00057     <font class="comment">/* and to make the behavior consistent with webpdbplugin          */</font>
00058 
00059     <font class="comment">/* remove the newline character, if there is one */</font>
00060     <font class="keywordflow">if</font> (inbuf[strlen(inbuf)-1] == <font class="charliteral">'\n'</font>)
00061       inbuf[strlen(inbuf)-1] = <font class="charliteral">'\0'</font>;
00062 <font class="preprocessor">#endif</font>
00063 <font class="preprocessor"></font>
00064     <font class="comment">/* atom records are the most common */</font>
00065     <font class="keywordflow">if</font> (!strncmp(inbuf, <font class="stringliteral">"ATOM "</font>,  5) || !strncmp(inbuf, <font class="stringliteral">"HETATM"</font>, 6)) {
00066       <font class="comment">/* Note that by only comparing 5 chars for "ATOM " rather than 6,     */</font>
00067       <font class="comment">/* we allow PDB files containing &gt; 99,999 atoms generated by AMBER    */</font>
00068       <font class="comment">/* to load which would otherwise fail.  Not needed for HETATM since   */</font>
00069       <font class="comment">/* those aren't going to show up in files produced for/by MD engines. */</font>
00070       recType = <a class="code" href="readpdb_8h.html#a19a5">PDB_ATOM</a>;
00071     } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (!strncmp(inbuf, <font class="stringliteral">"CONECT"</font>, 6)) {
00072       recType = <a class="code" href="readpdb_8h.html#a19a6">PDB_CONECT</a>;
00073     } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (!strncmp(inbuf, <font class="stringliteral">"REMARK"</font>, 6)) {
00074       recType = <a class="code" href="readpdb_8h.html#a19a4">PDB_REMARK</a>;
00075     } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (!strncmp(inbuf, <font class="stringliteral">"CRYST1"</font>, 6)) {
00076       recType = <a class="code" href="readpdb_8h.html#a19a10">PDB_CRYST1</a>;
00077     } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (!strncmp(inbuf, <font class="stringliteral">"HEADER"</font>, 6)) {
00078       recType = <a class="code" href="readpdb_8h.html#a19a3">PDB_HEADER</a>;
00079     } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (!strncmp(inbuf, <font class="stringliteral">"END"</font>, 3)) {  <font class="comment">/* very permissive */</font>
00080       <font class="comment">/* XXX we treat any "ENDxxx" record as an end, to simplify testing */</font>
00081       <font class="comment">/*     since we don't remove trailing '\n' chars                   */</font>
00082 
00083       <font class="comment">/* the only two legal END records are "END   " and "ENDMDL" */</font>
00084       recType = <a class="code" href="readpdb_8h.html#a19a8">PDB_END</a>;
00085     } 
00086 
00087 <font class="preprocessor">#if 0</font>
00088 <font class="preprocessor"></font>    <font class="comment">/* XXX disable record type checking for now */</font>
00089     <font class="keywordflow">if</font> (recType == <a class="code" href="readpdb_8h.html#a19a5">PDB_ATOM</a> || 
00090         recType == <a class="code" href="readpdb_8h.html#a19a6">PDB_CONECT</a> || 
00091         recType == <a class="code" href="readpdb_8h.html#a19a4">PDB_REMARK</a> || 
00092         recType == <a class="code" href="readpdb_8h.html#a19a3">PDB_HEADER</a> || 
00093         recType == <a class="code" href="readpdb_8h.html#a19a10">PDB_CRYST1</a>) {
00094       strcpy(retStr, inbuf);
00095     } <font class="keywordflow">else</font> {
00096       retStr[0] = <font class="charliteral">'\0'</font>;
00097     }
00098 <font class="preprocessor">#else</font>
00099 <font class="preprocessor"></font>    strcpy(retStr, inbuf);
00100 <font class="preprocessor">#endif</font>
00101 <font class="preprocessor"></font>  }
00102 
00103   <font class="comment">/* read the '\r', if there was one */</font>
00104   ch = fgetc(f);
00105   <font class="keywordflow">if</font> (ch != <font class="charliteral">'\r'</font>)
00106     ungetc(ch, f);
00107   
00108   <font class="keywordflow">return</font> recType;
00109 }
00110 
00111 
00112 <font class="comment">/* Extract the alpha/beta/gamma a/b/c unit cell info from a CRYST1 record */</font>
<a name="l00113"></a><a class="code" href="readpdb_8h.html#a12">00113</a> <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="readpdb_8h.html#a12">get_pdb_cryst1</a>(<font class="keyword">const</font> <font class="keywordtype">char</font> *record, 
00114                            <font class="keywordtype">float</font> *alpha, <font class="keywordtype">float</font> *beta, <font class="keywordtype">float</font> *gamma, 
00115                            <font class="keywordtype">float</font> *a, <font class="keywordtype">float</font> *b, <font class="keywordtype">float</font> *c) {
00116   <font class="keywordtype">char</font> tmp[<a class="code" href="readpdb_8h.html#a0">PDB_RECORD_LENGTH</a>+3]; <font class="comment">/* space for line + cr + lf + NUL */</font>
00117   <font class="keywordtype">char</font> ch, *s;
00118   memset(tmp, 0, <font class="keyword">sizeof</font>(tmp));
00119   strncpy(tmp, record, <a class="code" href="readpdb_8h.html#a0">PDB_RECORD_LENGTH</a>);
00120 
00121   s = tmp+6 ;          ch = tmp[15]; tmp[15] = 0;
00122   *a = (float) atof(s);
00123   s = tmp+15; *s = ch; ch = tmp[24]; tmp[24] = 0;
00124   *b = (float) atof(s);
00125   s = tmp+24; *s = ch; ch = tmp[33]; tmp[33] = 0;
00126   *c = (float) atof(s);
00127   s = tmp+33; *s = ch; ch = tmp[40]; tmp[40] = 0;
00128   *alpha = (float) atof(s);
00129   s = tmp+40; *s = ch; ch = tmp[47]; tmp[47] = 0;
00130   *beta = (float) atof(s);
00131   s = tmp+47; *s = ch; ch = tmp[54]; tmp[54] = 0;
00132   *gamma = (float) atof(s);
00133 }
00134 
00135 
00136 <font class="comment">/* Extract the x,y,z coords, occupancy, and beta from an ATOM record */</font>
<a name="l00137"></a><a class="code" href="readpdb_8h.html#a13">00137</a> <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="readpdb_8h.html#a13">get_pdb_coordinates</a>(<font class="keyword">const</font> <font class="keywordtype">char</font> *record, 
00138                                 <font class="keywordtype">float</font> *x, <font class="keywordtype">float</font> *y, <font class="keywordtype">float</font> *z,
00139                                 <font class="keywordtype">float</font> *occup, <font class="keywordtype">float</font> *beta) {
00140   <font class="keywordtype">char</font> numstr[50]; <font class="comment">/* store all fields in one array to save memset calls */</font>
00141   memset(numstr, 0, <font class="keyword">sizeof</font>(numstr));
00142 
00143   <font class="keywordflow">if</font> (x != NULL) {
00144     strncpy(numstr, record + 30, 8);
00145     *x = (float) atof(numstr);
00146   }
00147 
00148   <font class="keywordflow">if</font> (y != NULL) {
00149     strncpy(numstr+10, record + 38, 8);
00150     *y = (float) atof(numstr+10);
00151   }
00152 
00153   <font class="keywordflow">if</font> (z != NULL) {
00154     strncpy(numstr+20, record + 46, 8);
00155     *z = (float) atof(numstr+20);
00156   }
00157 
00158   <font class="keywordflow">if</font> (occup != NULL) {
00159     strncpy(numstr+30, record + 54, 6);
00160     *occup = (float) atof(numstr+30);
00161   }
00162 
00163   <font class="keywordflow">if</font> (beta != NULL) {
00164     strncpy(numstr+40, record + 60, 6);
00165     *beta = (float) atof(numstr+40);
00166   }
00167 }
00168 
00169 
00170 <font class="comment">/* remove leading and trailing spaces from PDB fields */</font>
<a name="l00171"></a><a class="code" href="readpdb_8h.html#a14">00171</a> <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="readpdb_8h.html#a14">adjust_pdb_field_string</a>(<font class="keywordtype">char</font> *field) {
00172   <font class="keywordtype">int</font> i, len;
00173 
00174   len = strlen(field);
00175   <font class="keywordflow">while</font> (len &gt; 0 &amp;&amp; field[len-1] == <font class="charliteral">' '</font>) {
00176     field[len-1] = <font class="charliteral">'\0'</font>;
00177     len--;
00178   }
00179 
00180   <font class="keywordflow">while</font> (len &gt; 0 &amp;&amp; field[0] == <font class="charliteral">' '</font>) {
00181     <font class="keywordflow">for</font> (i=0; i &lt; len; i++)
00182       field[i] = field[i+1];
00183     len--;
00184   }
00185 }
00186 
<a name="l00187"></a><a class="code" href="readpdb_8h.html#a15">00187</a> <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="readpdb_8h.html#a15">get_pdb_header</a>(<font class="keyword">const</font> <font class="keywordtype">char</font> *record, <font class="keywordtype">char</font> *pdbcode, <font class="keywordtype">char</font> *date,
00188                            <font class="keywordtype">char</font> *classification) {
00189   <font class="keywordflow">if</font> (date != NULL) {
00190     strncpy(date, record + 50, 9);
00191     date[9] = <font class="charliteral">'\0'</font>;
00192   }
00193 
00194   <font class="keywordflow">if</font> (classification != NULL) {
00195     strncpy(classification, record + 10, 40);
00196     classification[40] = <font class="charliteral">'\0'</font>;
00197   }
00198 
00199   <font class="keywordflow">if</font> (pdbcode != NULL) {
00200     strncpy(pdbcode, record + 62, 4);
00201     pdbcode[4] = <font class="charliteral">'\0'</font>;
00202     <a class="code" href="readpdb_8h.html#a14">adjust_pdb_field_string</a>(pdbcode); <font class="comment">/* remove spaces from accession code */</font>
00203   }
00204 }
00205 
00206 
<a name="l00207"></a><a class="code" href="readpdb_8h.html#a16">00207</a> <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="readpdb_8h.html#a16">get_pdb_conect</a>(<font class="keyword">const</font> <font class="keywordtype">char</font> *record, <font class="keywordtype">int</font> natoms, <font class="keywordtype">int</font> *idxmap,
00208                            <font class="keywordtype">int</font> *maxbnum, <font class="keywordtype">int</font> *nbonds, <font class="keywordtype">int</font> **from, <font class="keywordtype">int</font> **to) {
00209   <font class="keywordtype">int</font> bondto[11], numbonds, i;
00210 
00211   <font class="keywordtype">int</font> reclen = strlen(record);
00212   <font class="keywordflow">for</font> (numbonds=0, i=0; i&lt;11; i++) {
00213     <font class="keywordtype">char</font> bondstr[6];
00214     <font class="keyword">const</font> <font class="keywordtype">int</font> fieldwidth = 5;
00215     <font class="keywordtype">int</font> start = 6 + i*fieldwidth;
00216     <font class="keywordtype">int</font> end = start + fieldwidth;
00217 
00218     <font class="keywordflow">if</font> (end &gt;= reclen)
00219       <font class="keywordflow">break</font>;
00220 
00221     memcpy(bondstr, record + start, fieldwidth);
00222     bondstr[5] = <font class="charliteral">'\0'</font>;
00223     <font class="keywordflow">if</font> (sscanf(bondstr, <font class="stringliteral">"%d"</font>, &amp;bondto[numbonds]) &lt; 0)
00224       <font class="keywordflow">break</font>;
00225     numbonds++; 
00226   }
00227 
00228   <font class="keywordflow">for</font> (i=0; i&lt;numbonds; i++) {
00229     <font class="comment">/* only add one bond per pair, PDBs list them redundantly */</font> 
00230     <font class="keywordflow">if</font> (bondto[i] &gt; bondto[0]) {
00231       <font class="keywordtype">int</font> newnbonds = *nbonds + 1; <font class="comment">/* add a new bond */</font>
00232 
00233       <font class="comment">/* allocate more bondlist space if necessary */</font>
00234       <font class="keywordflow">if</font> (newnbonds &gt;= *maxbnum) {
00235         <font class="keywordtype">int</font> newmax;
00236         <font class="keywordtype">int</font> *newfromlist, *newtolist;
00237         newmax = (newnbonds + 11) * 1.25;
00238 
00239         newfromlist = (<font class="keywordtype">int</font> *) realloc(*from, newmax * <font class="keyword">sizeof</font>(<font class="keywordtype">int</font>));
00240         newtolist = (<font class="keywordtype">int</font> *) realloc(*to, newmax * <font class="keyword">sizeof</font>(<font class="keywordtype">int</font>));
00241 
00242         <font class="keywordflow">if</font> (newfromlist != NULL || newtolist != NULL) {
00243           *maxbnum = newmax;
00244           *from = newfromlist;
00245           *to = newtolist;
00246         } <font class="keywordflow">else</font> {
00247           printf(<font class="stringliteral">"readpdb) failed to allocate memory for bondlists\n"</font>);
00248           <font class="keywordflow">return</font>; <font class="comment">/* abort */</font>
00249         }
00250       }
00251 
00252       *nbonds = newnbonds;
00253       (*from)[newnbonds-1] = idxmap[bondto[0]] + 1;
00254       (*to)[newnbonds-1] = idxmap[bondto[i]] + 1;
00255     }
00256   }
00257 }
00258 
00259 
00260 <font class="comment">/* Break a pdb ATOM record into its fields.  The user must provide the</font>
00261 <font class="comment">   necessary space to store the atom name, residue name, and segment name.</font>
00262 <font class="comment">   Character strings will be null-terminated.</font>
00263 <font class="comment">*/</font>
<a name="l00264"></a><a class="code" href="readpdb_8h.html#a17">00264</a> <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="readpdb_8h.html#a17">get_pdb_fields</a>(<font class="keyword">const</font> <font class="keywordtype">char</font> *record, <font class="keywordtype">int</font> reclength, <font class="keywordtype">int</font> *serial,
00265                            <font class="keywordtype">char</font> *<a class="code" href="xsfplugin_8C.html#a2">name</a>, <font class="keywordtype">char</font> *resname, <font class="keywordtype">char</font> *chain, 
00266                            <font class="keywordtype">char</font> *segname, <font class="keywordtype">char</font> *resid, <font class="keywordtype">char</font> *insertion, 
00267                            <font class="keywordtype">char</font> *altloc, <font class="keywordtype">char</font> *elementsymbol,
00268                            <font class="keywordtype">float</font> *x, <font class="keywordtype">float</font> *y, <font class="keywordtype">float</font> *z, 
00269                            <font class="keywordtype">float</font> *occup, <font class="keywordtype">float</font> *beta) {
00270   <font class="keywordtype">char</font> serialbuf[6];
00271 
00272   <font class="comment">/* get atom serial number */</font>
00273   strncpy(serialbuf, record + 6, 5);
00274   serialbuf[5] = <font class="charliteral">'\0'</font>;
00275   *serial = 0;
00276   sscanf(serialbuf, <font class="stringliteral">"%5d"</font>, serial);
00277   
00278   <font class="comment">/* get atom name */</font>
00279   strncpy(<a class="code" href="xsfplugin_8C.html#a2">name</a>, record + 12, 4);
00280   <a class="code" href="xsfplugin_8C.html#a2">name</a>[4] = <font class="charliteral">'\0'</font>;
00281   <a class="code" href="readpdb_8h.html#a14">adjust_pdb_field_string</a>(<a class="code" href="xsfplugin_8C.html#a2">name</a>); <font class="comment">/* remove spaces from the name */</font>
00282 
00283   <font class="comment">/* get alternate location identifier */</font>
00284   strncpy(altloc, record + 16, 1);
00285   altloc[1] = <font class="charliteral">'\0'</font>;
00286 
00287   <font class="comment">/* get residue name */</font>
00288   strncpy(resname, record + 17, 4);
00289   resname[4] = <font class="charliteral">'\0'</font>;
00290   <a class="code" href="readpdb_8h.html#a14">adjust_pdb_field_string</a>(resname); <font class="comment">/* remove spaces from the resname */</font>
00291 
00292   <font class="comment">/* get chain name */</font>
00293   chain[0] = record[21];
00294   chain[1] = <font class="charliteral">'\0'</font>;
00295 
00296   <font class="comment">/* get residue id number */</font>
00297   strncpy(resid, record + 22, 4);
00298   resid[4] = <font class="charliteral">'\0'</font>;
00299   <a class="code" href="readpdb_8h.html#a14">adjust_pdb_field_string</a>(resid); <font class="comment">/* remove spaces from the resid */</font>
00300 
00301   <font class="comment">/* get the insertion code */</font>
00302   insertion[0] = record[26];
00303   insertion[1] = <font class="charliteral">'\0'</font>;
00304 
00305   <font class="comment">/* get the atomic element symbol */</font>
00306   strncpy(elementsymbol, record + 76, 2);
00307   elementsymbol[2] = <font class="charliteral">'\0'</font>;
00308 
00309   <font class="comment">/* get x, y, and z coordinates */</font>
00310   <a class="code" href="readpdb_8h.html#a13">get_pdb_coordinates</a>(record, x, y, z, occup, beta);
00311 
00312   <font class="comment">/* get segment name */</font>
00313   <font class="keywordflow">if</font> (reclength &gt;= 73) {
00314     strncpy(segname, record + 72, 4);
00315     segname[4] = <font class="charliteral">'\0'</font>;
00316     <a class="code" href="readpdb_8h.html#a14">adjust_pdb_field_string</a>(segname); <font class="comment">/* remove spaces from the segname */</font>
00317   } <font class="keywordflow">else</font> {
00318     segname[0] = <font class="charliteral">'\0'</font>;
00319   }
00320 }  
00321 
00322 
00323 <font class="comment">/* Write PDB data to given file descriptor; return success. */</font>
<a name="l00324"></a><a class="code" href="readpdb_8h.html#a18">00324</a> <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="readpdb_8h.html#a18">write_raw_pdb_record</a>(FILE *fd, <font class="keyword">const</font> <font class="keywordtype">char</font> *recordname,
00325     <font class="keywordtype">int</font> index,<font class="keyword">const</font> <font class="keywordtype">char</font> *atomname, <font class="keyword">const</font> <font class="keywordtype">char</font> *resname,<font class="keywordtype">int</font> resid, 
00326     <font class="keyword">const</font> <font class="keywordtype">char</font> *insertion, <font class="keyword">const</font> <font class="keywordtype">char</font> *altloc, <font class="keyword">const</font> <font class="keywordtype">char</font> *elementsymbol,
00327     <font class="keywordtype">float</font> x, <font class="keywordtype">float</font> y, <font class="keywordtype">float</font> z, <font class="keywordtype">float</font> occ, <font class="keywordtype">float</font> beta, 
00328     <font class="keyword">const</font> <font class="keywordtype">char</font> *chain, <font class="keyword">const</font> <font class="keywordtype">char</font> *segname) {
00329   <font class="keywordtype">int</font> rc;
00330   <font class="keywordtype">char</font> indexbuf[32];
00331   <font class="keywordtype">char</font> residbuf[32];
00332   <font class="keywordtype">char</font> altlocchar;
00333 
00334   <font class="comment">/* XXX                                                          */</font>
00335   <font class="comment">/* if the atom or residue indices exceed the legal PDB spec, we */</font>
00336   <font class="comment">/* start emitting asterisks or hexadecimal strings rather than  */</font>
00337   <font class="comment">/* aborting.  This is not really legal, but is an accepted hack */</font>
00338   <font class="comment">/* among various other programs that deal with large PDB files  */</font>
00339   <font class="comment">/* If we run out of hexadecimal indices, then we just print     */</font>
00340   <font class="comment">/* asterisks.                                                   */</font>
00341   <font class="keywordflow">if</font> (index &lt; 100000) {
00342     sprintf(indexbuf, <font class="stringliteral">"%5d"</font>, index);
00343   } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (index &lt; 1048576) {
00344     sprintf(indexbuf, <font class="stringliteral">"%05x"</font>, index);
00345   } <font class="keywordflow">else</font> {
00346     sprintf(indexbuf, <font class="stringliteral">"*****"</font>);
00347   }
00348 
00349   <font class="keywordflow">if</font> (resid &lt; 10000) {
00350     sprintf(residbuf, <font class="stringliteral">"%4d"</font>, resid);
00351   } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (resid &lt; 65536) {
00352     sprintf(residbuf, <font class="stringliteral">"%04x"</font>, resid);
00353   } <font class="keywordflow">else</font> { 
00354     sprintf(residbuf, <font class="stringliteral">"****"</font>);
00355   }
00356 
00357   altlocchar = altloc[0];
00358   <font class="keywordflow">if</font> (altlocchar == <font class="charliteral">'\0'</font>) {
00359     altlocchar = <font class="charliteral">' '</font>;
00360   }
00361  
00362   rc = fprintf(fd,
00363          <font class="stringliteral">"%s%5s %4s%c%-4s%c%4s%c   %8.3f%8.3f%8.3f%6.2f%6.2f      %-4s%2s\n"</font>,
00364          recordname, indexbuf, atomname, altlocchar, resname, chain[0], 
00365          residbuf, insertion[0], x, y, z, occ, beta, segname, elementsymbol);
00366 
00367   <font class="keywordflow">return</font> (rc &gt; 0);
00368 }
00369 
00370 <font class="preprocessor">#endif</font>
</pre></div><hr><address><small>Generated on Wed Mar 22 13:15:31 2006 for VMD Plugins (current) by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.14 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2002</small></address>
</body>
</html>
