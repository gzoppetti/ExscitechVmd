<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>lammpspluginA.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.14 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>lammpspluginA.c</h1><a href="lammpspluginA_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/***************************************************************************</font>
00002 <font class="comment"> *cr</font>
00003 <font class="comment"> *cr            (C) Copyright 1995-2005 The Board of Trustees of the</font>
00004 <font class="comment"> *cr                        University of Illinois</font>
00005 <font class="comment"> *cr                         All Rights Reserved</font>
00006 <font class="comment"> *cr</font>
00007 <font class="comment"> ***************************************************************************/</font>
00008 
00009 <font class="comment">/***************************************************************************</font>
00010 <font class="comment"> * RCS INFORMATION:</font>
00011 <font class="comment"> *</font>
00012 <font class="comment"> *      $RCSfile: lammpsplugin.c,v $</font>
00013 <font class="comment"> *      $Author: johns $       $Locker:  $             $State: Exp $</font>
00014 <font class="comment"> *      $Revision: 1.7 $       $Date: 2005/02/16 03:21:16 $</font>
00015 <font class="comment"> *      $Rewritten by Marco Kalweit on 2005/11/11$</font>
00016 <font class="comment"> *</font>
00017 <font class="comment"> ***************************************************************************/</font>
00018 
00019 <font class="comment">/*</font>
00020 <font class="comment"> *  LAMMPS dump file format:</font>
00021 <font class="comment"> *    ITEM: TIMESTEP</font>
00022 <font class="comment"> *      %d (timestep number)</font>
00023 <font class="comment"> *    ITEM: NUMBER OF ATOMS</font>
00024 <font class="comment"> *      %d (number of atoms)</font>
00025 <font class="comment"> *    ITEM: BOX BOUNDS</font>
00026 <font class="comment"> *      %f %f (alpha, a)</font>
00027 <font class="comment"> *      %f %f (beta,  b)</font>
00028 <font class="comment"> *      %f %f (gamma, c)</font>
00029 <font class="comment"> *    ITEM: ATOMS</font>
00030 <font class="comment"> *      %d %d %f %f %f  (atomid, ?, x, y, z)</font>
00031 <font class="comment"> *      ...</font>
00032 <font class="comment"> *</font>
00033 <font class="comment"> *   This file assumes that the number of atoms keeps constant during </font>
00034 <font class="comment"> *   the entire simulation</font>
00035 <font class="comment"> *   The standard file extension is .lammpstrj</font>
00036 <font class="comment"> */</font>
00037 
00038 <font class="preprocessor">#include "<a class="code" href="largefiles_8h.html">largefiles.h</a>"</font>   <font class="comment">/* platform dependent 64-bit file I/O defines */</font>
00039 
00040 <font class="preprocessor">#include &lt;stdio.h&gt;</font>
00041 <font class="preprocessor">#include &lt;stdlib.h&gt;</font>
00042 <font class="preprocessor">#include &lt;string.h&gt;</font>
00043 <font class="preprocessor">#include &lt;ctype.h&gt;</font>
00044 <font class="preprocessor">#include &lt;math.h&gt;</font>
00045 <font class="preprocessor">#include &lt;float.h&gt;</font>
00046 <font class="preprocessor">#include "<a class="code" href="molfile__plugin_8h.html">molfile_plugin.h</a>"</font>
00047 
00048 <font class="preprocessor">#ifndef M_PI_2</font>
<a name="l00049"></a><a class="code" href="lammpspluginA_8c.html#a0">00049</a> <font class="preprocessor"></font><font class="preprocessor">#define M_PI_2 1.57079632679489661922</font>
00050 <font class="preprocessor"></font><font class="preprocessor">#endif</font>
00051 <font class="preprocessor"></font>
00052 <font class="keyword">typedef</font> <font class="keyword">struct </font>{
<a name="l00053"></a><a class="code" href="structlammpsdata.html#m4">00053</a>   FILE *file;
<a name="l00054"></a><a class="code" href="structlammpsdata.html#m1">00054</a>   <font class="keywordtype">int</font> numatoms;
<a name="l00055"></a><a class="code" href="structlammpsdata.html#m5">00055</a>   <font class="keywordtype">char</font> *file_name;
<a name="l00056"></a><a class="code" href="structlammpsdata.html#m6">00056</a>   <a class="code" href="structmolfile__graphics__t.html">molfile_graphics_t</a> *graphlist;
00057 } <a class="code" href="structlammpsdata.html">lammpsdata</a>;
00058  
<a name="l00059"></a><a class="code" href="lammpspluginA_8c.html#a2">00059</a> <font class="keyword">static</font> <font class="keywordtype">char</font>* <a class="code" href="lammpspluginA_8c.html#a2">find_next_item</a>(FILE* fd, <font class="keywordtype">char</font>* szItem) {
00060   <font class="keywordtype">char</font> szLine[1024];
00061   <font class="keywordtype">char</font>* pcolon;
00062   <font class="keywordtype">int</font> nReturn;
00063     
00064   <font class="keywordflow">while</font>(fgets(szLine, 1024, fd)) {
00065     pcolon = strrchr(szLine, <font class="charliteral">':'</font>);
00066     <font class="keywordflow">if</font>(pcolon) {
00067       *pcolon = 0;
00068       <font class="keywordflow">if</font>(0 == strcmp(szLine, <font class="stringliteral">"ITEM"</font>)) {
00069         *pcolon = <font class="charliteral">':'</font>;
00070         pcolon+=2;
00071         strcpy(szItem, pcolon);
00072         nReturn = (int)strcspn(szItem, <font class="stringliteral">"\n\r"</font>); <font class="comment">// remove the carriage return</font>
00073         <font class="keywordflow">if</font>(nReturn) 
00074           szItem[nReturn] = 0;
00075         <font class="keywordflow">return</font> szItem;
00076       }
00077     }
00078   }
00079 
00080   <font class="keywordflow">return</font> NULL;
00081 }
00082 
00083 
<a name="l00084"></a><a class="code" href="lammpspluginA_8c.html#a3">00084</a> <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="lammpspluginA_8c.html#a3">find_item</a>(FILE* fd, <font class="keywordtype">char</font>* szItem) {
00085   <font class="keywordtype">char</font> szBuffer[1024];
00086   <font class="keywordflow">while</font>(<a class="code" href="lammpspluginA_8c.html#a2">find_next_item</a>(fd, szBuffer)) {
00087     <font class="keywordflow">if</font>(0 == strcmp(szBuffer, szItem)) 
00088       <font class="keywordflow">return</font> 1;
00089   }
00090   <font class="keywordflow">return</font> 0;
00091 }
00092 
00093 
<a name="l00094"></a><a class="code" href="lammpspluginA_8c.html#a4">00094</a> <font class="keyword">static</font> <font class="keywordtype">void</font> *<a class="code" href="lammpspluginA_8c.html#a4">open_lammps_read</a>(<font class="keyword">const</font> <font class="keywordtype">char</font> *filename, <font class="keyword">const</font> <font class="keywordtype">char</font> *filetype, <font class="keywordtype">int</font> *natoms) {
00095   FILE *fd;
00096   <a class="code" href="structlammpsdata.html">lammpsdata</a> *data;
00097   <font class="keywordtype">char</font> szBuffer[1024];
00098 
00099   fd = fopen(filename, <font class="stringliteral">"rb"</font>);
00100   <font class="keywordflow">if</font> (!fd) <font class="keywordflow">return</font> NULL;
00101   
00102   data = (<a class="code" href="structlammpsdata.html">lammpsdata</a> *)malloc(<font class="keyword">sizeof</font>(<a class="code" href="structlammpsdata.html">lammpsdata</a>));
00103   data-&gt;<a class="code" href="structlammpsdata.html#m0">file</a> = fd;
00104   data-&gt;<a class="code" href="structlammpsdata.html#m2">file_name</a> = strdup(filename);
00105   data-&gt;<a class="code" href="structlammpsdata.html#m6">graphlist</a> = NULL;
00106   *natoms = 0; 
00107 
00108   <font class="keywordflow">if</font>(!<a class="code" href="lammpspluginA_8c.html#a3">find_item</a>(data-&gt;<a class="code" href="structlammpsdata.html#m0">file</a>, <font class="stringliteral">"NUMBER OF ATOMS"</font>)) {
00109     fprintf(stderr, <font class="stringliteral">"lammpsplugin) Unable to fine 'NUMBER OF ATOMS' item\n"</font>);   
00110     <font class="keywordflow">return</font> NULL;
00111   }
00112   
00113   <font class="keywordflow">if</font>(!fgets(szBuffer, 1024, data-&gt;<a class="code" href="structlammpsdata.html#m0">file</a>)) {
00114     fprintf(stderr, <font class="stringliteral">"lammpsplugin) dump file '%s' should have the number of atoms after line ITEM: NUMBER OF ATOMS.\n"</font>, filename);
00115     <font class="keywordflow">return</font> NULL;
00116   }
00117   *natoms = atoi(szBuffer);
00118   
00119   data-&gt;<a class="code" href="structlammpsdata.html#m1">numatoms</a>=*natoms;
00120   rewind(data-&gt;<a class="code" href="structlammpsdata.html#m0">file</a>); <font class="comment">/* prepare for first read_timestep call */</font>
00121   
00122   <font class="keywordflow">return</font> data;
00123 }
00124 
00125 
<a name="l00126"></a><a class="code" href="lammpspluginA_8c.html#a5">00126</a> <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="lammpspluginA_8c.html#a5">read_lammps_structure</a>(<font class="keywordtype">void</font> *mydata, <font class="keywordtype">int</font> *optflags, <a class="code" href="structmolfile__atom__t.html">molfile_atom_t</a> *atoms) {
00127   <font class="keywordtype">int</font> i, j;
00128   <font class="keywordtype">char</font> szBuffer[1024];
00129   <a class="code" href="structmolfile__atom__t.html">molfile_atom_t</a> *atom;
00130   <a class="code" href="structlammpsdata.html">lammpsdata</a> *data = (<a class="code" href="structlammpsdata.html">lammpsdata</a> *)mydata;
00131   <font class="keywordtype">int</font> atomid;
00132   <font class="keywordtype">char</font> atom_type[1025];
00133   <font class="keywordtype">float</font> x, y, z;
00134   <font class="keywordtype">char</font> *k;
00135 
00136   *optflags = <a class="code" href="molfile__plugin_8h.html#a8">MOLFILE_NOOPTIONS</a>; <font class="comment">// no optional data</font>
00137   
00138   <font class="comment">// go to the beginning of the file</font>
00139   rewind(data-&gt;<a class="code" href="structlammpsdata.html#m0">file</a>); <font class="comment">/* prepare for first read_timestep call */</font>
00140   
00141   <font class="comment">// find the sections with atoms</font>
00142   <font class="keywordflow">if</font>(!<a class="code" href="lammpspluginA_8c.html#a3">find_item</a>(data-&gt;<a class="code" href="structlammpsdata.html#m0">file</a>, <font class="stringliteral">"ATOMS"</font>)) {
00143     fprintf(stderr, <font class="stringliteral">"lammpsplugin) couldn't find atoms to read structure from file '%s'.\n"</font>, data-&gt;<a class="code" href="structlammpsdata.html#m2">file_name</a>);
00144     <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a4">MOLFILE_ERROR</a>;
00145   }
00146 
00147   <font class="comment">// now read the atoms</font>
00149 <font class="comment">  for(i=0;i&lt;data-&gt;numatoms;i++) {</font>
00150     k = fgets(szBuffer, 1024, data-&gt;<a class="code" href="structlammpsdata.html#m0">file</a>);
00151     
00152     <font class="comment">/* Read in atom type, X, Y, Z, skipping any remaining data fields */</font>
00153     j = sscanf(szBuffer, <font class="stringliteral">"%d %s %f %f %f"</font>, &amp;atomid, atom_type, &amp;x, &amp;y, &amp;z);
00154    
00155     <font class="keywordflow">if</font> (k == NULL) {
00156       fprintf(stderr, <font class="stringliteral">"lammpsplugin) Error while reading structure from lammps dump file '%s': atom missing in the first timestep\n"</font>,data-&gt;<a class="code" href="structlammpsdata.html#m2">file_name</a>);
00157       fprintf(stderr, <font class="stringliteral">"lammpsplugin) expecting '%d' atoms, found only '%d'\n"</font>,data-&gt;<a class="code" href="structlammpsdata.html#m1">numatoms</a>,i+1);
00158       <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a4">MOLFILE_ERROR</a>;
00159     } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (j &lt; 5) {
00160       fprintf(stderr, <font class="stringliteral">"lammpsplugin) Error while reading structure from lammps dump file '%s': missing type or coordinate(s) for atom '%d'\n"</font>, data-&gt;<a class="code" href="structlammpsdata.html#m2">file_name</a>, i+1);
00161       <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a4">MOLFILE_ERROR</a>;
00162     }
00163 
00164     atom = atoms + i;
00165     sprintf(atom-&gt;<a class="code" href="structmolfile__atom__t.html#m0">name</a>, <font class="stringliteral">"%02d"</font>, atomid);
00166     strncpy(atom-&gt;<a class="code" href="structmolfile__atom__t.html#m1">type</a>, atom_type, <font class="keyword">sizeof</font>(atom-&gt;<a class="code" href="structmolfile__atom__t.html#m1">type</a>));
00167     strcpy(atom-&gt;<a class="code" href="structmolfile__atom__t.html#m2">resname</a>, <font class="stringliteral">""</font>);
00168     atom-&gt;<a class="code" href="structmolfile__atom__t.html#m3">resid</a> = 1;
00169     strcpy(atom-&gt;<a class="code" href="structmolfile__atom__t.html#m5">chain</a>, <font class="stringliteral">""</font>);
00170     strcpy(atom-&gt;<a class="code" href="structmolfile__atom__t.html#m4">segid</a>, <font class="stringliteral">""</font>);
00171     <font class="comment">// skip to the end of line</font>
00172   }
00173 
00174   rewind(data-&gt;file);
00175   <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a2">MOLFILE_SUCCESS</a>;
00176 }
00177 
00178 
<a name="l00179"></a><a class="code" href="lammpspluginA_8c.html#a6">00179</a> <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="lammpspluginA_8c.html#a6">read_lammps_timestep</a>(<font class="keywordtype">void</font> *mydata, <font class="keywordtype">int</font> natoms, <a class="code" href="structmolfile__timestep__t.html">molfile_timestep_t</a> *ts) {
00180   <font class="keywordtype">int</font> i, j;
00181   <font class="keywordtype">char</font> atom_name[1025], szBuffer[1025];
00182   <font class="keywordtype">float</font> x, y, z;
00183   <font class="keywordtype">int</font> atomid;
00184   <font class="keywordtype">float</font> lo[3],hi[3], l[3];
00185 
00186   <a class="code" href="structlammpsdata.html">lammpsdata</a> *data = (<a class="code" href="structlammpsdata.html">lammpsdata</a> *)mydata;
00187 
00188   <font class="comment">// check if there is antother time steps</font>
00189   <font class="keywordflow">if</font>(!<a class="code" href="lammpspluginA_8c.html#a3">find_item</a>(data-&gt;<a class="code" href="structlammpsdata.html#m0">file</a>, <font class="stringliteral">"TIMESTEP"</font>)) <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a4">MOLFILE_ERROR</a>; 
00190   
00191   <font class="comment">// check if we actually have to read something</font>
00192   <font class="keywordflow">if</font>(!ts) <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a2">MOLFILE_SUCCESS</a>;
00193 
00194   <font class="comment">// check the number of atoms in the timestep</font>
00195   <font class="keywordflow">if</font>(!<a class="code" href="lammpspluginA_8c.html#a3">find_item</a>(data-&gt;<a class="code" href="structlammpsdata.html#m0">file</a>, <font class="stringliteral">"NUMBER OF ATOMS"</font>)) {
00196     fprintf(stderr, <font class="stringliteral">"lammpsplugin) lammps dump file '%s', unable to find item: NUMBER OF ATOMS for current timestep.\n"</font>, data-&gt;<a class="code" href="structlammpsdata.html#m2">file_name</a>);
00197     <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a4">MOLFILE_ERROR</a>;
00198   }
00199 
00200   <font class="keywordflow">if</font>(!fgets(szBuffer, 1024, data-&gt;<a class="code" href="structlammpsdata.html#m0">file</a>)) {
00201     fprintf(stderr, <font class="stringliteral">"lammpsplugin) lammps dump file '%s', should have the number of atoms after line ITEM: NUMBER OF ATOMS.\n"</font>, data-&gt;<a class="code" href="structlammpsdata.html#m2">file_name</a>);
00202     <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a4">MOLFILE_ERROR</a>;
00203   }
00204 
00205   <font class="keywordflow">if</font>(natoms != atoi(szBuffer)) {
00206     fprintf(stderr, <font class="stringliteral">"lammpsplugin) lammps dump file '%s', wrong number of atoms in timestep.\n"</font>, data-&gt;<a class="code" href="structlammpsdata.html#m2">file_name</a>);
00207     <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a4">MOLFILE_ERROR</a>;
00208   }
00209 
00210   <font class="comment">// read the boundary box of the timestep</font>
00211   <font class="keywordflow">if</font>(!<a class="code" href="lammpspluginA_8c.html#a3">find_item</a>(data-&gt;<a class="code" href="structlammpsdata.html#m0">file</a>, <font class="stringliteral">"BOX BOUNDS"</font>)) {
00212     fprintf(stderr, <font class="stringliteral">"lammpsplugin) lammps dump file '%s', could not find ITEM: BOX BOUNDS.\n"</font>, data-&gt;<a class="code" href="structlammpsdata.html#m2">file_name</a>);
00213     <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a4">MOLFILE_ERROR</a>;
00214   }
00215 
00216   <font class="keywordflow">if</font> (NULL == fgets(szBuffer, 1024, data-&gt;<a class="code" href="structlammpsdata.html#m0">file</a>))  <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a4">MOLFILE_ERROR</a>;
00217   sscanf(szBuffer,<font class="stringliteral">"%f %f"</font>, lo, hi);
00218   l[0] = hi[0] - lo[0];
00219 
00220   <font class="keywordflow">if</font> (NULL == fgets(szBuffer, 1024, data-&gt;<a class="code" href="structlammpsdata.html#m0">file</a>))  <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a4">MOLFILE_ERROR</a>;
00221   sscanf(szBuffer,<font class="stringliteral">"%f %f"</font>, lo+1, hi+1);
00222   l[1] = hi[1] - lo[1];
00223 
00224   <font class="keywordflow">if</font> (NULL == fgets(szBuffer, 1024, data-&gt;<a class="code" href="structlammpsdata.html#m0">file</a>))  <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a4">MOLFILE_ERROR</a>;
00225   sscanf(szBuffer,<font class="stringliteral">"%f %f"</font>, lo+2, hi+2);
00226   l[2] = hi[2] - lo[2];
00227   
00228   ts-&gt;<a class="code" href="structmolfile__timestep__t.html#z4_0">A</a> = l[0];
00229   ts-&gt;<a class="code" href="structmolfile__timestep__t.html#z4_1">B</a> = l[1];
00230   ts-&gt;<a class="code" href="structmolfile__timestep__t.html#z4_2">C</a> = l[2];
00231   ts-&gt;<a class="code" href="structmolfile__timestep__t.html#z4_3">alpha</a> = 90.0;
00232   ts-&gt;<a class="code" href="structmolfile__timestep__t.html#z4_4">beta</a> = 90.0;
00233   ts-&gt;<a class="code" href="structmolfile__timestep__t.html#z4_5">gamma</a> = 90.0;
00234 
00235   <font class="comment">// read the coordinates</font>
00236   <font class="keywordflow">if</font> (!<a class="code" href="lammpspluginA_8c.html#a3">find_item</a>(data-&gt;<a class="code" href="structlammpsdata.html#m0">file</a>, <font class="stringliteral">"ATOMS"</font>)) {
00237     fprintf(stderr, <font class="stringliteral">"lammpsplugin) lammps dump file '%s', could not find ITEM: ATOMS.\n"</font>, data-&gt;<a class="code" href="structlammpsdata.html#m2">file_name</a>);
00238     <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a4">MOLFILE_ERROR</a>;
00239   }
00240 
00241   <font class="keywordflow">for</font> (i=0; i&lt;natoms; i++) {
00242     <font class="keywordflow">if</font>(!fgets(szBuffer, 1024, data-&gt;<a class="code" href="structlammpsdata.html#m0">file</a>)) {
00243       <font class="comment">// there is an error or end of file, both cases should not occur</font>
00244       fprintf(stderr, <font class="stringliteral">"lammpsplugin) lammps dump file '%s', unexpected end of file or error while reading coordinates for atom %d.\n"</font>, data-&gt;<a class="code" href="structlammpsdata.html#m2">file_name</a>, i);
00245       <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a4">MOLFILE_ERROR</a>;
00246     }
00247 
00248     <font class="comment">// Read in atom type, X, Y, Z, skipping any remaining data fields</font>
00249     j = sscanf(szBuffer, <font class="stringliteral">"%d %s %f %f %f"</font>, &amp;atomid, atom_name, &amp;x, &amp;y, &amp;z);
00250     <font class="keywordflow">if</font> (j != 5) {
00251       fprintf(stderr, <font class="stringliteral">"lammpsplugin) lammps dump file '%s', error while parsing coordinates for atom %d.\n"</font>, data-&gt;<a class="code" href="structlammpsdata.html#m2">file_name</a>, i);
00252       <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a4">MOLFILE_ERROR</a>;
00253     }
00254             
00255     <font class="keywordflow">if</font> (atomid &gt; 0 &amp;&amp; atomid &lt;= natoms) {
00256       <font class="keywordtype">int</font> addr = 3 * (atomid - 1);
00257       <font class="comment">/* LAMMPS coordinates are fractional unit cell coords, */</font>
00258       <font class="comment">/* so they need to be scaled by a/b/c etc              */</font>
00259       ts-&gt;<a class="code" href="structmolfile__timestep__t.html#m0">coords</a>[addr    ] = x * l[0];
00260       ts-&gt;<a class="code" href="structmolfile__timestep__t.html#m0">coords</a>[addr + 1] = y * l[1];
00261       ts-&gt;<a class="code" href="structmolfile__timestep__t.html#m0">coords</a>[addr + 2] = z * l[2];
00262     } <font class="keywordflow">else</font> {
00263       fprintf(stderr, <font class="stringliteral">"lammpsplugin) ignoring illegal atom index %d\n"</font>, atomid);
00264     }
00265   }
00266 
00267   <font class="keywordflow">return</font> <a class="code" href="molfile__plugin_8h.html#a2">MOLFILE_SUCCESS</a>;
00268 }
00269   
00270 
<a name="l00271"></a><a class="code" href="lammpspluginA_8c.html#a7">00271</a> <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="lammpspluginA_8c.html#a7">close_lammps_read</a>(<font class="keywordtype">void</font> *mydata) {
00272   <a class="code" href="structlammpsdata.html">lammpsdata</a> *data = (<a class="code" href="structlammpsdata.html">lammpsdata</a> *)mydata;
00273   fclose(data-&gt;<a class="code" href="structlammpsdata.html#m0">file</a>);
00274   free(data-&gt;<a class="code" href="structlammpsdata.html#m2">file_name</a>);
00275   <font class="keywordflow">if</font>(data-&gt;<a class="code" href="structlammpsdata.html#m6">graphlist</a>) free(data-&gt;<a class="code" href="structlammpsdata.html#m6">graphlist</a>);
00276   free(data);
00277 }
00278 
00279 
00280 <font class="comment">/* registration stuff */</font>
<a name="l00281"></a><a class="code" href="lammpspluginA_8c.html#a1">00281</a> <font class="keyword">static</font> <a class="code" href="structmolfile__plugin__t.html">molfile_plugin_t</a> <a class="code" href="lammpspluginA_8c.html#a1">lammpsplugin</a> = {
00282   <a class="code" href="vmdplugin_8h.html#a10">vmdplugin_ABIVERSION</a>,
00283   <a class="code" href="molfile__plugin_8h.html#a0">MOLFILE_PLUGIN_TYPE</a>,                         <font class="comment">/* type */</font>
00284   <font class="stringliteral">"lammpstrj"</font>,                                 <font class="comment">/* short name */</font>
00285   <font class="stringliteral">"LAMMPS Trajectory"</font>,                         <font class="comment">/* pretty name */</font>
00286   <font class="stringliteral">"John E. Stone"</font>,                             <font class="comment">/* author */</font>
00287   0,                                           <font class="comment">/* major version */</font>
00288   3,                                           <font class="comment">/* minor version */</font>
00289   <a class="code" href="vmdplugin_8h.html#a12">VMDPLUGIN_THREADSAFE</a>,                        <font class="comment">/* is reentrant */</font>
00290   <font class="stringliteral">"lammpstrj"</font>,                                 <font class="comment">/* file extension */</font>
00291   <a class="code" href="lammpspluginA_8c.html#a4">open_lammps_read</a>,
00292   <a class="code" href="lammpspluginA_8c.html#a5">read_lammps_structure</a>,
00293   0,
00294   <a class="code" href="lammpspluginA_8c.html#a6">read_lammps_timestep</a>,
00295   <a class="code" href="lammpspluginA_8c.html#a7">close_lammps_read</a>,
00296   0,                            <font class="comment">/* write... */</font>
00297   0,
00298   0,
00299   0,
00300   0,                            <font class="comment">/* read_volumetric_metadata */</font>
00301   0,                            <font class="comment">/* read_volumetric_data */</font>
00302   0,
00303 };
00304 
<a name="l00305"></a><a class="code" href="lammpspluginA_8c.html#a8">00305</a> <a class="code" href="vmdplugin_8h.html#a7">VMDPLUGIN_API</a> <font class="keywordtype">int</font> <a class="code" href="vmdplugin_8h.html#a5">VMDPLUGIN_init</a>() {
00306   <font class="keywordflow">return</font> <a class="code" href="vmdplugin_8h.html#a13">VMDPLUGIN_SUCCESS</a>;
00307 }
00308 
<a name="l00309"></a><a class="code" href="lammpspluginA_8c.html#a9">00309</a> <a class="code" href="vmdplugin_8h.html#a7">VMDPLUGIN_API</a> <font class="keywordtype">int</font> <a class="code" href="vmdplugin_8h.html#a3">VMDPLUGIN_register</a>(<font class="keywordtype">void</font> *v, <a class="code" href="vmdplugin_8h.html#a15">vmdplugin_register_cb</a> cb) {
00310   (*cb)(v, (<a class="code" href="structvmdplugin__t.html">vmdplugin_t</a> *)&amp;lammpsplugin);
00311   <font class="keywordflow">return</font> <a class="code" href="vmdplugin_8h.html#a13">VMDPLUGIN_SUCCESS</a>;
00312 }
00313 
<a name="l00314"></a><a class="code" href="lammpspluginA_8c.html#a10">00314</a> <a class="code" href="vmdplugin_8h.html#a7">VMDPLUGIN_API</a> <font class="keywordtype">int</font> <a class="code" href="vmdplugin_8h.html#a6">VMDPLUGIN_fini</a>() {
00315   <font class="keywordflow">return</font> <a class="code" href="vmdplugin_8h.html#a13">VMDPLUGIN_SUCCESS</a>;
00316 }
00317 
00318 
00319 <font class="preprocessor">#ifdef TEST_PLUGIN</font>
00320 <font class="preprocessor"></font>
00321 <font class="keywordtype">int</font> <a class="code" href="main_8c.html#a3">main</a>(<font class="keywordtype">int</font> argc, <font class="keywordtype">char</font> *argv[]) {
00322   <a class="code" href="structmolfile__timestep__t.html">molfile_timestep_t</a> timestep;
00323   <font class="keywordtype">void</font> *v;
00324   <font class="keywordtype">int</font> natoms;
00325   <font class="keywordtype">int</font> i, nsets, set;
00326 
00327   <font class="keywordflow">while</font> (--argc) {
00328     ++argv;
00329     v = <a class="code" href="lammpspluginA_8c.html#a4">open_lammps_read</a>(*argv, <font class="stringliteral">"lammps"</font>, &amp;natoms);
00330     <font class="keywordflow">if</font> (!v) {
00331       fprintf(stderr, <font class="stringliteral">"open_lammps_read failed for file %s\n"</font>, *argv);
00332       <font class="keywordflow">return</font> 1;
00333     }
00334     fprintf(stderr, <font class="stringliteral">"open_lammps_read succeeded for file %s\n"</font>, *argv);
00335     fprintf(stderr, <font class="stringliteral">"number of atoms: %d\n"</font>, natoms);
00336 
00337     i = 0;
00338     timestep.<a class="code" href="structmolfile__timestep__t.html#m0">coords</a> = (<font class="keywordtype">float</font> *)malloc(3*<font class="keyword">sizeof</font>(<font class="keywordtype">float</font>)*natoms);
00339     <font class="keywordflow">while</font> (!<a class="code" href="lammpspluginA_8c.html#a6">read_lammps_timestep</a>(v, natoms, &amp;timestep)) {
00340       i++;
00341     }
00342     fprintf(stderr, <font class="stringliteral">"ended read_next_timestep on frame %d\n"</font>, i);
00343 
00344     <a class="code" href="lammpspluginA_8c.html#a7">close_lammps_read</a>(v);
00345   }
00346   <font class="keywordflow">return</font> 0;
00347 }
00348 
00349 <font class="preprocessor">#endif</font>
00350 <font class="preprocessor"></font>
</pre></div><hr><address><small>Generated on Wed Mar 22 13:15:30 2006 for VMD Plugins (current) by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.14 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2002</small></address>
</body>
</html>
